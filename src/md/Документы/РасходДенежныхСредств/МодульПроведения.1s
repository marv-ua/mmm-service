//******************************************************************************
// Предопределенная процедура
//
Процедура ОбработкаПроведения()
    
	Если глНовыеПравилаВеденияНУ(ДатаДок) = 1 Тогда
		Предупреждение("Документ не формирует проводок, т.к. установлен способ ведения
					   |налогового учета - ""Одновременно с бухгалтерским учетом"" !");
		Возврат;
	КонецЕсли;
	
	СписокКонтрагентов = СоздатьОбъект("СписокЗначений");
	СписокДоговоровКонтрагентов = СоздатьОбъект("СписокЗначений");
	
	ВыбратьСтроки();
	Пока ПолучитьСтроку() = 1 Цикл
		Если УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ПрочиеРасходыСвязанныеСПогашениемЗадолженности Тогда
			СписокКонтрагентов.ДобавитьЗначение(Контрагент);
			СписокДоговоровКонтрагентов.ДобавитьЗначение(Договор);
		КонецЕсли;
	КонецЦикла;
	
	Если СписокКонтрагентов.РазмерСписка() > 0 Тогда
		БИН13 = СоздатьОбъект("БухгалтерскиеИтоги"); БИН13.ИспользоватьРазделительУчета(ЮрЛицо);
		БИН13.ИспользоватьСубконто(ВидыСубконто.Контрагенты, СписокКонтрагентов, 2);
		БИН13.ИспользоватьСубконто(ВидыСубконто.Договоры, СписокДоговоровКонтрагентов, 2);
		БИН13.ВыполнитьЗапрос(ДатаДок, ДатаДок, "Н13.02, Н13.03");
	КонецЕсли;
	
	ВыбратьСтроки();
	Пока ПолучитьСтроку() = 1 Цикл
		Если ПустоеЗначение(УсловиеИлиВидРасхода) = 1 Тогда
			ТекстСообщения = "В строке №" + НомерСтроки + " не указано условие расхода.";
			глНеПроводить(Контекст, ТекстСообщения);
			Возврат;
		КонецЕсли;
		
		ПривязыватьСтроку(НомерСтроки);
		
		Если УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.Оплата Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н13.02");
			Операция.Дебет.Контрагенты = Контрагент;
			Операция.Дебет.Договоры = Договор;
			
			Если НДС <> 0 Тогда
				Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
				Операция.СодержаниеПроводки = НаименованиеОперации;
				Операция.НомерЖурнала = "НУ";
				Операция.Сумма = НДС;
				Операция.Дебет.Счет = СчетПоКоду("Н13.03");
				Операция.Дебет.Контрагенты = Контрагент;
				Операция.Дебет.Договоры = Договор;
			КонецЕсли;

		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.Аванс Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н13.01");
			Операция.Дебет.Контрагенты = Контрагент;
			Операция.Дебет.Договоры = Договор;
			
		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.УслугиБанков Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н09");
			Операция.Дебет.ВнереализационныеРасходы = Перечисление.ВнереализационныеРасходы.УслугиБанков;

		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ПредоставлениеСредствНаУсловияхВозврата Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н13.01");
			Операция.Дебет.Контрагенты = Контрагент;
			Операция.Дебет.Договоры = Договор;
			
		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ВозвратАвансов Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н13.02");
			Операция.Дебет.Контрагенты = Контрагент;
			Операция.Дебет.Договоры = Договор;

			Если НДС <> 0 Тогда
				Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
				Операция.СодержаниеПроводки = НаименованиеОперации;
				Операция.НомерЖурнала = "НУ";
				Операция.Сумма = НДС;
				Операция.Дебет.Счет = СчетПоКоду("Н13.03");
				Операция.Дебет.Контрагенты = Контрагент;
				Операция.Дебет.Договоры = Договор;
			КонецЕсли;

		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ВзносыПоДобровольномуСтрахованию Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н04.05");
			Операция.Дебет.РасходыБудущихПериодов = СтатьяРасходовНаСтрахование;
			Операция.Дебет.Сотрудники = Сотрудник;

		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ВзносыПоДобровольномуСтрахованиюНаОплатуМедицинскихРасходов Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н04.06");
			Операция.Дебет.РасходыБудущихПериодов = СтатьяРасходовНаСтрахование;
			Операция.Дебет.Сотрудники = Сотрудник;

		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ВзносыПоДобровольномуСтрахованиюНаСлучайСмерти Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н04.07");
			Операция.Дебет.РасходыБудущихПериодов = СтатьяРасходовНаСтрахование;
			Операция.Дебет.Сотрудники = Сотрудник;

		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.РасходованиеЦелевыхСредств Тогда
			Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
			Операция.СодержаниеПроводки = НаименованиеОперации;
			Операция.НомерЖурнала = "НУ";
			Операция.Сумма = Сумма;
			Операция.Дебет.Счет = СчетПоКоду("Н12");
			
		ИначеЕсли УсловиеИлиВидРасхода = Перечисление.УсловияИлиВидыРасходов.ПрочиеРасходыСвязанныеСПогашениемЗадолженности Тогда
			СуммаКредитроскойЗадолженности    = 0;
			СуммаНДСКредитроскойЗадолженности = 0;
			Если (БИН13.ПолучитьСубконто(ВидыСубконто.Контрагенты,, Контрагент) = 1) Тогда
				Если (БИН13.ПолучитьСубконто(ВидыСубконто.Договоры,, Договор) = 1) Тогда
					БИН13.ВыбратьСчета();
					Пока БИН13.ПолучитьСчет() = 1 Цикл
					    Если БИН13.Счет = СчетПоКоду("Н13.02") Тогда
							СуммаКредитроскойЗадолженности = Макс(БИН13.СКК(), 0);
							
						ИначеЕсли БИН13.Счет = СчетПоКоду("Н13.03") Тогда
					        СуммаНДСКредитроскойЗадолженности = Макс(БИН13.СКК(), 0);
					    КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЕсли;
			
			СуммаСписываемойКредиторскойЗадолженности     = Мин(СуммаКредитроскойЗадолженности, Сумма);
			СуммаСписываемогоНДСКредиторскойЗадолженности = ?(Сумма = 0, 0, НДС * (СуммаСписываемойКредиторскойЗадолженности / Сумма));
			СуммаСписываемогоНДСКредиторскойЗадолженности = Мин(СуммаСписываемогоНДСКредиторскойЗадолженности, СуммаНДСКредитроскойЗадолженности);
			СуммаДебиторскойЗадолженности = Сумма - СуммаСписываемойКредиторскойЗадолженности;
			
			Если СуммаСписываемойКредиторскойЗадолженности <> 0 Тогда
				Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
				Операция.СодержаниеПроводки = НаименованиеОперации;
				Операция.НомерЖурнала = "НУ";
				Операция.Сумма = СуммаСписываемойКредиторскойЗадолженности;
				Операция.Дебет.Счет = СчетПоКоду("Н13.02");
				Операция.Дебет.Контрагенты = Контрагент;
				Операция.Дебет.Договоры = Договор;
				
				Если СуммаСписываемогоНДСКредиторскойЗадолженности <> 0 Тогда
					Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
					Операция.СодержаниеПроводки = НаименованиеОперации;
					Операция.НомерЖурнала = "НУ";
					Операция.Сумма = СуммаСписываемогоНДСКредиторскойЗадолженности;
					Операция.Дебет.Счет = СчетПоКоду("Н13.03");
					Операция.Дебет.Контрагенты = Контрагент;
					Операция.Дебет.Договоры = Договор;
				КонецЕсли;    
			КонецЕсли;
			
			Если СуммаДебиторскойЗадолженности <> 0 Тогда
				Операция.НоваяПроводка(); Операция.РазделительУчета = ЮрЛицо;
				Операция.СодержаниеПроводки = НаименованиеОперации;
				Операция.НомерЖурнала = "НУ";
				Операция.Сумма = СуммаДебиторскойЗадолженности;
				Операция.Дебет.Счет = СчетПоКоду("Н13.01");
				Операция.Дебет.Контрагенты = Контрагент;
				Операция.Дебет.Договоры = Договор;    
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
		
	Операция.Записать();
	
	ТекстСообщения = "Документ проведен.";
	глСообщениеПроведения(ТекстСообщения, ТекущийДокумент(), 0);
	глПриПроведении(Контекст);

КонецПроцедуры // ОбработкаПроведения()
