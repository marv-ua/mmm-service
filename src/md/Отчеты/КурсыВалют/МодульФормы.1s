//_____________________________________________________________________________
Перем Т;
Перем Обновить;
Перем Расшифровка;
//_____________________________________________________________________________
Функция РасшифровкаОбновить(Обновить)
	Расшифровка.Установить("Обновить", Обновить);
	Возврат Расшифровка;
КонецФункции //РасшифровкаОбновить
//_____________________________________________________________________________
Процедура Сформировать()
	Если Валюта.Выбран()=0 Тогда
	    Предупреждение("Не выбрана валюта");
	    Возврат;
	КонецЕсли;
	СохранитьЗначение("ИсторияКурсовВалюта",Валюта);

	Если Обновить = 2 Тогда
	    СтрокаДействийФормы = "#Закрыть";
	КонецЕсли;
	Если (ТипЗначенияСтр(Т) <> "Таблица") ИЛИ (Обновить = 0) Тогда
	   	Т = СоздатьОбъект("Таблица");
	Иначе
	 	Т.Очистить();
	КонецЕсли;
    Т.ИсходнаяТаблица( "Таблица" );

	Расшифровка = СоздатьОбъект("СписокЗначений");
    Расшифровка.Установить("Отчет", "КурсыВалют");
    Расшифровка.Установить("ДатаНач", ДатаНач);
    Расшифровка.Установить("ДатаКон", ДатаКон);
	Расшифровка.Установить("Валюта", Валюта);

    ИстВал = СоздатьОбъект("Периодический");
	ИстВал.ИспользоватьОбъект("Курс",Валюта);
	Т.ВывестиСекцию("Шапка");
	ИстВал.ВыбратьЗначения(ДатаНач,ДатаКон);
	Пока ИстВал.ПолучитьЗначение()=1 Цикл
		Т.ВывестиСекцию("Строка");
	КонецЦикла;

	Т.ВывестиСекцию("Подвал");
	Т.ТолькоПросмотр(1);
	Т.Опции(0,0,5,0);
	Т.ОбластьПечати(3);
	Т.Показать("История курсов валют");
КонецПроцедуры //Сформировать
//_____________________________________________________________________________
Процедура ПриОткрытии()
	Если глФлагРасшифровки = 1 Тогда
		Обновить = глОбновить;
		ДатаНач = глРасшифровка.Получить("ДатаНач");
		ДатаКон = глРасшифровка.Получить("ДатаКон");
		Валюта = глРасшифровка.Получить("Валюта");

		Если Обновить <> 0 Тогда
			Т = глТаблица;
		КонецЕсли;

		Если Обновить <> 2 Тогда
			Сформировать();
			СтатусВозврата(0);
			Возврат;
		КонецЕсли;
	Иначе
		Обновить = 0;
		ДатаНач = НачалоПериодаБИ();
		ДатаКон = КонецПериодаБИ();
		Если Валюта.Выбран()=0 Тогда
			ВосстановитьЗначение("ИсторияКурсовВалюта",Валюта);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры //ПриОткрытии
//_____________________________________________________________________________
