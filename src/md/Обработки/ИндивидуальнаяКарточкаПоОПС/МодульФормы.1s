Перем ИсходнаяТаблица;
Перем Год;
Перем ФизЛицо;
Перем МесяцыИнвалидности[12];
Перем НазваниеМесяца[12];
Перем ПоследнийМесяц;
Перем РегрессивнаяШкалаПФР;
Перем ЕстьЕНВД;
Перем ПределыДоходовЕСН[10];

Перем СтавкиВзносаПФРСтраховаяЧасть[10];
Перем СтавкиВзносаПФРНакопительнаяЧасть[10];
Перем ИсходнаяТаблицаБезСправочников; //это будет таблица , сформированная при открытии карточки без данных справочника
Перем БуферРазделовСпр; //это будет список данных, введенных в справочники
Перем ТаблицаРасшифровокПоВР; //это будет список данных по ВР

Перем ДоходыВычетыНалогиСотрудников;    

Перем Буфер; //понадобится для вывода карточки и для формирования расшифровки

//******************************************************************************
// СписокРедактируемыхЯчеек()
//
// Параметры:
//		Расшифровка - 1, если список нужен для проверки доступности расшифровки, 0 - только для управления цветом
//
// Возвращаемое значение
//		список имен ячеек, которые надо запоминать в справочниках и складывать потом с данными журнала расчетов
//
// Описание:
//		прямым перебором составляем список  
//		
//
Функция СписокРедактируемыхЯчеек(Расшифровка=0)
	
	//заполненим список ячеек к обработке:
	СписокЯчеек=СоздатьОбъект("СписокЗначений");
	
	Для СчРаздел = 1 По 2 Цикл		
		Для СчМес = 1 По 12 Цикл
			
			МесяцСтрокой = глДополнитьСтроку(СчМес,2);
			
			Для Сч = 2 По 10 Цикл
				Если (Сч = 5) или (Сч > 3) и (Сч < 9) или (СчРаздел = 2) и (Сч = 3) Тогда
					Продолжить
				КонецЕсли;				
				ИмяОбл="П"+СчРаздел+глДополнитьСтроку(Сч,2)+МесяцСтрокой;
				СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			КонецЦикла;			    
			
			ИмяОбл="П"+СчРаздел+"4а"+МесяцСтрокой;
			СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			
			ИмяОбл="П"+СчРаздел+"4б"+МесяцСтрокой;
			СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			
			ИмяОбл="П"+СчРаздел+"4в"+МесяцСтрокой;
			СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			
			ИмяОбл="П"+СчРаздел+"4г"+МесяцСтрокой;
			СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			
			ИмяОбл="П"+СчРаздел+"4д"+МесяцСтрокой;
			СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			
			ИмяОбл="П"+СчРаздел+"4е"+МесяцСтрокой;
			СписокЯчеек.ДобавитьЗначение(ИмяОбл);
			
		КонецЦикла;				
	КонецЦикла;
	
	Возврат СписокЯчеек;
	
КонецФункции //СписокРедактируемыхЯчеек	

//******************************************************************************
// ОпределитьЦвет()
//
// Параметры:
//		нет
//
// Вызывается из ячеек со всеми редактируемыми числами
//
// Возвращаемое значение
//		нет
//
// Описание:
//		сравнивает ячейки до и после редактирования и во всех отличающихся меняет цвет  
//		
//
Процедура ОпределитьЦвет()
	// ИсходнаяТаблицаБезСправочников-до вызова
	// Таблица - текущее состояние
КонецПроцедуры

 //******************************************************************************
// ОпределитьСтавки()
//
// Параметры:
//		нет
//
// Вызывается из ячеек со всеми редактируемыми числами
//
// Возвращаемое значение
//		нет
//
// Описание:
//		определяет ставки налогов на выбранную дату  
//		
//
Процедура ОпределитьСтавки()
	
	НомерШкалыВзносов = глНомерШкалыСтраховыхВзносовПФР(ФизЛицо);
	КонецГода = КонГода(Дата(Год,12,31));
	
	СписокСтавкиВзносаПФРСтраховаяЧасть = глПолучитьСтавкиЕСН(глПолучитьНалог("ПФР_страх"), КонецГода, НомерШкалыВзносов, 1);
	СписокСтавкиВзносаПФРНакопительнаяЧасть = глПолучитьСтавкиЕСН(глПолучитьНалог("ПФР_нак"), КонецГода, НомерШкалыВзносов, 1);
	СписокПределыДоходовЕСН = глПолучитьСтавкиЕСН(глПолучитьНалог("ЕСН_ФБ"), КонецГода,, 0, 1);
	
	Для Сч = 1 по 10 Цикл
		СтавкиВзносаПФРСтраховаяЧасть[Сч] = СписокСтавкиВзносаПФРСтраховаяЧасть.ПолучитьЗначение(Сч);
		СтавкиВзносаПФРНакопительнаяЧасть[Сч] = СписокСтавкиВзносаПФРНакопительнаяЧасть.ПолучитьЗначение(Сч);
		ПределыДоходовЕСН[Сч] = СписокПределыДоходовЕСН.ПолучитьЗначение(Сч);
	КонецЦикла;
	
КонецПроцедуры //ОпределитьСтавки                                              

//*****************************************************************************
// ПриВводеДоходов()
//
// Параметры
//  нет
//
// Возвращаемое значение
//  нет
//
// Вызывается из ячеек табличного документа
//  в колонках со 2 По 10
//
// Описание
//  обеспечивает пересчет всей зависимой информации
//  
Процедура ПриВводеДоходов()
	
    ОпределитьЦвет();
	
	Имя=Таблица.АктивнаяОбласть(); // имя ячейки, в которой изменили данные
	Если Таблица.Область(Имя).Доступность() = 0 Тогда
		Возврат
	КонецЕсли;
	
	НомерКолонки= Число(Сред(Имя,3,2));
	КодКолонки	= Сред(Имя,3,2);
	Раздел		= Сред(Имя,2,1);
	
	// месяц, в котором изменили данные: начиная с этого месяца все надо пересчитывать
	МесяцРедактирования=Число(Прав(Имя,2));
	
	//заполним строки итого с начала года "пропущенных" месяцев  
	Если МесяцРедактирования > ПоследнийМесяц Тогда 
		Для Месяц = ПоследнийМесяц+1 По МесяцРедактирования Цикл
			ТекущийМесяцСтрокой=глДополнитьСтроку(Месяц,2);
			ПрошлыйМесяцСтрокой=глДополнитьСтроку(Месяц-1,2);
			               
			Таблица.Область("СНГ102"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ102"+ПрошлыйМесяцСтрокой).Текст;					
			Таблица.Область("СНГ12а"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ12а"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ103"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ103"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ14а"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ14а"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ14б"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ14б"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ14в"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ14в"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ14д"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ14д"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ14е"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ14е"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ104"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ104"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ105"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ105"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ106"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ106"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ107"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ107"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ108"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ108"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ109"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ109"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ110"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ110"+ПрошлыйМесяцСтрокой).Текст;
			
			Таблица.Область("СНГ202"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ202"+ПрошлыйМесяцСтрокой).Текст;	
			Таблица.Область("СНГ22а"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ22а"+ПрошлыйМесяцСтрокой).Текст;	
			Таблица.Область("СНГ24а"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ24а"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ24б"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ24б"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ24в"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ24в"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ24д"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ24д"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ24е"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ24е"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ204"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ204"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ205"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ205"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ206"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ206"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ207"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ207"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ208"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ208"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ209"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ209"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ210"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ210"+ПрошлыйМесяцСтрокой).Текст;
			
			Таблица.Область("СНГ302"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ302"+ПрошлыйМесяцСтрокой).Текст;	
			Таблица.Область("СНГ32а"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ32а"+ПрошлыйМесяцСтрокой).Текст;	
			Таблица.Область("СНГ303"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ303"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ34а"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ34а"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ34б"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ34б"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ34в"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ34в"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ34д"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ34д"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ34е"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ34е"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ304"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ304"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ305"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ305"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ306"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ306"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ307"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ307"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ308"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ308"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ309"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ309"+ПрошлыйМесяцСтрокой).Текст;
			Таблица.Область("СНГ310"+ТекущийМесяцСтрокой).Текст	= Таблица.Область("СНГ310"+ПрошлыйМесяцСтрокой).Текст;					
						
		КонецЦикла;
	КонецЕсли;
	ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно, заполнили очередной месяц - будем обновлять таблицу по этот месяц

   	ОблагаемаяПФР							= 0;
	НачисленоВсего							= 0;
	НачисленоВсегоИностранцу				= 0;
	ЛьготВсего								= 0;
	НачисленоЗаСчетПрибыли					= 0;
	НачисленоЕНВД							= 0;
	НачисленоЕНВДИностранцу					= 0;
	ЛьготаПоЕСНп1ст236						= 0;
	ЛьготаПоЕСНп2ст238абз2					= 0;
	ЛьготаПоЕСНп2ст238абз3					= 0;
	ЛьготаПоЕСНпп13п1ст238					= 0;
	ПособийЗаСчетФСС						= 0;
	УдержаноПФРнаСтраховуюПенсию			= 0;
	УдержаноПФРнаНакопительнуюПенсию		= 0;	
	ЛьготаПоЕСНп1ст236ПФР					= 0;
	ЛьготаПоЕСНп2ст238абз2ПФР				= 0;
	ЛьготаПоЕСНп2ст238абз3ПФР				= 0;
	ЛьготаПоЕСНпп13п1ст238ПФР				= 0;
	ПрочихЛьготПоСт238ПФР					= 0;
	ПособийЗаСчетФССПФР						= 0;
	ЛьготВсегоПФР							= 0;
	ОБЛ_ПФР_ЕНВД							= 0;
	УдержаноПФРнаСтраховуюПенсиюЕНВД		= 0;
	УдержаноПФРнаНакопительнуюПенсиюЕНВД	= 0;
	НачисленоВсегоПредыдМесяца				= 0;	
	НачисленоИностранцуПредыдМесяца			= 0;	
	ЛьготВсегоПредыдМесяца					= 0;	
	НачисленоЗаСчетПрибылиПредыдМесяца		= 0;
	НачисленоЕНВДПредыдМесяца				= 0;
	НачисленоЕНВДИностранцуПредыдМесяца		= 0;
	ЛьготаПоЕСНп1ст236ПредыдМесяца			= 0;
	ЛьготаПоЕСНп2ст238абз2ПредыдМесяца		= 0;
	ЛьготаПоЕСНп2ст238абз3ПредыдМесяца		= 0;
	ЛьготаПоЕСНпп13п1ст238ПредыдМесяца		= 0;
	ПрочихЛьготПоСт238ПредыдМесяца			= 0;
	ПособийЗаСчетФССПредыдМесяца			= 0;	
	ОблагаемаяПФРПредыдМесяца				= 0;
	ЛьготаПоЕСНп1ст236ПФРПредыдМесяца		= 0;
	ЛьготаПоЕСНп2ст238абз2ПФРПредыдМесяца	= 0;
	ЛьготаПоЕСНп2ст238абз3ПФРПредыдМесяца	= 0;
	ЛьготаПоЕСНпп13п1ст238ПФРПредыдМесяца	= 0;
	ПрочихЛьготПоСт238ПФРПредыдМесяца		= 0;
	ПособийЗаСчетФССПФРПредыдМесяца			= 0;
	ЛьготВсегоПФРПредыдМесяца				= 0;	
	ОБЛ_ПФР_ЕНВДПредыдМесяца				= 0; 
	
	УдержаноПФРнаСтраховуюПенсиюЕНВДПредыдМесяца		= 0;
	УдержаноПФРнаНакопительнуюПенсиюЕНВДПредыдМесяца	= 0;
	
	
	БылоВКолонке=Число(Таблица.Область("СНГ"+Сред(Имя,2)).Текст);
	
	Если МесяцРедактирования>1 Тогда  // запомним суммы предыдущего месяца
		
		МесяцСтрокой							= глДополнитьСтроку(МесяцРедактирования-1,2);
		БылоВКолонке							= БылоВКолонке - Таблица.Область("СНГ"+Раздел+КодКолонки+МесяцСтрокой).Значение;
		
		НачисленоВсегоПредыдМесяца				= Таблица.Область("СНГ302"+МесяцСтрокой).Значение;
		НачисленоВсегоИностранцуПредыдМесяца	= Таблица.Область("СНГ32а"+МесяцСтрокой).Значение;
		НачисленоЕНВДПредыдМесяца		 		= Таблица.Область("СНГ202"+МесяцСтрокой).Значение;						
		НачисленоЕНВДИностранцуПредыдМесяца		= Таблица.Область("СНГ22а"+МесяцСтрокой).Значение;						
		ЛьготаПоЕСНп1ст236ПредыдМесяца			= Таблица.Область("СНГ14а"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз2ПредыдМесяца		= Таблица.Область("СНГ14б"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз3ПредыдМесяца		= Таблица.Область("СНГ14в"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНпп13п1ст238ПредыдМесяца		= Таблица.Область("СНГ14г"+МесяцСтрокой).Значение;
		ПрочихЛьготПоСт238ПредыдМесяца			= Таблица.Область("СНГ14д"+МесяцСтрокой).Значение;
		ПособийЗаСчетФССПредыдМесяца			= Таблица.Область("СНГ14е"+МесяцСтрокой).Значение;
		НачисленоЗаСчетПрибылиПредыдМесяца		= Таблица.Область("СНГ103"+МесяцСтрокой).Значение;		
		ЛьготаПоЕСНп1ст236ПФРПредыдМесяца		= ЛьготаПоЕСНп1ст236ПредыдМесяца + Таблица.Область("СНГ24а"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз2ПФРПредыдМесяца	= ЛьготаПоЕСНп2ст238абз2ПредыдМесяца + Таблица.Область("СНГ24б"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз3ПФРПредыдМесяца	= ЛьготаПоЕСНп2ст238абз3ПредыдМесяца + Таблица.Область("СНГ24в"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНпп13п1ст238ПФРПредыдМесяца	= ЛьготаПоЕСНпп13п1ст238ПредыдМесяца + Таблица.Область("СНГ24г"+МесяцСтрокой).Значение;
		ПрочихЛьготПоСт238ПФРПредыдМесяца		= ПрочихЛьготПоСт238ПредыдМесяца + Таблица.Область("СНГ24д"+МесяцСтрокой).Значение;
		ПособийЗаСчетФССПФРПредыдМесяца			= ПособийЗаСчетФССПредыдМесяца + Таблица.Область("СНГ24е"+МесяцСтрокой).Значение;				                           	
		ЛьготВсегоПредыдМесяца					= ЛьготаПоЕСНп1ст236ПредыдМесяца + ЛьготаПоЕСНп2ст238абз2ПредыдМесяца + ЛьготаПоЕСНп2ст238абз3ПредыдМесяца
												+ ЛьготаПоЕСНпп13п1ст238ПредыдМесяца + ПрочихЛьготПоСт238ПредыдМесяца + ПособийЗаСчетФССПредыдМесяца; 
		ЛьготВсегоПФРПредыдМесяца				= ЛьготаПоЕСНп1ст236ПФРПредыдМесяца + ЛьготаПоЕСНп2ст238абз2ПФРПредыдМесяца + ЛьготаПоЕСНп2ст238абз3ПФРПредыдМесяца
												+ ЛьготаПоЕСНпп13п1ст238ПФРПредыдМесяца + ПрочихЛьготПоСт238ПФРПредыдМесяца + ПособийЗаСчетФССПФРПредыдМесяца;												
		ОблагаемаяПФРПредыдМесяца				= Таблица.Область("СНГ305"+МесяцСтрокой).Значение;
		ОБЛ_ПФР_ЕНВДПредыдМесяца				= Таблица.Область("СНГ205"+МесяцСтрокой).Значение;
		УдержаноПФРнаСтраховуюПенсию			= Таблица.Область("СНГ309"+МесяцСтрокой).Значение;
		УдержаноПФРнаНакопительнуюПенсию		= Таблица.Область("СНГ310"+МесяцСтрокой).Значение;
		
	КонецЕсли; 
	
	ИзмененияВКолонке = Таблица.Область(Имя).Значение - БылоВКолонке; // определим сумму на которую изменили значение в ячейке
	
	Сообщали=0;
	
	// пересчитываем все данные, зависимые от введенных вручную 
	Для Месяц = МесяцРедактирования По ПоследнийМесяц Цикл
		
		МесяцСтрокой=глДополнитьСтроку(Месяц,2);
		                     
		НачисленоВсего				= Таблица.Область("СНГ302"+МесяцСтрокой).Значение;
		НачисленоВсегоИностранцу	= Таблица.Область("СНГ32а"+МесяцСтрокой).Значение;
		НачисленоЗаСчетПрибыли		= Таблица.Область("СНГ103"+МесяцСтрокой).Значение;
		НачисленоЕНВД				= Таблица.Область("СНГ202"+МесяцСтрокой).Значение;										
		НачисленоЕНВДИностранцу		= Таблица.Область("СНГ22а"+МесяцСтрокой).Значение;										
		ЛьготаПоЕСНп1ст236			= Таблица.Область("СНГ14а"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз2		= Таблица.Область("СНГ14б"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз3		= Таблица.Область("СНГ14в"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНпп13п1ст238		= Таблица.Область("СНГ14г"+МесяцСтрокой).Значение;
		ПрочихЛьготПоСт238			= Таблица.Область("СНГ14д"+МесяцСтрокой).Значение;
		ПособийЗаСчетФСС			= Таблица.Область("СНГ14е"+МесяцСтрокой).Значение;		
		ЛьготаПоЕСНп1ст236ПФР		= ЛьготаПоЕСНп1ст236 + Таблица.Область("СНГ24а"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз2ПФР	= ЛьготаПоЕСНп2ст238абз2 + Таблица.Область("СНГ24б"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНп2ст238абз3ПФР	= ЛьготаПоЕСНп2ст238абз3 + Таблица.Область("СНГ24в"+МесяцСтрокой).Значение;
		ЛьготаПоЕСНпп13п1ст238ПФР	= ЛьготаПоЕСНпп13п1ст238 + Таблица.Область("СНГ24г"+МесяцСтрокой).Значение;
		ПрочихЛьготПоСт238ПФР		= ПрочихЛьготПоСт238 + Таблица.Область("СНГ24д"+МесяцСтрокой).Значение;
		ПособийЗаСчетФССПФР			= ПособийЗаСчетФСС + Таблица.Область("СНГ24е"+МесяцСтрокой).Значение;				
		ЛьготВсего					= ЛьготаПоЕСНп1ст236 + ЛьготаПоЕСНп2ст238абз2 + ЛьготаПоЕСНп2ст238абз3
									+ ЛьготаПоЕСНпп13п1ст238 + ПрочихЛьготПоСт238 + ПособийЗаСчетФСС; 
		ЛьготВсегоПФР				= ЛьготаПоЕСНп1ст236ПФР + ЛьготаПоЕСНп2ст238абз2ПФР + ЛьготаПоЕСНп2ст238абз3ПФР		
									+ ЛьготаПоЕСНпп13п1ст238ПФР + ПрочихЛьготПоСт238ПФР + ПособийЗаСчетФССПФР;
		ОблагаемаяПФР				= Макс(НачисленоВсего - НачисленоВсегоИностранцу - НачисленоЗаСчетПрибыли - ЛьготВсегоПФР,0);
		ОБЛ_ПФР_ЕНВД				= Макс(НачисленоЕНВД - НачисленоЕНВДИностранцу - (ЛьготВсегоПФР - ЛьготВсего),0);
										
		НарастающимИтогом = Таблица.Область("СНГ"+Раздел+КодКолонки+МесяцСтрокой).Значение + ИзмененияВКолонке;
		
		Таблица.Область("СНГ"+Раздел+КодКолонки+МесяцСтрокой).Значение = НарастающимИтогом;

		Если НачГода(Дата(Год,1,1))<'01.01.2005' Тогда
			Если (НомерКолонки = 4) и (КодКолонки<>"4д") Тогда
				Если КодКолонки = "4г" Тогда
					Предел=10000
				Иначе
					Предел=2000
				КонецЕсли;
				Если НарастающимИтогом > Предел Тогда
					Если Сообщали=0 Тогда
						Сообщить("В "+НазваниеМесяца[Месяц]+" введенная необлагаемая сумма превысила предусмотренный НК РФ размер!","!");
						Сообщали=1;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			
			Если (НомерКолонки = 21) Тогда
				Предел = 0;               
				Если КодКолонки = "4а" Тогда
					Если Число(Таблица.АктивнаяОбласть().Текст) > 1000 Тогда
						Если Сообщали=0 Тогда
							Сообщить("В "+НазваниеМесяца[Месяц]+" введенная необлагаемая сумма превысила предусмотренный НК РФ размер!","!");
							Сообщали=1;
						КонецЕсли;
					КонецЕсли;
				Иначе
					Если КодКолонки = "4г" Тогда
						Предел=10000
					ИначеЕсли (КодКолонки = "4б") или (КодКолонки = "4в") Тогда
						Предел=2000
					КонецЕсли;
					Если (НарастающимИтогом > Предел) и (Предел > 0) Тогда
						Если Сообщали=0 Тогда
							Сообщить("В "+НазваниеМесяца[Месяц]+" введенная необлагаемая сумма превысила предусмотренный НК РФ размер!","!");
							Сообщали=1;
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		// пересчитываем, если нужно, колонки сумм доходов и льгот
		
		Если НомерКолонки = 2  Тогда  // всего начислено
			Если Раздел = "1" Тогда
				Если КодКолонки = "2а" Тогда
					НачисленоВсегоИностранцу	= НачисленоВсегоИностранцу + ИзмененияВКолонке;
					
				Иначе
					НачисленоВсего	= НачисленоВсего + ИзмененияВКолонке;
				КонецЕсли;
				
				ОблагаемаяПФР				= Макс(НачисленоВсего - НачисленоВсегоИностранцу - НачисленоЗаСчетПрибыли - ЛьготВсегоПФР,0);
				ОБЛ_ПФР_ЕНВД				= Макс(НачисленоЕНВД - НачисленоЕНВДИностранцу - (ЛьготВсегоПФР - ЛьготВсего),0);
				
				Таблица.Область("П105"+МесяцСтрокой).Значение = Макс(ОблагаемаяПФР - ОблагаемаяПФРПредыдМесяца - (ОБЛ_ПФР_ЕНВД - ОБЛ_ПФР_ЕНВДПредыдМесяца), 0);
				Таблица.Область("СНГ105"+МесяцСтрокой).Значение = ОблагаемаяПФР - (ОБЛ_ПФР_ЕНВД );// + (ЛьготВсегоПФР - ЛьготВсего);			
				
			ИначеЕсли  Раздел = "2" Тогда
				Если КодКолонки = "2а" Тогда
					НачисленоЕНВДИностранцу	= НачисленоЕНВДИностранцу + ИзмененияВКолонке;
					
				Иначе
					НачисленоЕНВД	= НачисленоЕНВД + ИзмененияВКолонке;
				КонецЕсли;
				
				ОблагаемаяПФР				= Макс(НачисленоВсего - НачисленоВсегоИностранцу - НачисленоЗаСчетПрибыли - ЛьготВсегоПФР,0);
				ОБЛ_ПФР_ЕНВД				= Макс(НачисленоЕНВД - НачисленоЕНВДИностранцу - (ЛьготВсегоПФР - ЛьготВсего),0);
				
				Таблица.Область("П205"+МесяцСтрокой).Значение = ОБЛ_ПФР_ЕНВД - ОБЛ_ПФР_ЕНВДПредыдМесяца;				
				Таблица.Область("СНГ205"+МесяцСтрокой).Значение = ОБЛ_ПФР_ЕНВД;				
			КонецЕсли;
			
			Таблица.Область("П305"+МесяцСтрокой).Значение = Таблица.Область("П105"+МесяцСтрокой).Значение + Таблица.Область("П205"+МесяцСтрокой).Значение;
			Таблица.Область("СНГ305"+МесяцСтрокой).Значение = Таблица.Область("СНГ105"+МесяцСтрокой).Значение + Таблица.Область("СНГ205"+МесяцСтрокой).Значение;
			
		ИначеЕсли НомерКолонки = 3  Тогда  // всего начислено			
			НачисленоЗаСчетПрибыли = НачисленоЗаСчетПрибыли + ИзмененияВКолонке; 
			ОблагаемаяПФР				= Макс(НачисленоВсего - НачисленоВсегоИностранцу - НачисленоЗаСчетПрибыли - ЛьготВсегоПФР,0);
			ОБЛ_ПФР_ЕНВД				= Макс(НачисленоЕНВД - НачисленоЕНВДИностранцу - (ЛьготВсегоПФР - ЛьготВсего),0);
			Таблица.Область("П105"+МесяцСтрокой).Значение = Макс(ОблагаемаяПФР - ОблагаемаяПФРПредыдМесяца - (ОБЛ_ПФР_ЕНВД - ОБЛ_ПФР_ЕНВДПредыдМесяца), 0);
			Таблица.Область("СНГ105"+МесяцСтрокой).Значение = ОблагаемаяПФР - (ОБЛ_ПФР_ЕНВД );// + (ЛьготВсегоПФР - ЛьготВсего);
			Таблица.Область("П305"+МесяцСтрокой).Значение = Таблица.Область("П105"+МесяцСтрокой).Значение + Таблица.Область("П205"+МесяцСтрокой).Значение;
			Таблица.Область("СНГ305"+МесяцСтрокой).Значение = Таблица.Область("СНГ105"+МесяцСтрокой).Значение + Таблица.Область("СНГ205"+МесяцСтрокой).Значение;			
		
		ИначеЕсли НомерКолонки = 4 Тогда // всего льгот 			                                    
			Если Раздел = "1" Тогда
				ЛьготВсего	= ЛьготВсего + ИзмененияВКолонке;
				ЛьготВсегоПФР	= ЛьготВсегоПФР + ИзмененияВКолонке;
				
				Таблица.Область("П104"+МесяцСтрокой).Значение	= ЛьготВсего-ЛьготВсегоПредыдМесяца;
				Таблица.Область("СНГ104"+МесяцСтрокой).Значение	= ЛьготВсего;				
				
				ОблагаемаяПФР			= Макс(НачисленоВсего - НачисленоВсегоИностранцу - НачисленоЗаСчетПрибыли - ЛьготВсегоПФР,0);
				ОБЛ_ПФР_ЕНВД			= Макс(НачисленоЕНВД - НачисленоЕНВДИностранцу - (ЛьготВсегоПФР - ЛьготВсего),0);
				Таблица.Область("П105"+МесяцСтрокой).Значение = Макс(ОблагаемаяПФР - ОблагаемаяПФРПредыдМесяца - (ОБЛ_ПФР_ЕНВД - ОБЛ_ПФР_ЕНВДПредыдМесяца), 0);
				Таблица.Область("СНГ105"+МесяцСтрокой).Значение = ОблагаемаяПФР - (ОБЛ_ПФР_ЕНВД );// + (ЛьготВсегоПФР - ЛьготВсего);
				
			ИначеЕсли Раздел = "2" Тогда
				ЛьготВсегоПФР	= ЛьготВсегоПФР + ИзмененияВКолонке;
				Таблица.Область("П204"+МесяцСтрокой).Значение	= (ЛьготВсегоПФР-ЛьготВсегоПФРПредыдМесяца) - (ЛьготВсего-ЛьготВсегоПредыдМесяца);
				Таблица.Область("СНГ204"+МесяцСтрокой).Значение	= ЛьготВсегоПФР - ЛьготВсего ;
				
				ОблагаемаяПФР			= Макс(НачисленоВсего - НачисленоВсегоИностранцу - НачисленоЗаСчетПрибыли - ЛьготВсегоПФР,0);
				ОБЛ_ПФР_ЕНВД			= Макс(НачисленоЕНВД - НачисленоЕНВДИностранцу - (ЛьготВсегоПФР - ЛьготВсего),0);
				
				Таблица.Область("П205"+МесяцСтрокой).Значение = ОБЛ_ПФР_ЕНВД - ОБЛ_ПФР_ЕНВДПредыдМесяца;				
				Таблица.Область("СНГ205"+МесяцСтрокой).Значение = ОБЛ_ПФР_ЕНВД;
			КонецЕсли;                                                           			
			Таблица.Область("П305"+МесяцСтрокой).Значение = Таблица.Область("П105"+МесяцСтрокой).Значение + Таблица.Область("П205"+МесяцСтрокой).Значение;
			Таблица.Область("СНГ305"+МесяцСтрокой).Значение = Таблица.Область("СНГ105"+МесяцСтрокой).Значение + Таблица.Область("СНГ205"+МесяцСтрокой).Значение;
		КонецЕсли;
		
		ДатаОкончания=КонМесяца(Дата(Год,МесяцРедактирования,15));

		ИспользоватьРегрессивнуюШкалуПФР = ?(Год < 2005, РегрессивнаяШкалаПФР.Получить(ДатаОкончания), Да); // организация может иметь право на применение регрессивной шкалы для расчетов ПФР 
		
		ОблагаемаяПФР = Таблица.Область("СНГ305"+МесяцСтрокой).Значение;
		ОблагаемаяПФРПредыдМесяца = ?(Месяц = 1, 0, Таблица.Область("СНГ305"+глДополнитьСтроку(Месяц-1,2)).Значение);
		
		// страховые взносы на обязательное пенсионное страхование
		СуммавПФРСтраховаяЧасть = глРассчитатьЕСНилиВзносыВПФР(ОблагаемаяПФР,СтавкиВзносаПФРСтраховаяЧасть,ИспользоватьРегрессивнуюШкалуПФР,ПределыДоходовЕСН);
		// запоминаем начисленную сумму взносов
		
		СуммавПФРНакопительнаяЧасть = глРассчитатьЕСНилиВзносыВПФР(ОблагаемаяПФР,СтавкиВзносаПФРНакопительнаяЧасть,ИспользоватьРегрессивнуюШкалуПФР,ПределыДоходовЕСН);
		// запоминаем начисленную сумму взносов
		Таблица.Область("П308"+МесяцСтрокой).Значение	= СуммавПФРСтраховаяЧасть-УдержаноПФРнаСтраховуюПенсию + СуммавПФРНакопительнаяЧасть-УдержаноПФРнаНакопительнуюПенсию;
		Таблица.Область("П309"+МесяцСтрокой).Значение	= СуммавПФРСтраховаяЧасть-УдержаноПФРнаСтраховуюПенсию;
		Таблица.Область("П310"+МесяцСтрокой).Значение	= СуммавПФРНакопительнаяЧасть-УдержаноПФРнаНакопительнуюПенсию;						
		Таблица.Область("СНГ308"+МесяцСтрокой).Значение	= СуммавПФРСтраховаяЧасть + СуммавПФРНакопительнаяЧасть;			
		Таблица.Область("СНГ309"+МесяцСтрокой).Значение	= СуммавПФРСтраховаяЧасть;
		Таблица.Область("СНГ310"+МесяцСтрокой).Значение	= СуммавПФРНакопительнаяЧасть;			
		
		ОБЛ_ПФР_ЕНВД = Таблица.Область("СНГ205"+МесяцСтрокой).Значение;
		ОБЛ_ПФР_ЕНВДПредыдМесяца = ?(Месяц = 1, 0, Таблица.Область("СНГ205"+глДополнитьСтроку(Месяц-1,2)).Значение);
		
		Если ОблагаемаяПФР - ОблагаемаяПФРПредыдМесяца <> 0 Тогда
			УдержаноПФПФРНаОПСЕНВД = ((СуммавПФРСтраховаяЧасть + СуммавПФРНакопительнаяЧасть) - (УдержаноПФРнаСтраховуюПенсию + УдержаноПФРнаНакопительнуюПенсию))* (ОБЛ_ПФР_ЕНВД-ОБЛ_ПФР_ЕНВДПредыдМесяца)/(ОблагаемаяПФР - ОблагаемаяПФРПредыдМесяца);
			УдержаноПФРнаСтраховуюПенсиюЕНВД = (СуммавПФРСтраховаяЧасть - УдержаноПФРнаСтраховуюПенсию)/(ОблагаемаяПФР - ОблагаемаяПФРПредыдМесяца)*(ОБЛ_ПФР_ЕНВД-ОБЛ_ПФР_ЕНВДПредыдМесяца);
			УдержаноПФРнаНакопительнуюПенсиюЕНВД = УдержаноПФПФРНаОПСЕНВД -  УдержаноПФРнаСтраховуюПенсиюЕНВД;
		Иначе
			УдержаноПФРнаСтраховуюПенсиюЕНВД = 0;
			УдержаноПФРнаНакопительнуюПенсиюЕНВД = 0;
		КонецЕсли;
            
		Если Раздел = "1" Тогда
			Таблица.Область("П108"+МесяцСтрокой).Значение	= Таблица.Область("П308"+МесяцСтрокой).Значение - (УдержаноПФРнаСтраховуюПенсиюЕНВД + УдержаноПФРнаНакопительнуюПенсиюЕНВД);
			Таблица.Область("П109"+МесяцСтрокой).Значение	= Таблица.Область("П309"+МесяцСтрокой).Значение - УдержаноПФРнаСтраховуюПенсиюЕНВД;
			Таблица.Область("П110"+МесяцСтрокой).Значение	= Таблица.Область("П310"+МесяцСтрокой).Значение - УдержаноПФРнаНакопительнуюПенсиюЕНВД;
		ИначеЕсли Раздел = "2" Тогда
			Таблица.Область("П208"+МесяцСтрокой).Значение	= УдержаноПФРнаСтраховуюПенсиюЕНВД + УдержаноПФРнаНакопительнуюПенсиюЕНВД;
			Таблица.Область("П209"+МесяцСтрокой).Значение	= УдержаноПФРнаСтраховуюПенсиюЕНВД;
			Таблица.Область("П210"+МесяцСтрокой).Значение	= УдержаноПФРнаНакопительнуюПенсиюЕНВД;
		КонецЕсли;
		
		УдержаноПФРнаНакопительнуюПенсию=СуммавПФРНакопительнаяЧасть;
		УдержаноПФРнаСтраховуюПенсию=СуммавПФРСтраховаяЧасть;
		
		Таблица.Область("П106"+МесяцСтрокой).Текст = "";
		Таблица.Область("П107"+МесяцСтрокой).Текст = "";
		Таблица.Область("П206"+МесяцСтрокой).Текст = "";
		Таблица.Область("П207"+МесяцСтрокой).Текст = "";
		Таблица.Область("П306"+МесяцСтрокой).Текст = "";
		Таблица.Область("П307"+МесяцСтрокой).Текст = "";
				
		Если ИспользоватьРегрессивнуюШкалуПФР = Да Тогда
			Если ((ОблагаемаяПФР-ОблагаемаяПФРПредыдМесяца)-(ОБЛ_ПФР_ЕНВД-ОБЛ_ПФР_ЕНВДПредыдМесяца)) <> 0 Тогда
				Если ОблагаемаяПФР <= ПределыДоходовЕСН[1] Тогда
					Таблица.Область("П106"+МесяцСтрокой).Текст = Строка(СтавкиВзносаПФРСтраховаяЧасть[1])+" %";
					Таблица.Область("П107"+МесяцСтрокой).Текст = Строка(СтавкиВзносаПФРНакопительнаяЧасть[1])+" %";
				ИначеЕсли ОблагаемаяПФР <= ПределыДоходовЕСН[2] Тогда
					Таблица.Область("П106"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[2])+" %";
					Таблица.Область("П107"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[2])+" %";
				ИначеЕсли ОблагаемаяПФР <= ПределыДоходовЕСН[3] Тогда
					Таблица.Область("П106"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРСтраховаяЧасть[2]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[3])+" %";
					Таблица.Область("П107"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРНакопительнаяЧасть[2]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[3])+" %";
				Иначе
					Таблица.Область("П106"+МесяцСтрокой).Текст =  Строка((ПределыДоходовЕСН[3]-ПределыДоходовЕСН[2])*СтавкиВзносаПФРСтраховаяЧасть[3]/100+ ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРСтраховаяЧасть[2]/100 + " руб.")
																+ РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[4])+" %";
					Таблица.Область("П107"+МесяцСтрокой).Текст = Строка((ПределыДоходовЕСН[3]-ПределыДоходовЕСН[2])*СтавкиВзносаПФРНакопительнаяЧасть[3]/100+ ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРНакопительнаяЧасть[2]/100 + " руб.")
																+ РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[4])+" %";
				КонецЕсли;
			КонецЕсли;
			
			Если (ОБЛ_ПФР_ЕНВД-ОБЛ_ПФР_ЕНВДПредыдМесяца) <> 0 Тогда
				Если ОблагаемаяПФР <= ПределыДоходовЕСН[1] Тогда
					Таблица.Область("П206"+МесяцСтрокой).Текст = Строка(СтавкиВзносаПФРСтраховаяЧасть[1])+" %";
					Таблица.Область("П207"+МесяцСтрокой).Текст = Строка(СтавкиВзносаПФРНакопительнаяЧасть[1])+" %";
				ИначеЕсли ОблагаемаяПФР <= ПределыДоходовЕСН[2] Тогда
					Таблица.Область("П206"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[2])+" %";
					Таблица.Область("П207"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[2])+" %";
				ИначеЕсли ОблагаемаяПФР <= ПределыДоходовЕСН[3] Тогда
					Таблица.Область("П206"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРСтраховаяЧасть[2]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[3])+" %";
					Таблица.Область("П207"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРНакопительнаяЧасть[2]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[3])+" %";
				Иначе
					Таблица.Область("П206"+МесяцСтрокой).Текст = Строка((ПределыДоходовЕСН[3]-ПределыДоходовЕСН[2])*СтавкиВзносаПФРСтраховаяЧасть[3]/100+ ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРСтраховаяЧасть[2]/100 + " руб.")
																+ РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[4])+" %";
					Таблица.Область("П207"+МесяцСтрокой).Текст = Строка((ПределыДоходовЕСН[3]-ПределыДоходовЕСН[2])*СтавкиВзносаПФРНакопительнаяЧасть[3]/100+ ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРНакопительнаяЧасть[2]/100 + " руб.")
																+ РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[4])+" %";
				КонецЕсли;
			КонецЕсли;
			
			Если (ОблагаемаяПФР-ОблагаемаяПФРПредыдМесяца) <> 0 Тогда
				Если ОблагаемаяПФР <= ПределыДоходовЕСН[1] Тогда
					Таблица.Область("П306"+МесяцСтрокой).Текст = Строка(СтавкиВзносаПФРСтраховаяЧасть[1])+" %";
					Таблица.Область("П307"+МесяцСтрокой).Текст = Строка(СтавкиВзносаПФРНакопительнаяЧасть[1])+" %";				
				ИначеЕсли ОблагаемаяПФР <= ПределыДоходовЕСН[2] Тогда
					Таблица.Область("П306"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[2])+" %";
					Таблица.Область("П307"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[2])+" %";				
				ИначеЕсли ОблагаемаяПФР <= ПределыДоходовЕСН[3] Тогда
					Таблица.Область("П306"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРСтраховаяЧасть[2]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[3])+" %";
					Таблица.Область("П307"+МесяцСтрокой).Текст = Строка(ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРНакопительнаяЧасть[2]/100 + " руб.") + РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[3])+" %";				
				Иначе
					Таблица.Область("П306"+МесяцСтрокой).Текст = Строка((ПределыДоходовЕСН[3]-ПределыДоходовЕСН[2])*СтавкиВзносаПФРСтраховаяЧасть[3]/100+ ПределыДоходовЕСН[1]*СтавкиВзносаПФРСтраховаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРСтраховаяЧасть[2]/100 + " руб.")
																+ РазделительСтрок + Строка(СтавкиВзносаПФРСтраховаяЧасть[4])+" %";
					Таблица.Область("П307"+МесяцСтрокой).Текст = Строка((ПределыДоходовЕСН[3]-ПределыДоходовЕСН[2])*СтавкиВзносаПФРНакопительнаяЧасть[3]/100+ ПределыДоходовЕСН[1]*СтавкиВзносаПФРНакопительнаяЧасть[1]/100 + (ПределыДоходовЕСН[2]-ПределыДоходовЕСН[1])*СтавкиВзносаПФРНакопительнаяЧасть[2]/100 + " руб.")
																+ РазделительСтрок + Строка(СтавкиВзносаПФРНакопительнаяЧасть[4])+" %";				
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		Таблица.Область("П3"+КодКолонки+МесяцСтрокой).Значение	= Таблица.Область("П1"+КодКолонки+МесяцСтрокой).Значение + Таблица.Область("П2"+КодКолонки+МесяцСтрокой).Значение;
		Таблица.Область("СНГ3"+КодКолонки+МесяцСтрокой).Значение= Таблица.Область("СНГ1"+КодКолонки+МесяцСтрокой).Значение + Таблица.Область("СНГ2"+КодКолонки+МесяцСтрокой).Значение;
		
		Таблица.Область("СНГ1"+"06"+МесяцСтрокой).Текст="";
		Таблица.Область("СНГ1"+"07"+МесяцСтрокой).Текст="";
		Таблица.Область("СНГ2"+"06"+МесяцСтрокой).Текст="";
		Таблица.Область("СНГ2"+"07"+МесяцСтрокой).Текст="";			
		Таблица.Область("СНГ3"+"06"+МесяцСтрокой).Текст="";
		Таблица.Область("СНГ3"+"07"+МесяцСтрокой).Текст="";						
			
		Если ИспользоватьРегрессивнуюШкалуПФР = Нет Тогда
			Если ((ОблагаемаяПФР-ОблагаемаяПФРПредыдМесяца)-(ОБЛ_ПФР_ЕНВД-ОБЛ_ПФР_ЕНВДПредыдМесяца)) <> 0 Тогда
				Таблица.Область("СНГ1"+"06"+МесяцСтрокой).Текст=Строка(СтавкиВзносаПФРСтраховаяЧасть[1])+" %";
				Таблица.Область("СНГ1"+"07"+МесяцСтрокой).Текст=Строка(СтавкиВзносаПФРНакопительнаяЧасть[1])+" %";
			КонецЕсли;
			
			Если (ОБЛ_ПФР_ЕНВД-ОБЛ_ПФР_ЕНВДПредыдМесяца) <> 0 Тогда
				Таблица.Область("СНГ2"+"06"+МесяцСтрокой).Текст=Строка(СтавкиВзносаПФРСтраховаяЧасть[1])+" %";
				Таблица.Область("СНГ2"+"07"+МесяцСтрокой).Текст=Строка(СтавкиВзносаПФРНакопительнаяЧасть[1])+" %";
			КонецЕсли;
			
			Если (ОблагаемаяПФР-ОблагаемаяПФРПредыдМесяца) <> 0 Тогда			
				Таблица.Область("СНГ3"+"06"+МесяцСтрокой).Текст=Строка(СтавкиВзносаПФРСтраховаяЧасть[1])+" %";
				Таблица.Область("СНГ3"+"07"+МесяцСтрокой).Текст=Строка(СтавкиВзносаПФРНакопительнаяЧасть[1])+" %";						
			КонецЕсли;
 		КонецЕсли;
		
		СНГ108 = 0;
		СНГ109 = 0;
		СНГ110 = 0;
		СНГ208 = 0;
		СНГ209 = 0;
		СНГ210 = 0;				
		Для СчМесяцев = 1 По Месяц Цикл			
			СчМесяцСтрокой = глДополнитьСтроку(СчМесяцев,2);
			СНГ108 = СНГ108 + Таблица.Область("П108"+СчМесяцСтрокой).Значение;
			СНГ109 = СНГ109 + Таблица.Область("П109"+СчМесяцСтрокой).Значение;
			СНГ110 = СНГ110 + Таблица.Область("П110"+СчМесяцСтрокой).Значение;
			СНГ208 = СНГ208 + Таблица.Область("П208"+СчМесяцСтрокой).Значение;
			СНГ209 = СНГ209 + Таблица.Область("П209"+СчМесяцСтрокой).Значение;
			СНГ210 = СНГ210 + Таблица.Область("П210"+СчМесяцСтрокой).Значение;							
		КонецЦикла;                                              		
		Таблица.Область("СНГ108"+МесяцСтрокой).Значение	= СНГ108;
		Таблица.Область("СНГ109"+МесяцСтрокой).Значение	= СНГ109;
		Таблица.Область("СНГ110"+МесяцСтрокой).Значение	= СНГ110;
		Таблица.Область("СНГ208"+МесяцСтрокой).Значение	= СНГ208;
		Таблица.Область("СНГ209"+МесяцСтрокой).Значение	= СНГ209;
		Таблица.Область("СНГ210"+МесяцСтрокой).Значение	= СНГ210;
		
		НачисленоВсегоПредыдМесяца				= НачисленоВсего;
		НачисленоВсегоИностранцуПредыдМесяца	= НачисленоВсегоИностранцу;
		ЛьготВсегоПредыдМесяца					= ЛьготВсего;
		НачисленоЗаСчетПрибылиПредыдМесяца		= НачисленоЗаСчетПрибыли;
		НачисленоЕНВДПредыдМесяца				= НачисленоЕНВД;
		НачисленоЕНВДИностранцуПредыдМесяца		= НачисленоЕНВДИностранцу;
		ОблагаемаяПФРПредыдМесяца				= ОблагаемаяПФР;		
		ЛьготаПоЕСНп1ст236ПредыдМесяца			= ЛьготаПоЕСНп1ст236;
		ЛьготаПоЕСНп2ст238абз2ПредыдМесяца		= ЛьготаПоЕСНп2ст238абз2;
		ЛьготаПоЕСНп2ст238абз3ПредыдМесяца		= ЛьготаПоЕСНп2ст238абз3;
		ЛьготаПоЕСНпп13п1ст238ПредыдМесяца		= ЛьготаПоЕСНпп13п1ст238;
		ПрочихЛьготПоСт238ПредыдМесяца			= ПрочихЛьготПоСт238;
		ПособийЗаСчетФССПредыдМесяца			= ПособийЗаСчетФСС;
		ЛьготаПоЕСНп1ст236ПФРПредыдМесяца		= ЛьготаПоЕСНп1ст236ПФР;
		ЛьготаПоЕСНп2ст238абз2ПФРПредыдМесяца	= ЛьготаПоЕСНп2ст238абз2ПФР;
		ЛьготаПоЕСНп2ст238абз3ПФРПредыдМесяца	= ЛьготаПоЕСНп2ст238абз3ПФР;
		ЛьготаПоЕСНпп13п1ст238ПФРПредыдМесяца	= ЛьготаПоЕСНпп13п1ст238ПФР;
		ПрочихЛьготПоСт238ПФРПредыдМесяца		= ПрочихЛьготПоСт238ПФР;
		ПособийЗаСчетФССПФРПредыдМесяца			= ПособийЗаСчетФССПФР;
		ЛьготВсегоПФРПредыдМесяца				= ЛьготВсегоПФР;
		ОБЛ_ПФР_ЕНВДПредыдМесяца				= ОБЛ_ПФР_ЕНВД;
		
		УдержаноПФРнаСтраховуюПенсиюЕНВДПредыдМесяца	= УдержаноПФРнаСтраховуюПенсиюЕНВД;
		УдержаноПФРнаНакопительнуюПенсиюЕНВДПредыдМесяца= УдержаноПФРнаНакопительнуюПенсиюЕНВД;
		
		
	КонецЦикла;
	
КонецПроцедуры // ПриВводеДоходов

//*****************************************************************************
// ПриВводеНалогов()
//
// Параметры
//		нет
//
// Вызывается из ячеек табличного документа
//		в колонках с 9 По 10
//
// Возвращаемое значение
//		нет
//
// Описание
//		обеспечивает пересчет строк "с начала года" в "затронутой" колонке
//		
Процедура ПриВводеНалогов()
	
	Имя=Таблица.АктивнаяОбласть(); // имя ячейки, в которой изменили данные
	
	НомерРаздела				= Сред(Имя,2,1);
	НомерКолонки				= Сред(Имя,3,2);
	МесяцРедактированияСтрокой	= Прав(Имя,2);
	МесяцРедактирования			= Число(МесяцРедактированияСтрокой); // месяц, в котором изменили данные: начиная с этого месяца все надо пересчитывать
	
	
	БылоВКолонке=0;
	Если МесяцРедактирования>1 Тогда
		БылоВКолонке=Таблица.Область("СНГ"+ НомерРаздела+НомерКолонки+глДополнитьСтроку(МесяцРедактирования-1,2)).Значение;
	КонецЕсли;         
	
	Таблица.Область("СНГ"+Прав(Имя,5)).Значение											= БылоВКолонке+Таблица.Область(Имя).Значение; // текущая строка "с начала года"
	Таблица.Область("СНГ3"+Прав(Имя,4)).Значение										= Таблица.Область("СНГ1"+Прав(Имя,4)).Значение
																						+ Таблица.Область("СНГ2"+Прав(Имя,4)).Значение;
	Таблица.Область("П" + НомерРаздела + "08" + МесяцРедактированияСтрокой).Значение	= Таблица.Область("П" + НомерРаздела + "09" + МесяцРедактированияСтрокой).Значение
																						+ Таблица.Область("П" + НомерРаздела + "10" + МесяцРедактированияСтрокой).Значение;
	Таблица.Область("П3"+НомерКолонки+МесяцРедактированияСтрокой).Значение				= Таблица.Область("П1"+НомерКолонки+МесяцРедактированияСтрокой).Значение 
																						+ Таблица.Область("П2"+НомерКолонки+МесяцРедактированияСтрокой).Значение;
	Таблица.Область("П308" + МесяцРедактированияСтрокой).Значение						= Таблица.Область("П309" + МесяцРедактированияСтрокой).Значение
																						+ Таблица.Область("П310" + МесяцРедактированияСтрокой).Значение;
	Таблица.Область("СНГ" + НомерРаздела + "08" + МесяцРедактированияСтрокой).Значение	= Таблица.Область("СНГ" + НомерРаздела + "09" + МесяцРедактированияСтрокой).Значение
																						+ Таблица.Область("СНГ" + НомерРаздела + "10" + МесяцРедактированияСтрокой).Значение;
	Таблица.Область("СНГ308"+МесяцРедактированияСтрокой).Значение						= Таблица.Область("СНГ309"+МесяцРедактированияСтрокой).Значение + Таблица.Область("СНГ310"+МесяцРедактированияСтрокой).Значение;
	
	// пересчитываем строки "с начала года" 
	Для Месяц = МесяцРедактирования+1 По ПоследнийМесяц Цикл
		ТекущийМесяцСтрокой=глДополнитьСтроку(Месяц,2);
		ПрошлыйМесяцСтрокой=глДополнитьСтроку(Месяц-1,2);
		Таблица.Область("СНГ"+НомерРаздела+НомерКолонки+ТекущийМесяцСтрокой).Значение	= Таблица.Область("СНГ"+НомерРаздела+НомерКолонки+ПрошлыйМесяцСтрокой).Значение + Таблица.Область("П"+НомерРаздела+НомерКолонки+ТекущийМесяцСтрокой).Значение;
		Таблица.Область("СНГ"+НомерРаздела+"08"+ТекущийМесяцСтрокой).Значение			= Таблица.Область("СНГ"+НомерРаздела+"09"+ПрошлыйМесяцСтрокой).Значение + Таблица.Область("СНГ"+НомерРаздела+"10"+ТекущийМесяцСтрокой).Значение;
		Таблица.Область("СНГ3"+НомерКолонки+ТекущийМесяцСтрокой).Значение				= Таблица.Область("СНГ3"+НомерКолонки+ПрошлыйМесяцСтрокой).Значение + Таблица.Область("П3"+НомерКолонки+ТекущийМесяцСтрокой).Значение;
		Таблица.Область("СНГ308"+ТекущийМесяцСтрокой).Значение							= Таблица.Область("СНГ309"+ПрошлыйМесяцСтрокой).Значение + Таблица.Область("СНГ310"+ТекущийМесяцСтрокой).Значение;
	КонецЦикла;	
		
КонецПроцедуры //ПриВводеНалогов() 

//*****************************************************************************
// Сохранить()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		Сохранить
//
// Возвращаемое значение
//		число 1 или 0 - удалось (не удалось) сохранить данные
//
// Описание
//
Функция Сохранить()
	
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	Если глСпискиИдентичны(СЗТекущееСостояние,ИсходнаяТаблица) = 0 Тогда
		
		// соберем данные о доходах
		ДоходыВычетыНалогиСотрудников = "";
		ДопДанныеФизЛица = "";
		Если глСобратьДанныеДляЕСН(ДоходыВычетыНалогиСотрудников,ФизЛицо,КонГода(Дата(Год,12,15)),"",0,2,,,,ДопДанныеФизЛица) <> 1 Тогда
			Предупреждение("Не удалось сохранить данные!",8);
			Возврат 0   
		КонецЕсли;
		
		СтрокаИтоговойТаблицы = 0;
		
		КодСотраВтаблице=глПолучитьУникальныйКодСотрудника(ФизЛицо.Код);
		НомСтрокиСотрудника = 0;
		Если ДоходыВычетыНалогиСотрудников.НайтиЗначение(КодСотраВтаблице+"01", НомСтрокиСотрудника, 1) = 0 Тогда
			Возврат 0;
			
		Иначе
			НомСтрокиСотрудника = НомСтрокиСотрудника - 1;
		КонецЕсли;
		
		НачисленоВсего = 0;		
		НачисленоВсегоИностранцу = 0;		
		ЕНВД = 0;
		НачисленоЕНВДИностранцу = 0;
		НачисленоЗаСчетПрибыли = 0;
		
		ЛьготаПоЕСНп1ст236 = 0;
		ЛьготаПоЕСНп2ст238абз2 = 0;
		ЛьготаПоЕСНп2ст238абз3 = 0;
		ЛьготаПоЕСНпп13п1ст238 = 0;
		ПрочихЛьготПоСт238 = 0;
		ПособийЗаСчетФСС = 0;
		
		ЛьготаПоЕСНп1ст236ПФР = 0;
		ЛьготаПоЕСНп2ст238абз2ПФР = 0;
		ЛьготаПоЕСНп2ст238абз3ПФР = 0;
		ЛьготаПоЕСНпп13п1ст238ПФР = 0;
		ПрочихЛьготПоСт238ПФР = 0;
		ПособийЗаСчетФССПФР = 0;
		
		УдержаноПФРнаСтраховуюПенсию = 0;
		УдержаноПФРнаНакопительнуюПенсию = 0;
		УдержаноПФРнаСтраховуюПенсиюВычет = 0;
		УдержаноПФРнаНакопительнуюПенсиюВычет = 0;
		ПФРУд = 0;
		ФССУд = 0;
		ФФОМСУд = 0;
		ТФОМСУд = 0;
		ПособийЗаСчетФСС = 0;
		
		КоличествоДанных = ?(ЕстьЕНВД = 0,25,31);  
		СписокВведенныхДанных = СоздатьОбъект("СписокЗначений");
		Для Сч = 1 По 12 Цикл
			
			МесяцОсмотра = Сч;
			МесяцСтрокой = глДополнитьСтроку(МесяцОсмотра,2);
			
			НачисленоВсего = НачисленоВсего + Таблица.Область("П102"+МесяцСтрокой).Значение+Таблица.Область("П202"+МесяцСтрокой).Значение;		
			НачисленоВсегоИностранцу = НачисленоВсегоИностранцу + Таблица.Область("П12а"+МесяцСтрокой).Значение+Таблица.Область("П22а"+МесяцСтрокой).Значение;		
			НачисленоЕНВДИностранцу = НачисленоЕНВДИностранцу + Таблица.Область("П22а"+МесяцСтрокой).Значение;
			ЕНВД = ЕНВД + Таблица.Область("П202"+МесяцСтрокой).Значение;
			НачисленоЗаСчетПрибыли = НачисленоЗаСчетПрибыли + Таблица.Область("П103"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНп1ст236 = ЛьготаПоЕСНп1ст236 + Таблица.Область("П14а"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНп2ст238абз2 = ЛьготаПоЕСНп2ст238абз2 + Таблица.Область("П14б"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНп2ст238абз3 = ЛьготаПоЕСНп2ст238абз3 + Таблица.Область("П14в"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНпп13п1ст238 = ЛьготаПоЕСНпп13п1ст238 + Таблица.Область("П14г"+МесяцСтрокой).Значение;
			ПрочихЛьготПоСт238 = ПрочихЛьготПоСт238 + Таблица.Область("П14д"+МесяцСтрокой).Значение;
			ПособийЗаСчетФСС = ПособийЗаСчетФСС + Таблица.Область("П14е"+МесяцСтрокой).Значение;
			
			ЛьготаПоЕСНп1ст236ПФР = ЛьготаПоЕСНп1ст236ПФР + Таблица.Область("П14а"+МесяцСтрокой).Значение + Таблица.Область("П24а"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНп2ст238абз2ПФР = ЛьготаПоЕСНп2ст238абз2ПФР + Таблица.Область("П14б"+МесяцСтрокой).Значение + Таблица.Область("П24б"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНп2ст238абз3ПФР = ЛьготаПоЕСНп2ст238абз3ПФР + Таблица.Область("П14в"+МесяцСтрокой).Значение + Таблица.Область("П24в"+МесяцСтрокой).Значение;
			ЛьготаПоЕСНпп13п1ст238ПФР = ЛьготаПоЕСНпп13п1ст238ПФР + Таблица.Область("П14г"+МесяцСтрокой).Значение + Таблица.Область("П24г"+МесяцСтрокой).Значение;
			ПрочихЛьготПоСт238ПФР = ПрочихЛьготПоСт238ПФР + Таблица.Область("П14д"+МесяцСтрокой).Значение + Таблица.Область("П24д"+МесяцСтрокой).Значение;
			ПособийЗаСчетФССПФР = ПособийЗаСчетФССПФР + Таблица.Область("П14е"+МесяцСтрокой).Значение + Таблица.Область("П24е"+МесяцСтрокой).Значение;
			
			ОблагаетсяПФР = НачисленоВсего				- НачисленоЗаСчетПрибыли 	-	ЛьготаПоЕСНп1ст236ПФР - 
							ЛьготаПоЕСНп2ст238абз2ПФР	- ЛьготаПоЕСНп2ст238абз3ПФР -	ЛьготаПоЕСНпп13п1ст238ПФР -
							ПрочихЛьготПоСт238ПФР		- ПособийЗаСчетФССПФР		-	НачисленоВсегоИностранцу;
			
			УдержаноПФРнаСтраховуюПенсию = УдержаноПФРнаСтраховуюПенсию + Таблица.Область("П109"+МесяцСтрокой).Значение + Таблица.Область("П209"+МесяцСтрокой).Значение;
			УдержаноПФРнаНакопительнуюПенсию = УдержаноПФРнаНакопительнуюПенсию + Таблица.Область("П110"+МесяцСтрокой).Значение + Таблица.Область("П210"+МесяцСтрокой).Значение;
			УдержаноПФРнаСтраховуюПенсиюВычет = УдержаноПФРнаСтраховуюПенсиюВычет + Таблица.Область("П109"+МесяцСтрокой).Значение;
			УдержаноПФРнаНакопительнуюПенсиюВычет = УдержаноПФРнаНакопительнуюПенсиюВычет + Таблица.Область("П110"+МесяцСтрокой).Значение;
			
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 10, НачисленоВсего);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 33, НачисленоВсегоИностранцу - НачисленоЕНВДИностранцу);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 41, НачисленоВсегоИностранцу);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 25, ЕНВД);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 13, НачисленоЗаСчетПрибыли);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 12, ЛьготаПоЕСНп1ст236);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 14, ЛьготаПоЕСНп2ст238абз2);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 15, ЛьготаПоЕСНп2ст238абз3);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 16, ЛьготаПоЕСНпп13п1ст238);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 17, ПрочихЛьготПоСт238);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч,  9, ПособийЗаСчетФСС);
			
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 26, ЛьготаПоЕСНп1ст236ПФР);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 27, ЛьготаПоЕСНп2ст238абз2ПФР);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 28, ЛьготаПоЕСНп2ст238абз3ПФР);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 29, ЛьготаПоЕСНпп13п1ст238ПФР);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 30, ПрочихЛьготПоСт238ПФР);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 31, ПособийЗаСчетФССПФР);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 23, ОблагаетсяПФР);
			
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 21, УдержаноПФРнаСтраховуюПенсию);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 22, УдержаноПФРнаНакопительнуюПенсию);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 42, УдержаноПФРнаСтраховуюПенсиюВычет);
			ДоходыВычетыНалогиСотрудников.УстановитьЗначение(НомСтрокиСотрудника + Сч, 43, УдержаноПФРнаНакопительнуюПенсиюВычет);
		КонецЦикла; 
		
		// Таблицу в список
		Карточка = СоздатьОбъект("СписокЗначений");
		Для НомСтроки = 1 по 12 Цикл
			СтрокаКарточки = СоздатьОбъект("СписокЗначений");
			Для НомКолонки = 1 по ДоходыВычетыНалогиСотрудников.КоличествоКолонок() Цикл
				КодКолонки = ДоходыВычетыНалогиСотрудников.ПолучитьПараметрыКолонки(НомКолонки);
				СтрокаКарточки.ДобавитьЗначение(ДоходыВычетыНалогиСотрудников.ПолучитьЗначение(НомСтроки, НомКолонки), КодКолонки);
			КонецЦикла;
			Карточка.ДобавитьЗначение(СтрокаКарточки);
		КонецЦикла;
		
		// Запись в справочник
		СпрИтоговПоГоду = СоздатьОбъект("Справочник.КарточкиУчетаДоходов");
		СпрИтоговПоГоду.ИспользоватьВладельца(ФизЛицо);
		
		// Поиск карточки в справочнике
		Если СпрИтоговПоГоду.НайтиПоКоду(Строка(Год)) = 0 Тогда
		    СпрИтоговПоГоду.Новый();
			СпрИтоговПоГоду.Код = Строка(Год);
			
		Иначе
			СпрИтоговПоГоду.ВыбратьЭлементы();
			СписокЭлементов = СоздатьОбъект("СписокЗначений");
			Пока СпрИтоговПоГоду.ПолучитьЭлемент() = 1 Цикл
				Если СпрИтоговПоГоду.Код = Строка(Год) Тогда
					СписокЭлементов.ДобавитьЗначение(СпрИтоговПоГоду.ТекущийЭлемент());
				КонецЕсли;
			КонецЦикла;
			// в справочнике должен быть только один элемент
			// с данными за каждый год 
			Элемент = СписокЭлементов.ПолучитьЗначение(1);
			СписокЭлементов.УдалитьЗначение(1);
			// лишние элементы (возможно, появившиеся в распределенных ИБ) - удалим
			Если СписокЭлементов.РазмерСписка() > 0 Тогда
				Для индСписка = 1 по СписокЭлементов.РазмерСписка() Цикл
					СпрИтоговПоГоду.НайтиЭлемент(СписокЭлементов.ПолучитьЗначение(индСписка));
					СпрИтоговПоГоду.Удалить(1);
				КонецЦикла;
				СписокЭлементов.УдалитьВсе();
			КонецЕсли;
			СпрИтоговПоГоду.НайтиЭлемент(Элемент);		
		КонецЕсли;
		
		СтрокаДанных = ЗначениеВСтроку(Карточка);
		СпрИтоговПоГоду.СписокПолейИндивидульнойКарточки = СтрокаДанных;
		СпрИтоговПоГоду.Записать();
		
		//чтобы не спрашивала о сохранении потом снова:
		Таблица.Выгрузить(ИсходнаяТаблица);
	КонецЕсли;
	
	//заполним буфер карточки с данными из справочника заново(остальные буферы не нужны)
	Если ТипЗначенияСтр(БуферРазделовСпр)<>"СписокЗначений" Тогда
		БуферРазделовСпр=СоздатьОбъект("СписокЗначений");
	КонецЕсли;
	БуферРазделовСпр.УдалитьВсе();
	
	Буфер=СоздатьОбъект("СписокЗначений");
	               
	//Запись реквизитов справочника "Сотрудники".
	Сотрудник = ФизЛицо;
	Если (ДатаГод(Сотрудник.ДатаПриема) = Год) и (ДатаМесяц(Сотрудник.ДатаПриема) > 1) Тогда
		Сотр = СоздатьОбъект("Справочник.Сотрудники");
		Сотр.НайтиЭлемент(Сотрудник);
		а = ДатаМесяц(Сотрудник.ДатаПриема) - 1;
		Изм = 0;
		
		ТекМесяц = "31.01." + Год;
		Для НомерМесяца = 1 по а Цикл
			Месяц = Формат(НомерМесяца,"Ч(0)2");
			
			БазаПФР = Таблица.Область("П105" + Месяц).Значение + Таблица.Область("П205" + Месяц).Значение;
			
			БазаПФРвСправочнике = Сотр.ДоходОблагаемыйПФР_СНачалаГода.Получить(ТекМесяц);
			Если БазаПФРвСправочнике <> БазаПФР Тогда
			    Сотр.ДоходОблагаемыйПФР_СНачалаГода.Установить(ТекМесяц, БазаПФР);
				Изм = 1;
			КонецЕсли;
			
			ТекМесяц = КонМесяца(ДобавитьМесяц(ТекМесяц, 1));
		КонецЦикла;
		
		НачисленныйПФР_страх_СНачалаГода = Таблица.Область("СНГ309" + Формат(а,"Ч(0)2")).Значение;
		НачисленныйПФР_нак_СНачалаГода 	 = Таблица.Область("СНГ310" + Формат(а,"Ч(0)2")).Значение;
		
		Если (Сотр.НачисленныйПФР_страх_СНачалаГода		<> НачисленныйПФР_страх_СНачалаГода)	или
			 (Сотр.НачисленныйПФР_нак_СНачалаГода		<> НачисленныйПФР_нак_СНачалаГода) 		Тогда
			 	                                   	
			Сотр.НачисленныйПФР_страх_СНачалаГода 	 = НачисленныйПФР_страх_СНачалаГода;
			Сотр.НачисленныйПФР_нак_СНачалаГода 	 = НачисленныйПФР_нак_СНачалаГода;
			
			Попытка
				Сотр.Записать();
			    Изм = 1;
				
			Исключение
				Предупреждение("Неудачная попытка записать начальные данные 
								|расчета ЕСН в справочник ""Сотрудники"".
								|Запись """+Сотрудник+""" заблокирована.");
				Возврат 0;
			КонецПопытки;
		КонецЕсли;
		
		Если Изм = 1 Тогда
			Сообщить("В справочник ""Сотрудники"" записаны начальные данные расчета ЕСН сотрудника "+Сотрудник);
		КонецЕсли;
	КонецЕсли;

	Возврат 1
	
КонецФункции //Сохранить


//******************************************************************************
// ПолучитьЗаголовок()
//
// Параметры:
//		ИмяОбл - Имя ячейки таблицы
// Вызывается при расшифровке ячеек таблицы индивидуальной карточки по ЕСН
//
// Возвращаемое значение
//		Название заголовка окна для ячейки, которую нужно расшифровать
//
// Описание:
//
Функция ПолучитьЗаголовокОкна(ИмяОбл)
	
	НомерМесяца = Число(Сред(ИмяОбл,2,2));
	Если (НомерМесяца<=12) и (НомерМесяца>=1) Тогда
		Если Прав(ИмяОбл,2)="02" Тогда
			ИмяЗаголовка = "Начислено выплат и иныхвознаграждений потрудовым, гражданск.-правов., авторскимдо говорам "+НазваниеМесяца[НомерМесяца];
		ИначеЕсли Прав(ИмяОбл,2)="03" Тогда
			ИмяЗаголовка = "Выплаты, не отнесенные к расходам, уменьшающим налоговую базу по налогу на прибыль организаций (выплаты, не уменьшающие налоговую базу по налогу на доходы физических лиц) п. 3 ст. 236" + НазваниеМесяца[НомерМесяца];
		ИначеЕсли Прав(ИмяОбл,2)="04" Тогда
			ИмяЗаголовка = "Выплаты, не подлежащие обложению (п. 1, 2  ст. 238 НК РФ)" +НазваниеМесяца[НомерМесяца];
		ИначеЕсли Прав(ИмяОбл,2)="05" Тогда
			ИмяЗаголовка = "База для начисления страховых взносов на ОПС (гр. 2 - гр. 3 -  гр. 4) дСВ (рСВ) р.2 стр. 0100 - 0140 гр. 6" +НазваниеМесяца[НомерМесяца];
		ИначеЕсли Прав(ИмяОбл,2)="09" Тогда
			ИмяЗаголовка = "Начислено авансовых платежей по страховым взносам на ОПС в том числе: страховая часть трудовой пенсии дСВ (рСВ) р.2 стр. 0300 - 0340 гр. 6" +НазваниеМесяца[НомерМесяца];
		ИначеЕсли Прав(ИмяОбл,2)="10" Тогда
			ИмяЗаголовка = "Начислено авансовых платежей по страховым взносам на ОПС в том числе: накопительная часть трудовой пенсии дСВ (рСВ) р.2 стр. 0400 - 0440 гр. 6" +НазваниеМесяца[НомерМесяца];
		КонецЕсли;
		
	    Возврат ИмяЗаголовка;
		
	КонецЕсли;

КонецФункции //ПолучитьЗаголовокОкна()



//******************************************************************************
// ЗаполнитьТаблицу(ОбобщеннаяТаблица)
//
// Параметры:
//		ОбобщеннаяТаблица - контекст формы, передан для заполнения данными.
//		УчитыватьСправочники - число 1 (по умолчанию) или 0, не обязателен; если равен 0 - данные из справочников не собираются.
//		СменаГода - число 0 (по умолчанию) или 1, не обязателен; если равен 1 - то не нужно проверять на предмет исправлнения
//							
// Возвращаемое значение:
//		0 или 1 - прервана (0) или нет (1) работа процедуры сбора доходов
//
// Описание:
//		заполняет переданную таблицу обработанными данными о доходах
//		
Функция ЗаполнитьТаблицу(ОбобщеннаяТаблица,УчитыватьСправочники=1)
	
	// соберем данные о доходах
	ДоходыВычетыНалогиСотрудников = "";
	ДопДанныеФизЛица = "";
	// проверим, удалось ли получить доходы нашего сотрудника
	Если глСобратьДанныеДляЕСН(ДоходыВычетыНалогиСотрудников,ФизЛицо,КонГода(Дата(Год,12,15)),,,УчитыватьСправочники,1,,,ДопДанныеФизЛица) <> 1 Тогда
		Возврат 0   
	КонецЕсли;
	
	СтрокаИтоговойТаблицы = 0;
	
	// в буфер складываются значения, которые могут попасть в ячейки для ввода
	// нередактируемые (рассчитываемые итоговые) значения сразу помещаем в реквизит Текст ячеек таблицы
	Буфер=СоздатьОбъект("СписокЗначений");
	Карточка = ОбобщеннаяТаблица.Таблица;
	БуферРазделовСпр=СоздатьОбъект("СписокЗначений");
	ТаблицаРасшифровокПоВР=СоздатьОбъект("ТаблицаЗначений");
	
	глЗаполнитьИндивидуальнуюКарточкуПоОПС(ФизЛицо,Год,0,ДоходыВычетыНалогиСотрудников,СтрокаИтоговойТаблицы,Буфер,ПоследнийМесяц,БуферРазделовСпр,ТаблицаРасшифровокПоВР,,ДопДанныеФизЛица);
	                                                                                                                           
	// загружаем значения редактируемых ячеек
	Карточка.Загрузить(Буфер);
	
	// запоминаем "образ" таблицы для последующих проверок
	ИсходнаяТаблица = СоздатьОбъект("СписокЗначений");
	Карточка.Выгрузить(ИсходнаяТаблица);
	
	Возврат 1
	
КонецФункции //ЗаполнитьТаблицу

//*****************************************************************************
// ЗаполнитьПоНДФЛ()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		Заполнить
//
// Возвращаемое значение
//		нет
//
// Описание
//		заполняет поля для ввода данными, взятыми из налоговой карточки 1-НДФЛ 
//
Процедура ЗаполнитьПоНДФЛ()
	
	// если в карточке есть какие-либо цифры - спросим, точно ли нужно все перезаполнить
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	
	// просто просуммируем квадраты всех введенных чисел; если есть хоть одно число - сумма получится ненулевой
	СуммаВсехЧисел = 0;
	Для Сч = 1 По СЗТекущееСостояние.РазмерСписка()  Цикл
		Зн = СЗТекущееСостояние.ПолучитьЗначение(Сч);
		Если ТипЗначения(Зн) = 1 Тогда
			СуммаВсехЧисел = СуммаВсехЧисел + Зн * Зн
		КонецЕсли;
		Если СуммаВсехЧисел <> 0 Тогда
			Прервать
		КонецЕсли;
	КонецЦикла;
	
	Если СуммаВсехЧисел <> 0 Тогда
		Если Вопрос("Перед заполнением карточка будет очищена."
		"Продолжить?","Да+Нет")="Нет" Тогда
			Возврат
		КонецЕсли;
	КонецЕсли;
	
	// Очистим числовое поле карточки
	Таблица.Область("ПолеЧисел1").Значение=0;
	Таблица.Область("ПолеЧисел2").Значение=0;
	Таблица.Область("ПолеЧисел3").Значение=0;
	
	// теперь уберем нули
	Для Сч = 1 По 12 Цикл
		МесяцСтрокой = глДополнитьСтроку(Сч,2);
		Таблица.Область("П106"+МесяцСтрокой).Текст = "";
		Таблица.Область("П107"+МесяцСтрокой).Текст = "";
		Таблица.Область("П206"+МесяцСтрокой).Текст = "";
		Таблица.Область("П207"+МесяцСтрокой).Текст = "";
		Таблица.Область("П306"+МесяцСтрокой).Текст = "";
		Таблица.Область("П307"+МесяцСтрокой).Текст = "";		
		Таблица.Область("СНГ106"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ107"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ206"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ207"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ306"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ307"+МесяцСтрокой).Текст = "";	
	КонецЦикла;
	
	ЗаполнитьТаблицу(Контекст, 0); 
	СЗТекущееСостояние.Выгрузить(ИсходнаяТаблица);
		
КонецПроцедуры //ЗаполнитьПоНДФЛ

//*****************************************************************************
// Очистить(Спрашивать = 1)
//
// Параметры
//		Спрашивать - число 1 или 0 - проверять ли заполненность карточки
//		ТекстВопроса - передается непустая строка, если надо задать свой текст вопроса
//
// Вызывается из формул элементов диалога
//		Очистить
//
// Возвращаемое значение
//		0 - если от очистки отказались
//
// Описание
//		очищает все поля ввода и зависимые от них расчетные поля для 
//		последующего заполнения
//
Функция Очистить(Спрашивать = 1, ТекстВопроса="")
	
	Если Спрашивать = 1 Тогда
		
		// если в карточке есть какие-либо цифры - спросим, точно ли нужно все перезаполнить
		СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
		Таблица.Выгрузить(СЗТекущееСостояние);
		
		// просто просуммируем квадраты всех введенных чисел; если есть хоть одно число - сумма получится ненулевой
		СуммаВсехЧисел = 0;
		Для Сч = 1 По СЗТекущееСостояние.РазмерСписка()  Цикл
			Зн = СЗТекущееСостояние.ПолучитьЗначение(Сч);
			Если ТипЗначения(Зн) = 1 Тогда
				СуммаВсехЧисел = СуммаВсехЧисел + Зн * Зн
			ИначеЕсли ПустоеЗначение(Зн) = 0 Тогда
				СуммаВсехЧисел = 1	
			КонецЕсли;
			Если СуммаВсехЧисел <> 0 Тогда
				Прервать
			КонецЕсли;
		КонецЦикла;
		
		Если СуммаВсехЧисел <> 0 Тогда
			Если ТекстВопроса="" Тогда
			   ТекстВопроса="Карточка будет очищена.
			|Продолжить?";  
			КонецЕсли;
			Если Вопрос(ТекстВопроса,"Да+Нет")="Нет" Тогда
				Возврат 0;
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
	П001 = "";
	П002 = "";
	П003 = "";
	П004 = "";
	Таблица.Область("ПолеЧисел1").Значение=0;
	Таблица.Область("ПолеЧисел2").Значение=0;
	Таблица.Область("ПолеЧисел3").Значение=0;
	
	// теперь уберем нули
	Для Сч = 1 По 12 Цикл
		МесяцСтрокой = глДополнитьСтроку(Сч,2);
		Таблица.Область("П106"+МесяцСтрокой).Текст = "";
		Таблица.Область("П107"+МесяцСтрокой).Текст = "";
		Таблица.Область("П206"+МесяцСтрокой).Текст = "";
		Таблица.Область("П207"+МесяцСтрокой).Текст = "";
		Таблица.Область("П306"+МесяцСтрокой).Текст = "";
		Таблица.Область("П307"+МесяцСтрокой).Текст = "";		
		Таблица.Область("СНГ106"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ107"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ206"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ207"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ306"+МесяцСтрокой).Текст = "";
		Таблица.Область("СНГ307"+МесяцСтрокой).Текст = "";	
	КонецЦикла;
	
	Возврат 1;
	
КонецФункции //Очистить

//*****************************************************************************
// Восстановить()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		Восстановить
//
// Возвращаемое значение
//		нет
//
// Описание
//		повторно заполняет таблицу по данным, имеющимся в информационной базе
//
Процедура Восстановить()
	Если Вопрос("Текущие данные будут потеряны!"+РазделительСтрок+"Восстановить сохраненные ранее данные?","Да+Нет")="Нет" Тогда
		Возврат;
	КонецЕсли;
	Очистить(0); 
	ЗаполнитьТаблицу(Контекст);
КонецПроцедуры //Восстановить

//*****************************************************************************
// ПриВыбореГода()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		СпЛет
//
// Возвращаемое значение
//		нет
//
// Описание
//		карточка перезаполняется данными выбранного года, если был выбран
//		другой год
//
Процедура ПриВыбореГода()
	НовыйГод = СпЛет.ПолучитьЗначение(СпЛет.ТекущаяСтрока());
	Если Год <> НовыйГод Тогда // выбран другой год - перезаполняем таблицу	
		Если Сохранить() = 0 Тогда
			Возврат
		КонецЕсли;
		//определим ставки налогов:
		Очистить(0);
		Год = НовыйГод;
		ОпределитьСтавки();
		
		//запомним как бы она выглядела без данных справочника:
		ЗаполнитьТаблицу(Контекст,1);
		ИсходнаяТаблица.Выгрузить(ИсходнаяТаблицаБезСправочников); 
		
		// заполняем данными ячейки таблицы для ввода
		Форма.Заголовок(" за "+Год+" год: "+ФизЛицо.Наименование,1);
	КонецЕсли;

КонецПроцедуры //ПриВыбореГода

//*****************************************************************************
// Пересчитать()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		Пересчитать
//
// Возвращаемое значение
//		нет
//
// Описание
//		перезаполняет карточку актуальными на текущий момент данными
//
Процедура Пересчитать() 	
	Если Сохранить() = 0 Тогда
		Возврат
	КонецЕсли;
	Очистить(0);			
	ЗаполнитьТаблицу(Контекст);
КонецПроцедуры //Пересчитать

//******************************************************************************
// Предопределенная процедура
//
Процедура ПриОткрытии()
	
	Если ТипЗначенияСтр(Форма.Параметр)="СписокЗначений" Тогда
		
		Параметры = Форма.Параметр;
		
		// основные параметры
		ДатаГода = Параметры.Получить("ДатаАктуальности");
		ФизЛицо = Параметры.Получить("Сотрудник");
		
		Год = ДатаГод(ДатаГода);
		
		// запомним названия месяцев - они используются при формировании текста предупреждения
		НазваниеМесяца[1] = "Январе"; 
		НазваниеМесяца[2] = "Феврале";
		НазваниеМесяца[3] = "Марте";   
		НазваниеМесяца[4] = "Апреле"; 
		НазваниеМесяца[5] = "Мае";     
		НазваниеМесяца[6] = "Июне";    
		НазваниеМесяца[7] = "Июле"; 	
		НазваниеМесяца[8] = "Августе";     
		НазваниеМесяца[9] = "Сентябре";    
		НазваниеМесяца[10]= "Октябре";      
		НазваниеМесяца[11]= "Ноябре";       
		НазваниеМесяца[12]= "Декабре";     
		
		НачальныйГод = 2004;
		КонечныйГод = 2009;
		
		Если НачальныйГод>КонечныйГод Тогда
			СпЛет.ДобавитьЗначение(2004,"2004 г.");
			СпЛет.ТекущаяСтрока(1);
		Иначе
			Для ГодВСписок = НачальныйГод По КонечныйГод Цикл
				СпЛет.ДобавитьЗначение(ГодВСписок,Строка(ГодВСписок)+" г.");	
			КонецЦикла;	
			//в 1-м квартале будем устанавливать по умолчанию прошлый год, а дальше текущий год
			НомерМесяца = ДатаМесяц(РабочаяДата());
			Если НомерМесяца<=3 Тогда
				СпЛет.ТекущаяСтрока(СпЛет.РазмерСписка()-1);
			Иначе
				СпЛет.ТекущаяСтрока(СпЛет.РазмерСписка());
			КонецЕсли;
		КонецЕсли;

		СтрокаТекущегоГода = СпЛет.ТекущаяСтрока();
		
		Если СтрокаТекущегоГода <> 0 Тогда 
			
			Год = СпЛет.ПолучитьЗначение(СтрокаТекущегоГода);
			
			// подготовим дополнительные данные для исчисления ЕСН
			РегрессивнаяШкала = Константа.ИспользоватьРегрессивнуюШкалу;
			ЕстьЕНВД = 1;
			
			// для расчета взносов в ПФР используется отдельная константа
			РегрессивнаяШкалаПФР = Константа.ИспользоватьРегрессивнуюШкалуПФР;
			
			// ставки ЕСН запомним в массивах - так их легче использовать
			//определим ставки налогов:
			ОпределитьСтавки();

			// заполняем данными ячейки таблицы для ввода
			ЗаполнитьТаблицу(Контекст);
			Таблица.Опции(0,0,,,"ИК","ИК");
			Таблица.ПараметрыСтраницы(2,,,0,0,0,0,0,0,0,1);
			Форма.Заголовок(" за "+Год+" год: "+ФизЛицо.Наименование,1);
			
		Иначе
			Предупреждение("За "+Год+" год формирование Индивидуальных карточек по ЕСН не поддерживается!");	
			СтатусВозврата(0);
		КонецЕсли;
		
	Иначе
		Предупреждение("Эта обработка используется в системных целях!",6);
		СтатусВозврата(0);
	КонецЕсли;
КонецПроцедуры // ПриОткрытии   

//******************************************************************************
// Предопределенная процедура
//
Процедура ПриЗакрытии() //предопределенная
	
	// проверим, редактировали ли значения в таблице
	// если что-то изменилось - спросим, а не сохранить ли
	
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	Если глСпискиИдентичны(СЗТекущееСостояние,ИсходнаяТаблица) = 0 Тогда
		Ответ=Вопрос("Сохранить изменения?","Да+Нет+Отмена");
		Если  Ответ="Да"  Тогда
			Если Сохранить() = 0 Тогда
				СтатусВозврата(0)
			КонецЕсли;
		ИначеЕсли Ответ="Отмена"  Тогда
			СтатусВозврата(0)
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры //ПриЗакрытии

//******************************************************************************
// ЗаполнитьБезСправочниковОбласть()      
//
// Параметры:
//		ИмяОбл - имя области
//
// Описание:
//		Восстановление области карточки без "ручных" правок.
//
Процедура ЗаполнитьБезСправочниковОбласть(Знач ИмяОбл)
	
	Если (Сред(ИмяОбл,2,3) <> "14г") и (Сред(ИмяОбл,2,3) <> "203") Тогда
		Если Таблица.Область(ИмяОбл).Доступность()=1 Тогда
			Таблица.Область(ИмяОбл).Значение = ИсходнаяТаблицаБезСправочников.Получить(ИмяОбл);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры //ЗаполнитьБезСправочниковОбласть()

//******************************************************************************
// ЗаполнитьБезСправочников()      
//
// Параметры:
//		нет
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Если в карточке есть ручные правки (ярко-желтые поля?), то будет задан вопрос о подтверждении намерения и  
//		карточка переформируется по данным только из журналов расчетов.
//
Процедура ЗаполнитьБезСправочников()
	
	ТекстВопроса=	
	"Карточка будет очищена. 
	|Продолжить?";
	ТаблицаДо = "";
	ИсходнаяТаблица.Выгрузить(ТаблицаДо); //чтобы не забыть потом сохранить преобразованную таблицу, запомним как она сейчас выглядит
	Если Очистить(1,ТекстВопроса)=1 Тогда
		ЗаполнитьТаблицу(Контекст,2);
		//Запомним состояние:
		ТаблицаДо.Выгрузить(ИсходнаяТаблица);
	КонецЕсли;
	
КонецПроцедуры //ЗаполнитьБезСправочников()

//******************************************************************************
// ПолучитьРасшифровку()
//
// Параметры:
//		нет
//
// Выполняется при нажатии на кнопку "Раскрыть (F5)"
//
// Возвращаемое значение
//		нет
//
// Описание:
//		пытаемся разложить сумму текущей активной ячейки на две составляющие:
//		по данным ЖЗ
//		по введенным вручную суммам
//
Процедура ПолучитьРасшифровку()

	// проверим, редактировали ли значения в таблице
	// если что-то изменилось - спросим, а не сохранить ли
	
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	Если глСпискиИдентичны(СЗТекущееСостояние,ИсходнаяТаблица) = 0 Тогда
		Ответ=Вопрос(	"Таблица была изменена.
		|Расшифровка текущей ячейки может быть показана неверно. 
		|Сохранить изменения?","Да+Нет+Отмена");
		Если  Ответ="Да"  Тогда
			Если Сохранить() = 0 Тогда
				СтатусВозврата(0);
				Возврат;
			КонецЕсли;
		ИначеЕсли Ответ="Отмена"  Тогда
			СтатусВозврата(0);
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	СписокИмен = СписокРедактируемыхЯчеек(1);
	ИмяОбл = СокрЛП(Таблица.АктивнаяОбласть());
	
	Если СписокИмен.НайтиЗначение(ИмяОбл)=0 Тогда
		Предупреждение("Расшифровка данной ячейки не поддерживается");
		Возврат;
	Иначе
		ЗаголовокОкна = ПолучитьЗаголовокОкна(ИмяОбл);
	КонецЕсли;
	
	ИтЗначение=0;
	
	Таб=СоздатьОбъект("Таблица");
	Таб.ИсходнаяТаблица("Расшифровка");
	
	ИмяКолонки="Сумма";
	
	ИмяЗаглКолонки="Вид расчета";
	Таб.ВывестиСекцию("Шапка");		
    СчСтрокВР = "";
	БылоЗначение=0;
	Если ТаблицаРасшифровокПоВР.НайтиЗначение(глДополнитьСтроку(ИмяОбл,10," ",1),СчСтрокВР,1) = 1 Тогда
		ТаблицаСуммпоВР=ТаблицаРасшифровокПоВР.ПолучитьЗначение(СчСтрокВР,2); 
		Если ТипЗначенияСтр(ТаблицаСуммпоВР)="ТаблицаЗначений" Тогда
			Для Сч = 1 По ТаблицаСуммпоВР.КоличествоСтрок() Цикл
				ИмяСтроки=ТаблицаСуммпоВР.ПолучитьЗначение(Сч,1);
				Значение= ТаблицаСуммпоВР.ПолучитьЗначение(Сч,2);
				Таб.ВывестиСекцию("стр");
				ИтЗначение=ИтЗначение+Значение ;
				БылоЗначение=1;
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;

	Если БылоЗначение=1 Тогда
		ИмяСтроки="Итого:";
		Значение= ИтЗначение;
		Таб.ВывестиСекцию("подитог");
	Иначе 
		Значение= 0;
		Таб.ВывестиСекцию("стр");
	КонецЕсли;
	
	Если БылоЗначение = 0 Тогда
		Значение = Буфер.Получить(ИмяОбл);
		Если ПустоеЗначение(Значение) = 0 Тогда
			ИмяСтроки="По данным, введенным вручную";
			Таб.ВывестиСекцию("стр");
			ИтЗначение=ИтЗначение+Значение ;
		КонецЕсли;
	КонецЕсли;
	Таб.ВывестиСекцию("Итог");
	
	Таб.ТолькоПросмотр(1);
	Таб.Опции(0,0,0,0);
	Таб.Показать(ЗаголовокОкна);
	
КонецПроцедуры //ПолучитьРасшифровку()
