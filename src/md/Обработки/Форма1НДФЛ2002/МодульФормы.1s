Перем ИсходнаяТаблица;
Перем Год;
Перем Резидент;
Перем ИсходнаяТаблицаБезСправочников; //это будет таблица , сформированная при открытии карточки без данных справочника
Перем СписокВводаРаздела5; // список 5-ых разделов

Перем ПерваяЯчейкаРаздела3;
Перем ПерваяЯчейкаСтандартныхВычетовРаздела3;
Перем ПерваяЯчейкаВычетовРаздела3;
Перем ПерваяЯчейкаУдержанныхНалоговРаздела3;
Перем ПерваяЯчейкаРаздела4;
Перем ПерваяЯчейкаРаздела5;
Перем ПерваяЯчейкаРаздела7;
Перем ПерваяЯчейкаРаздела8;

Перем СтавкаНДФЛ;
Перем СтавкаПоДивидендам;
Перем СтавкаПоМВ;

Перем СальдоНаНачалоГода;

Перем ПоследнийМесяц;
Перем ПервыйМесяцРасчетов;

Перем ОткрывалиФормуВводаВычетов;
Перем СпВычетовПоАвторским;

Перем СписокПрочихПолейКарточки;
Перем ДоходыВычетыНалогиСотрудников;

Перем ВидыДоходов;
Перем СпрТипыВычетов;
Перем ИменаИтоговКарточки;

Перем СпрВидыДоходов;
Перем СуммаСПредМестаРаботы;

Перем ВычетыСотрудниковПоНДФЛ;
Перем ВидыВычетов;

Процедура ПриВводеСуммИзменяющихСальдо(ЧастьИмени = "") далее
Процедура ОбновитьРаздел6() далее

//******************************************************************************
//	СпискиИдентичны(СЗ1,СЗ2)
//
//	Параметры:
//		СЗ1	- список значений
//		СЗ2	- список значений
//
//	Возвращаемое значение:
//		1 - два списка идентичны
//		0 - два списка различны
//
//	Описание:
//		Функция сравнивает два списка значений по каждому значению и представлению.
//
Функция СпискиИдентичны(СЗ1,СЗ2) 
	Перем Представление1,Представление2;
	
	Если СЗ1.РазмерСписка()<>СЗ2.РазмерСписка() Тогда
		Возврат 0
	КонецЕсли;
	Для Номер = 1 по СЗ1.РазмерСписка() Цикл
		Зн1=СЗ1.ПолучитьЗначение(Номер,Представление1);
		Зн2=СЗ2.ПолучитьЗначение(Номер,Представление2);
		Если Представление1<>Представление2 Тогда
			Возврат 0
		КонецЕсли;
		ТипЗн1 = ТипЗначенияСтр(Зн1);
		ТипЗн2 = ТипЗначенияСтр(Зн2);
		Если ТипЗн1<>ТипЗн2 Тогда
		    Возврат 0
		КонецЕсли;
		Если ТипЗн1 = "СписокЗначений" Тогда
			Если СпискиИдентичны(Зн1,Зн2) = 1 Тогда
			    Продолжить
			Иначе
				Возврат 0
			КонецЕсли;
		ИначеЕсли ТипЗн1 = "ТаблицаЗначений" Тогда
		    Сп1 = СоздатьОбъект("СписокЗначений");
		    Сп2 = СоздатьОбъект("СписокЗначений");
			Зн1.Выгрузить(Сп1);
			Зн1 = "";
			Зн2.Выгрузить(Сп2);
			Зн2 = "";
			Если СпискиИдентичны(Сп1,Сп2) = 1 Тогда
			    Продолжить
			Иначе
				Возврат 0
			КонецЕсли;
		КонецЕсли;
		Если Зн1<>Зн2 Тогда
			Возврат 0
		КонецЕсли;
	КонецЦикла;
	Возврат 1
	
КонецФункции	// СпискиИдентичны

//******************************************************************************
//	СоздатьТаблицу5Раздела()
//
Функция СоздатьТаблицу5Раздела() 
	
	Таблица5Раздела = СоздатьОбъект("ТаблицаЗначений");
	Таблица5Раздела.НоваяКолонка("МесяцДохода", "Число", 2);
	Таблица5Раздела.НоваяКолонка("КодДохода", "Строка", 4);
	Таблица5Раздела.НоваяКолонка("КодВычета", "Строка", 4);
	Таблица5Раздела.НоваяКолонка("СуммаДохода", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("СуммаВычета", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("НБ", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("НИ", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("НУ", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("ДолгНП", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("ДолгНА", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("Взыскание", "Число", 15, 2);
	Таблица5Раздела.НоваяКолонка("Возвращена", "Число", 15, 2);
	
	Возврат Таблица5Раздела;
	
КонецФункции // СоздатьТаблицу5Раздела()

// процедуры, реализующие автоматический пересчет всех зависимых данных при 
// редактировании какого-либо значения

//*****************************************************************************
// УчестьСуммуСальдо()
//
Процедура УчестьСуммуСальдо()
	
	ДолгНП = Таблица.Область("П001").Значение;
	ДолгНА = Таблица.Область("П002").Значение;
	
	ПоследнийМесяц = ?(ПоследнийМесяц = 0,1,ПоследнийМесяц);
	
	Если Резидент = 1 Тогда
		Для Сч = 1 По ПоследнийМесяц Цикл 
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=Число(ТекстИсч);
			УдержаноОсн=Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн + ДолгНП - ДолгНА;    
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
	
 	Иначе 
		ИсчисленоОсн = 0; УдержаноОсн =0;
		Для Сч = 1 По ПоследнийМесяц Цикл 
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=ИсчисленоОсн + Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн + Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн + ДолгНП - ДолгНА;    
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
	КонецЕсли;    		
	
	Таблица.Область("ИМДолгНП").Текст	= Таблица.Область("МДолгНП"+глДополнитьСтроку(ПоследнийМесяц,2)).Текст;
	Таблица.Область("ИМДолгНА").Текст	= Таблица.Область("МДолгНА"+глДополнитьСтроку(ПоследнийМесяц,2)).Текст;	
	
КонецПроцедуры // УчестьСуммуСальдо()

//*****************************************************************************
// ПриВводеСальдо()
//
// Вызывается из ячеек таблицы 1-НДФЛ
//		П002 и П003
//
// Описание
//		обновляет ячейки, где записано значение выходного сальдо
//
Процедура ПриВводеСальдо(Знач ИмяОбл="")
	
	Если ИмяОбл="" Тогда
		ИмяОбл = Таблица.АктивнаяОбласть();
	КонецЕсли;
	Признак=Прав(ИмяОбл,1); // определим, какую ячейку сальдо отредактировали
	
	Если Признак = "1"  Тогда		
		Если П001<0 Тогда
			П002=-П001;
			П001=0;
		ИначеЕсли П001>0 Тогда
			П002=0;
		КонецЕсли;
	Иначе		
		Если П002<0 Тогда
			П001=-П002;
			П002=0;
		ИначеЕсли П002>0 Тогда
			П001=0;
		КонецЕсли;
	КонецЕсли;
	
	УчестьСуммуСальдо();
	ОбновитьРаздел6();
 	
КонецПроцедуры // ПриВводеСальдо

//******************************************************************************
// ПриВыбореТипаДохода()
//
// Параметры:
//		ИмяОбл - можно передать имя области 
//
// Вызывается из ячеек области ТипыДоходов таблицы 1-НДФЛ (раздел 3)
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Если в ячейках выбраны коды доходов, облагаемых частично согласно  
//		ст. 217 НК РФ, подставляется соответствующий код вычета.
//
Процедура ПриВыбореТипаДохода(Знач ИмяОбл="")
	
	Если ИмяОбл="" Тогда
		ИмяОбл = Таблица.АктивнаяОбласть();
	КонецЕсли;
	ВидыДоходов = СоздатьОбъект("Справочник.ВидыДоходов");
	ВидыДоходов.НайтиПоКоду(Таблица.Область(ИмяОбл).Значение);
	Доход = ВидыДоходов.ТекущийЭлемент(); 
	Если Доход.Выбран()=0 Тогда
		Скидки=СоздатьОбъект("СписокЗначений");
		Для Сч = 1 По 5  Цикл 
			ВидыДоходов.НайтиПоКоду(Таблица.Область("П"+глДополнитьСтроку((Сч - 1)*13+ПерваяЯчейкаРаздела3,3)).Значение);
			Доход = ВидыДоходов.ТекущийЭлемент(); 
			Если Доход.Выбран()=1 Тогда
				Если (Доход.ВидВычета.Выбран()=1) Тогда
					Скидки.ДобавитьЗначение(Доход.ВидВычета.Код);
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		Для Сч = 1 По 5  Цикл
			Скидка = Таблица.Область("П"+глДополнитьСтроку((5+Сч - 1)*13+ПерваяЯчейкаРаздела3,3)).Значение;
			Если ПустоеЗначение(Скидка) = 0 Тогда
				Если Скидки.Принадлежит(Скидка)=0 Тогда
					Таблица.Область("П"+глДополнитьСтроку((5+Сч - 1)*13+ПерваяЯчейкаРаздела3,3)).Значение="Код"
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
	Иначе
		Скидка = Доход.ВидВычета;
		Если Скидка.Выбран()=1 Тогда 
			Осмотрели=0;
			Нашли=0;
			Пока Осмотрели<5  Цикл
				НайденнаяСкидка=Прав(Таблица.Область("П"+глДополнитьСтроку((5+Осмотрели)*13+ПерваяЯчейкаРаздела3,3)).Значение,3);
				Если ПустоеЗначение(НайденнаяСкидка) = 1 Тогда
					ПустаяЯчейка = Осмотрели;
				ИначеЕсли НайденнаяСкидка=Скидка.Код Тогда
					Нашли=1;
					Прервать
				КонецЕсли;
				Осмотрели=Осмотрели+1;
			КонецЦикла;
			Если (Нашли=0) и (Осмотрели<=5) Тогда
				Таблица.Область("П"+глДополнитьСтроку((5+ПустаяЯчейка)*13+ПерваяЯчейкаРаздела3,3)).Значение=?(ПустоеЗначение(Скидка) = 1, "", "Код " + Скидка.Код);
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры // ПриВыбореТипаДохода

//******************************************************************************
// ОбновитьРаздел6()
//
// Параметры:
//		нет
//
// Возвращаемое значение
//		нет
//
// Описание:
//		обновляются расчетные ячейки Раздела 6 и сальдо на конец года  
//		по возможно изменившимся значениям других итоговых ячеек
//
Процедура ОбновитьРаздел6()
		
 	// Обновление раздела 6.
	Если Резидент=1 Тогда  
		
		// исчислено
		Таблица.Область("ОбщСт6НИ").Текст=Таблица.Область("ИНД6И").Текст;
		Таблица.Область("ОбщСт13НИ").Текст=Таблица.Область("ИНИ").Текст;
		// удержано
		Таблица.Область("П272").Текст=Таблица.Область("ИНУ").Текст;
		Таблица.Область("ОбщСт6НУ").Текст=Таблица.Область("ИДивНУ").Текст;
		// долг по налогу
		Таблица.Область("ОбщСт13ДНП").Текст = Таблица.Область("ИМДолгНП").Текст;
		Таблица.Область("ОбщСт13ДНА").Текст = Таблица.Область("ИМДолгНА").Текст;
		Таблица.Область("ОбщСт6ДНП").Текст = Таблица.Область("ИДДолгНП").Текст;
		Таблица.Область("ОбщСт6ДНА").Текст = Таблица.Область("ИДДолгНА").Текст;
		// ВЗЫСКАНО
		//ОбщСт6Взыск  И ПР.
		// 5 раздел, надо собрать данные из таблицы, а не просто взять число из карточки. 
		ОбщСт35НИ = 0;
		П274 = 0;
		ИДолг35НП_1 = 0;
	    ИДолг35НА_1 = 0;
		ВсегоВзыскание5 = 0;
		ВсегоВозвращено5 = 0;
		Для Сч = 1 По  СписокВводаРаздела5.РазмерСписка() Цикл
			ТаблПятогоРаздела = СписокВводаРаздела5.ПолучитьЗначение(Сч); 
			ТаблПятогоРаздела.ВыбратьСтроки(); 
			Пока ТаблПятогоРаздела.ПолучитьСтроку() = 1 Цикл
				ОбщСт35НИ = ОбщСт35НИ + ТаблПятогоРаздела.НИ;
				П274 = П274 + ТаблПятогоРаздела.НУ;
				ВсегоВзыскание5 = ВсегоВзыскание5 + ТаблПятогоРаздела.Взыскание;
				Если ТаблПятогоРаздела.НомерСтроки = ТаблПятогоРаздела.КоличествоСтрок() тогда
					ИДолг35НП_1 = ИДолг35НП_1 + ТаблПятогоРаздела.ДолгНП;
					ИДолг35НА_1 = ИДолг35НА_1 + ТаблПятогоРаздела.ДолгНА; 
				КонецЕсли;
			КонецЦикла;
		КонецЦикла; 
		Таблица.Область("ОбщСт35НИ").Текст = ОбщСт35НИ;
		Таблица.Область("П274").Текст = П274;             

		Таблица.Область("ОбщСт6Взыск").Текст = (Таблица.Область("ИДНалВзыск").Текст);
		Таблица.Область("ОбщСт13Взыск").Текст = (Таблица.Область("ИНалВзыск").Текст);
		Таблица.Область("ОбщСт35Взыск").Текст = Формат(ВсегоВзыскание5, "Ч015.2");
		
		Сальдо6 = Число(Таблица.Область("ОбщСт6НИ").Текст) - Число(Таблица.Область("ОбщСт6НУ").Текст) - Число(Таблица.Область("ОбщСт6Взыск").Текст) + Число(Таблица.Область("ОбщВозвр6").Текст) - Число(Таблица.Область("ОбщЗач6").Текст);
		Таблица.Область("ОбщСт6ДНП").Текст = Формат(Макс(Сальдо6, 0), "Ч015.2");
		Таблица.Область("ОбщСт6ДНА").Текст = Формат(Макс(-Сальдо6, 0), "Ч015.2");

		Сальдо13 = Число(Таблица.Область("ОбщСт13НИ").Текст) - Число(Таблица.Область("П272").Текст) - Число(Таблица.Область("ОбщСт13Взыск").Текст) + Число(Таблица.Область("ОбщВозвр13").Текст) - Число(Таблица.Область("ОбщЗач13").Текст);
		Таблица.Область("ОбщСт13ДНП").Текст = Формат(Макс(Сальдо13, 0), "Ч015.2");
		Таблица.Область("ОбщСт13ДНА").Текст = Формат(Макс(-Сальдо13, 0), "Ч015.2");		
		
		Сальдо35 = Число(Таблица.Область("ОбщСт35НИ").Текст) - Число(Таблица.Область("П274").Текст) - Число(Таблица.Область("ОбщСт35Взыск").Текст) + Число(Таблица.Область("ОбщВозвр35").Текст) - Число(Таблица.Область("ОбщЗач35").Текст);
		Таблица.Область("ОбщСт35ДНП").Текст = Формат(Макс(Сальдо35, 0), "Ч015.2");
		Таблица.Область("ОбщСт35ДНА").Текст = Формат(Макс(-Сальдо35, 0), "Ч015.2");		
		
	ИначеЕсли Год >= 2008 Тогда // у нерезидента с 2008 года дивиденды показываем отдельно
		
		// долг по налогу
		Таблица.Область("ОбщСт30ДНП").Текст=Таблица.Область("ИМДолгНП").Текст;
		Таблица.Область("ОбщСт30ДНА").Текст=Таблица.Область("ИМДолгНА").Текст;
		Таблица.Область("ОбщСт6ДНП").Текст = Таблица.Область("ИДДолгНП").Текст;
		Таблица.Область("ОбщСт6ДНА").Текст = Таблица.Область("ИДДолгНА").Текст;
		
		// исчислено
		Таблица.Область("ОбщСт30НИ").Текст=Таблица.Область("ИНИ").Текст;
		Таблица.Область("ОбщСт6НИ").Текст=Таблица.Область("ИНД6И").Текст;
		// удержано
		Таблица.Область("П273").Текст=Таблица.Область("ИНУ").Текст;
		Таблица.Область("ОбщСт6НУ").Текст=Таблица.Область("ИДивНУ").Текст;		
		Таблица.Область("ОбщСт30Взыск").Текст = Таблица.Область("ИНалВзыск").Текст;
		
		Сальдо30 = Число(Таблица.Область("ОбщСт30НИ").Текст) - Число(Таблица.Область("П273").Текст) - Число(Таблица.Область("ОбщСт30Взыск").Текст) + Число(Таблица.Область("ОбщВозвр30").Текст) - Число(Таблица.Область("ОбщЗач30").Текст);
		Таблица.Область("ОбщСт30ДНП").Текст = Формат(Макс(Сальдо30, 0), "Ч015.2");
		Таблица.Область("ОбщСт30ДНА").Текст = Формат(Макс(-Сальдо30, 0), "Ч015.2");
	Иначе			
		
		// долг по налогу
		Таблица.Область("ОбщСт30ДНП").Текст=Таблица.Область("ИМДолгНП").Текст;
		Таблица.Область("ОбщСт30ДНА").Текст=Таблица.Область("ИМДолгНА").Текст;
		// исчислено
		Таблица.Область("ОбщСт30НИ").Текст=Таблица.Область("ИНИ").Текст;
		// удержано
		Таблица.Область("П273").Текст=Таблица.Область("ИНУ").Текст;		
		Таблица.Область("ОбщСт30Взыск").Текст = Таблица.Область("ИНалВзыск").Текст;
		
		Сальдо30 = Число(Таблица.Область("ОбщСт30НИ").Текст) - Число(Таблица.Область("П273").Текст) - Число(Таблица.Область("ОбщСт30Взыск").Текст) + Число(Таблица.Область("ОбщВозвр30").Текст) - Число(Таблица.Область("ОбщЗач30").Текст);
		Таблица.Область("ОбщСт30ДНП").Текст = Формат(Макс(Сальдо30, 0), "Ч015.2");
		Таблица.Область("ОбщСт30ДНА").Текст = Формат(Макс(-Сальдо30, 0), "Ч015.2");		
	КонецЕсли; 
	
	// строка "Итого"
	Таблица.Область("ОбщНИ").Текст=Число(Таблица.Область("ОбщСт6НИ").Текст) + Число(Таблица.Область("ОбщСт13НИ").Текст)+Число(Таблица.Область("ОбщСт30НИ").Текст)+Число(Таблица.Область("ОбщСт35НИ").Текст);
	Таблица.Область("ОбщНУ").Текст=Число(Таблица.Область("ОбщСт6НУ").Текст) + Число(Таблица.Область("П272").Текст)+Число(Таблица.Область("П273").Текст)+Число(Таблица.Область("П274").Текст);
	Таблица.Область("ИОбщСтДНП").Текст=Число(Таблица.Область("ОбщСт6ДНП").Текст) + Число(Таблица.Область("ОбщСт13ДНП").Текст)+Число(Таблица.Область("ОбщСт30ДНП").Текст)+Число(Таблица.Область("ОбщСт35ДНП").Текст);
	Таблица.Область("ИОбщСтДНА").Текст=Число(Таблица.Область("ОбщСт6ДНА").Текст) + Число(Таблица.Область("ОбщСт13ДНА").Текст)+Число(Таблица.Область("ОбщСт30ДНА").Текст)+Число(Таблица.Область("ОбщСт35ДНА").Текст);
	Таблица.Область("ИОбщСтВзыск").Текст=Число(Таблица.Область("ОбщСт6Взыск").Текст) + Число(Таблица.Область("ОбщСт13Взыск").Текст) + Число(Таблица.Область("ОбщСт30Взыск").Текст) + Число(Таблица.Область("ОбщСт35Взыск").Текст);
	Таблица.Область("ИОбщВозвр").Значение = Таблица.Область("ОбщВозвр6").Значение + Таблица.Область("ОбщВозвр13").Значение + Таблица.Область("ОбщВозвр30").Значение + Таблица.Область("ОбщВозвр35").Значение;
	Таблица.Область("ИОбщЗач").Значение = Таблица.Область("ОбщЗач6").Значение + Таблица.Область("ОбщЗач13").Значение + Таблица.Область("ОбщЗач30").Значение + Таблица.Область("ОбщЗач35").Значение;
	
КонецПроцедуры  // ОбновитьРаздел6()

//******************************************************************************
// ПриВводеУдержанныхНалогов()
//
// Параметры:
//		нет
//
// Вызывается из "желтых" ячеек строки 64 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются суммы задолженностей в Разделе 3, итоги в Разделе 6, а
//		также сальдо по налогу на конец года
//
Процедура ПриВводеУдержанныхНалогов(МесяцПоследнегоНачисления = "")
	
    //ОпределитьЦвет();
	
	Если МесяцПоследнегоНачисления = "" Тогда
		Имя = Таблица.АктивнаяОбласть();
		Если Лев(Имя,1) = "П" Тогда
			Номер = Число(Сред(Таблица.АктивнаяОбласть(),2));
			МесяцРедактирования=Номер-ПерваяЯчейкаУдержанныхНалоговРаздела3+1; 
		Иначе
			МесяцРедактирования=Число(Прав(Имя,2)); 
		КонецЕсли;
		
	Иначе
		МесяцРедактирования=МесяцПоследнегоНачисления;
	КонецЕсли;
	
	ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
	
	// Раздел 3
	СальдоОсн=0;
	Если Резидент=1 Тогда 
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл 
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=Число(ТекстИсч);
			УдержаноОсн=Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
			Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
			Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
		КонецЦикла;
	Иначе
		ИсчисленоОсн=0;
		УдержаноОсн=0;
		Для Сч = 1 По МесяцРедактирования-1  Цикл
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			ВозвращеноОсн = ВозвращеноОсн + Таблица.Область("НалВозвр" + глДополнитьСтроку(Сч, 2)).Значение;
		КонецЦикла;
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			ТекстИсч = Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			ВозвращеноОсн = Таблица.Область("НалВозвр" + глДополнитьСтроку(Сч, 2)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн - ВозвращеноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
			Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
			Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
		КонецЦикла;
	КонецЕсли;
	ВозвращеноОсн = Таблица.Область("ИНалВозвр").Значение;
	НаВзысканиеОсн = Таблица.Область("ИНалВзыск").Значение;
	Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
	Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-(СальдоОсн),0),"Ч015.2.");
	
	// Раздел 6
	УчестьСуммуСальдо();
	ОбновитьРаздел6();	
	
КонецПроцедуры // ПриВводеУдержанныхНалогов()

//******************************************************************************
// ПриВводеРаздела6()
//
// Параметры:
//		нет
//
// Вызывается из "желтых" ячеек 6-го раздела
//
// Возвращаемое значение
//		нет
//
// Описание:
//		итоговые показатели по желтым ячейкам
//
Процедура ПриВводеРаздела6()
	
	Таблица.Область("ИОбщВозвр").Значение = Таблица.Область("ОбщВозвр6").Значение + Таблица.Область("ОбщВозвр13").Значение + Таблица.Область("ОбщВозвр30").Значение + Таблица.Область("ОбщВозвр35").Значение;
	Таблица.Область("ИОбщЗач").Значение = Таблица.Область("ОбщЗач6").Значение + Таблица.Область("ОбщЗач13").Значение + Таблица.Область("ОбщЗач30").Значение + Таблица.Область("ОбщЗач35").Значение;
	ОбновитьРаздел6();
	
КонецПроцедуры

//******************************************************************************
// ПриВводеДоходовРаздела3()
//
// Параметры:
//		нет
//
// Вызывается из ячеек строк с 46 по 50 в колонках с 5 по 16-ую таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются налоговая база, суммы налога исчисленного, суммы задолженностей 
//		в Разделе 3, итоги в Разделе 6, а также сальдо по налогу на конец года
//
Функция ПриВводеДоходовРаздела3(Знач ИмяОбл = "")
	
	ВидыДоходов = СоздатьОбъект("Справочник.ВидыДоходов");
	ПрименилиВычет=0;
	
	Если ИмяОбл="" Тогда
		ИмяОбл = Таблица.АктивнаяОбласть();
	КонецЕсли;
	
	Номер = Число(Сред(ИмяОбл,2));
	НомерСтрокиРедактирования = Цел((Номер-ПерваяЯчейкаРаздела3)/13)+1;
	МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела3)%13;
	ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
	
	// проставим положенный по ст. 217 НК РФ вычет
	НомерСтрокиВычета = 0;
	ВидыДоходов.НайтиПоКоду(Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (НомерСтрокиРедактирования-1)*13,3)).Значение);
	ТипДохода=ВидыДоходов.ТекущийЭлемент();
	Если ТипДохода.Выбран()=1  Тогда
		Если (ТипДохода.ВидВычета.Выбран()=1) Тогда
			Для Сч = 0 По 4 Цикл
				КодСк=Прав(Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (5+Сч)*13,3)).Значение,3);
				Если ТипДохода.ВидВычета.Код=КодСк Тогда
					НомерСтрокиВычета = Сч + 6;
					Прервать
				КонецЕсли;	
			КонецЦикла;
			Если  (Сч<= 4)  Тогда
				БылоВычета=0;
				Если (МесяцРедактирования>1) Тогда
					Для Ссч = 1 По МесяцРедактирования-1  Цикл
						БылоВычета=БылоВычета+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (5+Сч)*13+Ссч,3)).Значение
					КонецЦикла;
				КонецЕсли;
				
				Если Год >= 2006 Тогда
					Если ТипДохода.Код = "2790" Тогда
						РазмерВычета = 10000;
						
					ИначеЕсли ТипДохода.Код = "2762" Тогда
						РазмерВычета = 50000;
					    
					Иначе
						РазмерВычета = 4000;
					КонецЕсли;
					
				Иначе
					РазмерВычета = 2000;
				КонецЕсли;
				
				ОсталосьВычета=Макс(РазмерВычета-БылоВычета,0);
				ПрименилиВычетТекущий=Мин(Таблица.Область(ИмяОбл).Значение,ОсталосьВычета);
				ПрименилиВычет=ПрименилиВычет+ПрименилиВычетТекущий;
				Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (5+Сч)*13+МесяцРедактирования,3)).Значение=ПрименилиВычетТекущий;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	// колонка "Итого" Раздела 3
	Доход = 0;
	Вычет = 0;
	Для Сч = 1 По 12 Цикл
		Доход = Доход+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (НомерСтрокиРедактирования-1)*13+Сч,3)).Значение;
		Если НомерСтрокиВычета >= 6 Тогда
		    Вычет = Вычет+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (НомерСтрокиВычета-1)*13+Сч,3)).Значение;
		КонецЕсли;
	КонецЦикла;
	Таблица.Область("ИД"+глДополнитьСтроку(НомерСтрокиРедактирования,2)).Текст = Доход;
	Если НомерСтрокиВычета >= 6 Тогда
		Таблица.Область("ИД"+глДополнитьСтроку(НомерСтрокиВычета,2)).Текст = Вычет;
	КонецЕсли;
	
	// итоговая строка "за месяц" по доходам Раздела 3
	Значение = 0;
	ПервыйНомер = ПерваяЯчейкаРаздела3+МесяцРедактирования;
	Для Сч=0 По 4 Цикл
		Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер+Сч*13,3)).Значение;
	КонецЦикла;
	Для Сч=0 По 4 Цикл
		Значение = Значение-Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер+(5+Сч)*13,3)).Значение;
	КонецЦикла;
	Изменение=Значение-Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(МесяцРедактирования,2)).Текст);
	Таблица.Область("МДБезВ"+глДополнитьСтроку(МесяцРедактирования,2)).Текст = Формат(Значение,"Ч015.2.");
	
	// расчет итогов по доходам, налоговой базы, сумм задолженностей
    Накоплено=0;
	Для Сч = 1 По МесяцРедактирования-1  Цикл
		Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
	КонецЦикла;
	
	Если Резидент=1 Тогда 
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
			Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст = Формат(Накоплено,"Ч015.2."); 
			Значение=Число(Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ОбщСВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ГИВ_"+глДополнитьСтроку(Сч,2)).Текст);
			Таблица.Область("НБаза"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			ИсчисленоОсн=Окр(Макс(Значение,0)*СтавкаНДФЛ);
			Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Значение = ИсчисленоОсн; 
			УдержаноОсн=Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
		Таблица.Область("ИНБаза").Текст = Формат(Макс(Значение,0),"Ч015.2."); 
		// итог по строке "с начала года"
		Таблица.Область("ИГДБезВ").Текст = Формат(Накоплено,"Ч015.2."); 
		
	Иначе
		Таблица.Область("НБаза"+глДополнитьСтроку(МесяцРедактирования,2)).Текст = Формат(Значение,"Ч015.2."); 
		ИсчисленоОсн=Окр(Значение*СтавкаНДФЛ);
		Таблица.Область("НИ"+глДополнитьСтроку(МесяцРедактирования,2)).Значение = ИсчисленоОсн; 
		ИсчисленоОсн=0;
		УдержаноОсн=0;
		Для Сч = 1 По МесяцРедактирования-1  Цикл
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
		КонецЦикла;
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
		Таблица.Область("ИНБаза").Текст = Формат(Накоплено,"Ч015.2."); 
	КонецЕсли;	
	Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
	Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
	Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
	Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
	
	// Раздел 6
	УчестьСуммуСальдо();
	ОбновитьРаздел6();
	
	Возврат ПрименилиВычет;

КонецФункции // ПриВводеДоходовРаздела3()

//******************************************************************************
// ПриВводеСтандартныхВычетов()
//
// Параметры:
//		нет
//
// Вызывается из ячеек табличного документа:
//		раздел "Стандартные вычеты, предусмотренные ст.218"
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются налоговая база, суммы налога исчисленного, суммы задолженностей 
//		в Разделе 3, итоги в Разделе 6, а также сальдо по налогу на конец года
//
Процедура ПриВводеСтандартныхВычетов(МесяцПоследнегоНачисления = "", _НомерСтрокиРедактирования = 0)

	Если Резидент<>1 Тогда 
		Возврат;
	КонецЕсли;
	
	Если ПустоеЗначение(МесяцПоследнегоНачисления) = 1 Тогда
	    Имя = Таблица.АктивнаяОбласть();
		
	Иначе
		Имя = "СВМес"+_НомерСтрокиРедактирования+глДополнитьСтроку(МесяцПоследнегоНачисления, 2)
	КонецЕсли;
	          
	СуммаВведенная = Таблица.Область(Имя).Значение;
	НомерСтрокиРедактирования = Число(Сред(Имя, 6, 1));
	КодВычета = "10" + НомерСтрокиРедактирования;
	ТипВычета = КодВычета;
	ВычетыПеретекают = ?(Константа.ОсобенностиИсчисленияНДФЛ.Получить("31.12."+Год) = 
						Перечисление.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом, 1, 0);

	ИмяРеквизита = "КодДляОтчетности2007";
		
	ВидыВычетов.ВыбратьЭлементыПоРеквизиту(ИмяРеквизита,КодВычета,,);
	РазмерВычета = 0;
	Пока ВидыВычетов.ПолучитьЭлемент() = 1 Цикл
		РазмерВычета = ВидыВычетов.Сумма.Получить("31.12."+Год);		
	КонецЦикла;
	Если РазмерВычета <> 0 Тогда
		СуммаВычета = ?(ВычетыПеретекают = 1, Окр(СуммаВведенная/РазмерВычета)*РазмерВычета, СуммаВведенная);
	Иначе
		СуммаВычета = 0;
	КонецЕсли;
	
	Если Лев(Имя, 5) = "СВКод" тогда
		Для индМесяца = 1 по 12 Цикл
			РазмерВычета = Таблица.Область("СВМес" + НомерСтрокиРедактирования + глДополнитьСтроку(индМесяца, 2)).Значение;
			Если (РазмерВычета <> 0) тогда
				Если РазмерВычета <> СуммаВычета тогда
					Таблица.Область("СВМес" + НомерСтрокиРедактирования + глДополнитьСтроку(индМесяца, 2)).Значение = СуммаВычета;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		Номер = 1;
		МесяцРедактирования = 1;
		
		ПоследнийМесяц = Макс(ПоследнийМесяц, МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
		
	ИначеЕсли Лев(Имя, 5) = "СВМес" тогда
		Номер = Число(Сред(Имя, 7));
		МесяцРедактирования = Номер;
		ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
		РазмерВычета = Таблица.Область(Имя).Значение;
		
		Если РазмерВычета <> 0 тогда
			Таблица.Область(Имя).Значение = СуммаВычета;
		КонецЕсли;
		
	Иначе
		МесяцРедактирования = МесяцПоследнегоНачисления;
		ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования);
	КонецЕсли;
	
	Если МесяцПоследнегоНачисления <> "" Тогда
		МесяцРедактирования = МесяцПоследнегоНачисления;
		ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования);
		НомерСтрокиРедактирования = _НомерСтрокиРедактирования;
	КонецЕсли;
	
	СуммаВычетовСНачалаГода = 0;
	Если Резидент=1 Тогда 
		Если МесяцРедактирования > 1 тогда
			СуммаВычетовСНачалаГода = Таблица.Область("ОбщСВ" + глДополнитьСтроку(МесяцРедактирования-1, 2)).Значение;
		Иначе
			СуммаВычетовСНачалаГода = 0;
		КонецЕсли;
		ВсегоВычета = 0;
		Для инд = 1 по 12 Цикл
			ВсегоВычета = ВсегоВычета + Таблица.Область("СВМес" + НомерСтрокиРедактирования + глДополнитьСтроку(инд,2)).Значение;
		КонецЦикла;                                   
		Таблица.Область("ИСВМес" + НомерСтрокиРедактирования).Значение = ВсегоВычета;
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			
			Для инд = 1 по 7 Цикл
				СуммаВычетовСНачалаГода = СуммаВычетовСНачалаГода + Таблица.Область("СВМес" + инд + глДополнитьСтроку(Сч,2)).Значение;
			КонецЦикла;
			
			Таблица.Область("ОбщСВ"+глДополнитьСтроку(Сч,2)).Текст = Формат(СуммаВычетовСНачалаГода,"Ч015.2.");
			
			Значение=Число(Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ОбщСВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ГИВ_"+глДополнитьСтроку(Сч,2)).Текст);
			Таблица.Область("НБаза"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			Таблица.Область("ИНБаза").Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			ИсчисленоОсн=Окр(Макс(Значение,0)*СтавкаНДФЛ);
			Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Значение = ИсчисленоОсн;
			УдержаноОсн=Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
		Таблица.Область("ИОбщСВ").Текст = Формат(СуммаВычетовСНачалаГода,"Ч015.2.");
	КонецЕсли;	
	
    Таблица.ЕстьВычеты.Текст = ?(Таблица.Область("ИОбщСВ").Значение = 0, "2", "1");
	Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
	Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
	Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
	Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");

	// Раздел 6
	УчестьСуммуСальдо();
	ОбновитьРаздел6();
	
КонецПроцедуры

//******************************************************************************
// ПриВводеИмущественныхВычетов()
//
Процедура ПриВводеИмущественныхВычетов(МесяцПоследнегоНачисления = "", _НомерСтрокиРедактирования = 0)

	Если Резидент<>1 Тогда 
		Возврат;
	КонецЕсли;
	
	Если ПустоеЗначение(МесяцПоследнегоНачисления) = 1 Тогда
	    Имя = Таблица.АктивнаяОбласть();
		
	Иначе
		Имя = "ИВычет"+_НомерСтрокиРедактирования+"_"+глДополнитьСтроку(МесяцПоследнегоНачисления, 2)
	КонецЕсли;
	          
	СуммаВведенная = Таблица.Область(Имя).Значение;
	НомерСтрокиРедактирования = Число(Сред(Имя, 7, 1));
	Номер = Число(Прав(Имя, 2));
	МесяцРедактирования = Номер;
	ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
	РазмерВычета = Таблица.Область(Имя).Значение;
	Таблица.Область(Имя).Значение = РазмерВычета;	
	
	СуммаВычетовСНачалаГода = 0;
	Если Резидент=1 Тогда 
		Если МесяцРедактирования > 1 тогда
			СуммаВычетовСНачалаГода = Таблица.Область("ГИВ_" + глДополнитьСтроку(МесяцРедактирования-1, 2)).Значение;
		Иначе
			СуммаВычетовСНачалаГода = 0;
		КонецЕсли;
		ВсегоВычета = 0;
		Для инд = 1 по 12 Цикл
			ВсегоВычета = ВсегоВычета + Таблица.Область("ИВычет" + НомерСтрокиРедактирования + "_" + глДополнитьСтроку(инд,2)).Значение;
		КонецЦикла;                                   
		Таблица.Область("ИВычет" + НомерСтрокиРедактирования + "_Итого").Значение = ВсегоВычета;
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			
			Для инд = 1 по 2 Цикл
				СуммаВычетовСНачалаГода = СуммаВычетовСНачалаГода + Таблица.Область("ИВычет" + инд + "_" + глДополнитьСтроку(Сч,2)).Значение;
			КонецЦикла;
			
			Таблица.Область("ГИВ_"+глДополнитьСтроку(Сч,2)).Текст = Формат(СуммаВычетовСНачалаГода,"Ч015.2.");
			
			Значение=Число(Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ОбщСВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ГИВ_"+глДополнитьСтроку(Сч,2)).Текст);
			
			Таблица.Область("НБаза"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			Таблица.Область("ИНБаза").Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			ИсчисленоОсн=Окр(Макс(Значение,0)*СтавкаНДФЛ);
			Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Значение = ИсчисленоОсн;
			УдержаноОсн=Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
		Таблица.Область("ГИВ_Итого").Текст = Формат(СуммаВычетовСНачалаГода,"Ч015.2.");
	КонецЕсли;	
	
	Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
	Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
	Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
	Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");

	// Раздел 6
	УчестьСуммуСальдо();
	ОбновитьРаздел6();
	
КонецПроцедуры

//******************************************************************************
// ПриВводеВычетов()
//
// Параметры:
//		нет
//
// Вызывается из ячеек табличного документа:
//		раздел "Вычеты, предусмотренные пунктом 28 ст.217, подпунктами 2, 3 
//		ст.221 НК РФ" Раздела 3
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются налоговая база, суммы налога исчисленного, суммы задолженностей 
//		в Разделе 3, итоги в Разделе 6, а также сальдо по налогу на конец года
//
Процедура ПриВводеВычетов()
	
	Имя=Таблица.АктивнаяОбласть();
	Номер = Число(Сред(Имя,2));
	НомерСтрокиРедактирования = Цел((Номер-ПерваяЯчейкаРаздела3)/13)+1;
	МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела3)%13;
	
	ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
	
	ТипВычета = Прав(Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3+НомерСтрокиРедактирования*13-13,3)).Значение, 3);

	Если Лев(ТипВычета,1) = "5" Тогда
		
		// ограничим введенный вычет по ст. 217
		БылоВычета=0;
		Если (МесяцРедактирования>1) Тогда
			Для Ссч = 1 По МесяцРедактирования-1  Цикл
				БылоВычета=БылоВычета+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (НомерСтрокиРедактирования-1)*13+Ссч,3)).Значение
			КонецЦикла;
		КонецЕсли;
		
		Если Год >= 2006 Тогда
			Если Лев(ТипВычета, 3) = "507" Тогда
				РазмерВычета = 10000;
			    
			ИначеЕсли Лев(ТипВычета, 3) = "508" Тогда
				РазмерВычета = 50000;
				
			Иначе
				РазмерВычета = 4000;
			КонецЕсли;
			
		Иначе
			РазмерВычета = 2000;
		КонецЕсли;
		
		ОсталосьВычета=Макс(РазмерВычета-БылоВычета,0);
		Таблица.Область(Имя).Значение = Мин(Таблица.Область(Имя).Значение,ОсталосьВычета);
		
	ИначеЕсли (Найти(",404,405,",","+ТипВычета+",") = 1) и (ОткрывалиФормуВводаВычетов = 0) Тогда // расходы по авторским вознаграждениям
		
		СписокВидовАвторских = СоздатьОбъект("СписокЗначений");
		СписокСуммАвторских = СоздатьОбъект("СписокЗначений");
		Для индДох = 1 по 5 Цикл
			ТипДохода = Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (индДох-1)*13,3)).Значение;
			Если (Лев(ТипДохода, 2) = "22") Тогда
				СуммаДохода = Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (индДох-1)*13 + МесяцРедактирования,3)).Значение;
				СписокВидовАвторских.Установить(ТипДохода, ТипДохода);
				СписокСуммАвторских.Установить(ТипДохода, СуммаДохода)
			КонецЕсли;
		КонецЦикла;
		
		Если СписокВидовАвторских.РазмерСписка() = 0 Тогда
			Предупреждение("Среди доходов отсутствуют авторские вознаграждения!");
			Таблица.Область(Имя).Значение = 0;
		КонецЕсли;
	КонецЕсли;
	
	// колонка "Итого" Раздела 3
	Значение = 0;
	Для Сч = 1 По 12 Цикл
		Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (НомерСтрокиРедактирования-1)*13+Сч,3)).Значение		
	КонецЦикла;
	Таблица.Область("ИД"+глДополнитьСтроку(НомерСтрокиРедактирования,2)).Текст = Значение;
	
	// итоговая строка "за месяц" по доходам Раздела 3
	Значение = 0;
	ПервыйНомер = ПерваяЯчейкаРаздела3+МесяцРедактирования;
	Для Сч=0 По 4 Цикл
		Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер+Сч*13,3)).Значение;
	КонецЦикла;
	Для Сч=0 По 4 Цикл
		Значение = Значение-Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер+(5+Сч)*13,3)).Значение;
	КонецЦикла;
	Изменение=Значение-Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(МесяцРедактирования,2)).Текст);
	Таблица.Область("МДБезВ"+глДополнитьСтроку(МесяцРедактирования,2)).Текст = Формат(Значение,"Ч015.2.");

	// расчет итогов по доходам, налоговой базы, сумм задолженностей
    Накоплено=0;
	Для Сч = 1 По МесяцРедактирования-1  Цикл
		Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
	КонецЦикла;
	
	Если Резидент=1 Тогда
		// итог по строке "с начала года"
		Таблица.Область("ИГДБезВ").Текст = Формат(Число(Таблица.Область("ИГДБезВ").Текст)+Изменение,"Ч015.2."); 
		
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
			Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст = Формат(Накоплено,"Ч015.2."); 
			Значение=Число(Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ОбщСВ"+глДополнитьСтроку(Сч,2)).Текст)-Число(Таблица.Область("ГИВ_"+глДополнитьСтроку(Сч,2)).Текст);
			Таблица.Область("НБаза"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			Таблица.Область("ИНБаза").Текст = Формат(Макс(Значение,0),"Ч015.2."); 
			ИсчисленоОсн=Окр(Макс(Значение,0)*СтавкаНДФЛ);
			Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Значение = ИсчисленоОсн; 
			УдержаноОсн=Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
	Иначе
		Таблица.Область("НБаза"+глДополнитьСтроку(МесяцРедактирования,2)).Текст = Формат(Значение,"Ч015.2."); 
		ИсчисленоОсн=Окр(Значение*СтавкаНДФЛ);
		Таблица.Область("НИ"+глДополнитьСтроку(МесяцРедактирования,2)).Значение = ИсчисленоОсн; 
		ИсчисленоОсн=0;
		УдержаноОсн=0;
		Для Сч = 1 По МесяцРедактирования-1  Цикл
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ПозСк=Найти(ТекстИсч,"(");
			Если ПозСк>0  Тогда
				ТекстИсч=Лев(ТекстИсч,ПозСк-1)
			КонецЕсли;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
		КонецЦикла;
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
			//Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст = Формат(Накоплено,"Ч015.2."); 
			Таблица.Область("ИНБаза").Текст = Формат(Накоплено,"Ч015.2."); 
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ПозСк=Найти(ТекстИсч,"(");
			Если ПозСк>0  Тогда
				ТекстИсч=Лев(ТекстИсч,ПозСк-1)
			КонецЕсли;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
	КонецЕсли;	
	Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
	Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
	Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
	Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
	
	// Раздел 6
	УчестьСуммуСальдо();
	ОбновитьРаздел6();	
	
КонецПроцедуры // ПриВводеВычетов

//*****************************************************************************
// Процедура ПриВводеНИ4Раздела()
//
// Вызывается из ячеек табличного документа:
//		Из раздела 4 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются налоговая база, суммы налога исчисленного, суммы задолженностей 
//		в Разделе 4, итоги в Разделе 6, а также сальдо по налогу на конец года
//
Процедура ПриВводеНИ4Раздела()

	Имя	= Таблица.АктивнаяОбласть();	
	
	Если Резидент	<>	1 Тогда
		Предупреждение("Все доходы налоговых нерезидентов РФ "+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
		Таблица.Область(Имя).Значение = 0;
		Таблица.АктивнаяОбласть("R41C1");
	КонецЕсли;
	
	МесяцРедактирования	=	Число(Прав(Имя,2));       
	Значение	= 0;
	Исчислено	= 0;
	Для Сч = 1 По 12 Цикл
		ТекстИсч	=	Таблица.Область("НД6И" + глДополнитьСтроку(Сч,2)).Текст;
		Исчислено 	= 	Исчислено + ТекстИсч;
	КонецЦикла;
	Таблица.Область("ИНД6И").Текст = Формат(Исчислено,"Ч015.2.");
	
	// строки задолженностей
	Исчислено	= 0;
	Удержано	= 0;
	Зачтено		= 0;
	Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
		ТекстИсч	= Таблица.Область("НД6И"+глДополнитьСтроку(Сч,2)).Текст;
		Исчислено	= Исчислено + Число(ТекстИсч);
		Удержано	= Удержано + Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4+23+Сч,3)).Значение;
		Сальдо		= Исчислено - Зачтено - Удержано;
		Таблица.Область("ДДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(Сальдо,0),"Ч015.2.");
		Таблица.Область("ДДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-Сальдо,0),"Ч015.2.");
	КонецЦикла; 

	Таблица.Область("ИДДолгНП").Текст = Формат(Макс(Сальдо,0),"Ч015.2.");
	Таблица.Область("ИДДолгНА").Текст = Формат(Макс(-Сальдо,0),"Ч015.2.");
	// Раздел 6
	ОбновитьРаздел6();	
	
КонецПроцедуры //ПриВводеНИ4Раздела

//*****************************************************************************
// Процедура ПриВводеДивидендов()
//
// Параметры:
//		нет
//
// Вызывается из ячеек табличного документа:
//		Из раздела 4 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются налоговая база, суммы налога исчисленного, суммы задолженностей 
//		в Разделе 4, итоги в Разделе 6, а также сальдо по налогу на конец года
//
Процедура ПриВводеДивидендов(Знач ИмяОбл="", Сообщать = 1)
	
	Если ИмяОбл="" Тогда
		ИмяОбл = Таблица.АктивнаяОбласть();
	КонецЕсли; 
	
	Если (Резидент = 0) И (Дата("01.01."+Год) <= '31.12.2007' )Тогда // нерезиденту эти доходы следует показывать в Разделе 3
		Если Сообщать = 1 Тогда
			Предупреждение("Все доходы налоговых нерезидентов РФ "+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
		КонецЕсли;
		Таблица.Область(ИмяОбл).Значение = 0;
		Таблица.АктивнаяОбласть("R41C1");
		
	Иначе // для резидентов - обновим данные в разделе
		
		Номер = Число(Сред(ИмяОбл,2));
		НомерСтрокиРедактирования = Цел((Номер-ПерваяЯчейкаРаздела4)/12)+1;
		МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела4+1)%12; 
		МесяцРедактирования=?(МесяцРедактирования=0,12,МесяцРедактирования);
		
		ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
		
		Если НомерСтрокиРедактирования=2  Тогда // сумма дивидендов - пересчитываем строки налога исчисленного 
			Таблица.Область("ОбДив"+глДополнитьСтроку(МесяцРедактирования,2)).Значение = Таблица.Область(ИмяОбл).Значение;
			
			Значение = 0;
			Для Сч = 12 По 23 Цикл
				Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4 + Сч,3)).Значение		
			КонецЦикла;
			Таблица.Область("ИДив").Текст = Формат(Значение,"Ч015.2.");
			Таблица.Область("ИОбДив").Текст = Формат(Значение,"Ч015.2.");
			
			Таблица.Область("НД6И"+глДополнитьСтроку(МесяцРедактирования,2)).Значение = Окр(Таблица.Область(ИмяОбл).Значение*СтавкаПоДивидендам);
			Значение = 0;
			
		ИначеЕсли Лев(ИмяОбл, 5) = "ОбДив" Тогда
			МесяцРедактирования	=	Число(Прав(ИмяОбл,2));
			ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования);
			
			Значение = 0;
			Для Сч = 1 По 12 Цикл
				Значение = Значение+Таблица.Область("ОбДив"+глДополнитьСтроку(Сч,2)).Значение		
			КонецЦикла;
			Таблица.Область("ИОбДив").Текст = Формат(Значение,"Ч015.2.");
			
			Таблица.Область("НД6И"+глДополнитьСтроку(МесяцРедактирования,2)).Значение = Окр(Таблица.Область(ИмяОбл).Значение*СтавкаПоДивидендам);
			Значение = 0;
		КонецЕсли;	
					
		Исчислено=0;
		Для Сч = 1 По 12 Цикл
			ТекстИсч=Таблица.Область("НД6И"+глДополнитьСтроку(Сч,2)).Текст;
			Исчислено = Исчислено+Число(ТекстИсч);
		КонецЦикла;
		Таблица.Область("ИНД6И").Текст = Формат(Исчислено,"Ч015.2.");
			
		Удержано=0;
		Для Сч = 24 По 35 Цикл
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4+Сч,3)).Значение;
		КонецЦикла;
		Таблица.Область("ИДивНУ").Текст = Формат(Удержано,"Ч015.2.");
		
		// строки задолженностей
		Исчислено=0;
		Удержано=0;
		Для Сч = 1 По МесяцРедактирования-1  Цикл
			ТекстИсч=Таблица.Область("НД6И"+глДополнитьСтроку(Сч,2)).Текст;
			Исчислено=Исчислено+Число(ТекстИсч);
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4+23+Сч,3)).Значение;
		КонецЦикла;
		
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			ТекстИсч=Таблица.Область("НД6И"+глДополнитьСтроку(Сч,2)).Текст;
			Исчислено=Исчислено+Число(ТекстИсч);
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4+23+Сч,3)).Значение;
			Сальдо = Исчислено - Удержано;
			Таблица.Область("ДДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(Сальдо,0),"Ч015.2.");
			Таблица.Область("ДДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-Сальдо,0),"Ч015.2.");
		КонецЦикла; 
		
		Таблица.Область("ИДДолгНП").Текст = Формат(Макс(Сальдо,0),"Ч015.2.");
		Таблица.Область("ИДДолгНА").Текст = Формат(Макс(-Сальдо,0),"Ч015.2.");
		
		// Раздел 6
		ОбновитьРаздел6();	
		
	КонецЕсли;
КонецПроцедуры //ПриВводеДивидендов

//******************************************************************************
// ПриСменеДохода5Раздела()
//
// Параметры:
//		нет
//
// Вызывается из ячейки табличного документа:
//		Из раздела 5 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляется 5 раздел целиком 
//  
//
Процедура ПриСменеДохода5Раздела()
	
	Раздел5 = "";
	
	КодДохода5раздела = Сред(Таблица.Доход5раздела.Значение,12,4);
	Если СпрВидыДоходов.НайтиПоКоду(КодДохода5раздела) = 0 Тогда
	    КодДохода5раздела = "";
	КонецЕсли;
	
	Если ПустоеЗначение(КодДохода5Раздела) = 1 Тогда // очистили код дохода
	    Возврат
	КонецЕсли;
	
	ТаблицаТекущего5Раздела = СписокВводаРаздела5.Получить(КодДохода5Раздела);
	Если ТипЗначенияСтр(ТаблицаТекущего5Раздела) <> "ТаблицаЗначений" тогда
		ТаблицаТекущего5Раздела = СоздатьТаблицу5Раздела();
		СписокВводаРаздела5.ДобавитьЗначение(ТаблицаТекущего5Раздела, КодДохода5Раздела);
	КонецЕсли; 
	
	СуммаДоходаНарастающим = 0; 
	СуммаВычетаНарастающим = 0;
	ВзысканиеНарастающим = 0; 
	ВозвращенаНарастающим = 0;
	ИсчисленноНарастающим = 0;
	УдержаноНарастающим = 0;
	БазаНарастающим = 0;
	ТаблицаТекущего5Раздела.ВыбратьСтроки();
	Пока ТаблицаТекущего5Раздела.ПолучитьСтроку() = 1 Цикл  
		СмещениеПоСтроке = ТаблицаТекущего5Раздела.НомерСтроки;
		Таблица.Область("П" + (ПерваяЯчейкаРаздела5 + СмещениеПоСтроке)).Значение = ТаблицаТекущего5Раздела.СуммаДохода;
		СуммаДоходаНарастающим = СуммаДоходаНарастающим + ТаблицаТекущего5Раздела.СуммаДохода;
		Таблица.Область("П" + (ПерваяЯчейкаРаздела5 + СмещениеПоСтроке + 60)).Значение = ТаблицаТекущего5Раздела.СуммаВычета;
		СуммаВычетаНарастающим = СуммаВычетаНарастающим + ТаблицаТекущего5Раздела.СуммаВычета;
		Таблица.Область("Дох35НБ" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение = ТаблицаТекущего5Раздела.НБ;
		БазаНарастающим = БазаНарастающим + ТаблицаТекущего5Раздела.НБ;
		Таблица.Область("СТ35НИ" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение = ТаблицаТекущего5Раздела.НИ;
		ИсчисленноНарастающим = ИсчисленноНарастающим + ТаблицаТекущего5Раздела.НИ;
		Таблица.Область("П" + (ПерваяЯчейкаРаздела5 + СмещениеПоСтроке + 72)).Значение = ТаблицаТекущего5Раздела.НУ;
		УдержаноНарастающим = УдержаноНарастающим + ТаблицаТекущего5Раздела.НУ;
		Таблица.Область("Долг35НП" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение = ТаблицаТекущего5Раздела.ДолгНП;
		Таблица.Область("Долг35НА" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение = ТаблицаТекущего5Раздела.ДолгНА;
		Таблица.Область("Нал35Взыск" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение = ТаблицаТекущего5Раздела.Взыскание;
		ВзысканиеНарастающим = ВзысканиеНарастающим + ТаблицаТекущего5Раздела.Взыскание;
		Таблица.Область("Нал35Возвр" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение = ТаблицаТекущего5Раздела.Возвращена;  
		ВозвращенаНарастающим = ВозвращенаНарастающим + ТаблицаТекущего5Раздела.Возвращена;
	КонецЦикла;  

	// заполним разделы до последнего введенного месяца.
	Если  (Число(СмещениеПоСтроке) < ПоследнийМесяц) и (Число(СмещениеПоСтроке)>0) Тогда 
		Для  Сч = Число(СмещениеПоСтроке)+1 По ПоследнийМесяц Цикл 
			Таблица.Область("Долг35НП" + глДополнитьСтроку(Сч, 2)).Значение = Таблица.Область("СТ35НИ" + глДополнитьСтроку(Сч-1, 2)).Значение;
			Таблица.Область("Долг35НА" + глДополнитьСтроку(Сч, 2)).Значение = Таблица.Область("Долг35НА" + глДополнитьСтроку(Сч-1, 2)).Значение;
		КонецЦикла;	
		СмещениеПоСтроке =  ПоследнийМесяц;
	КонецЕсли;	
	
	// Итоги по 5 разделу. 
	Если ТаблицаТекущего5Раздела.КоличествоСтрок() > 0 Тогда 
		Таблица.Область("ИСТ35_01").Текст = СуммаДоходаНарастающим;  
		Таблица.Область("ИСТ35_06").Текст = СуммаВычетаНарастающим; 
		Таблица.Область("ИДох35НБ").Текст = БазаНарастающим;
		Таблица.Область("ИСТ35НИ").Текст = ИсчисленноНарастающим;
		Таблица.Область("ИСТ35_07").Текст = УдержаноНарастающим; 
		Таблица.Область("ИДолг35НП").Текст = Таблица.Область("Долг35НП" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение ;
		Таблица.Область("ИДолг35НА").Текст = Таблица.Область("Долг35НА" + глДополнитьСтроку(СмещениеПоСтроке, 2)).Значение;
		Таблица.Область("ИНал35Взыск").Текст = ВзысканиеНарастающим;
		Таблица.Область("ИНал35Возвр").Текст = ВозвращенаНарастающим;
	КонецЕсли;
	    
КонецПроцедуры


//******************************************************************************
// Записать5РазделВТаблицу(ТаблицаТекущего5Раздела)
//
// Параметры:
//		ТаблицаТекущего5Раздела - ТаблицаЗначений();
//
// Возвращаемое значение
//		нет
//
// Описание:
//  
//
Процедура Записать5РазделВТаблицу(ТаблицаТекущего5Раздела)
	
	ТаблицаТекущего5Раздела.УдалитьСтроки();
	Для индМес = 1 по ПоследнийМесяц Цикл
		СуммаДохода = Таблица.Область("П" + (ПерваяЯчейкаРаздела5 + индМес)).Значение;
		СуммаВычета = Таблица.Область("П" + (ПерваяЯчейкаРаздела5 + индМес + 60)).Значение;
		НИ = Таблица.Область("СТ35НИ" + глДополнитьСтроку(индМес, 2)).Значение;
		НУ = Таблица.Область("П" + (ПерваяЯчейкаРаздела5 + индМес + 72)).Значение;
		Взыскание = Таблица.Область("Нал35Взыск" + глДополнитьСтроку(индМес, 2)).Значение;
		Возвращена = Таблица.Область("Нал35Возвр" + глДополнитьСтроку(индМес, 2)).Значение;
		
		ТаблицаТекущего5Раздела.НоваяСтрока();
		ТаблицаТекущего5Раздела.МесяцДохода = индМес;
		ТаблицаТекущего5Раздела.КодДохода = Сред(Таблица.Доход5раздела.Значение, 12, 4);
		ТаблицаТекущего5Раздела.СуммаДохода = СуммаДохода;
		ТаблицаТекущего5Раздела.КодВычета = ?(Сред(Таблица.Доход5раздела.Значение, 12, 4) = "2740", "505", "");
		ТаблицаТекущего5Раздела.СуммаВычета = СуммаВычета;
		ТаблицаТекущего5Раздела.НБ = Таблица.Область("Дох35НБ" + глДополнитьСтроку(индМес, 2)).Значение;
		ТаблицаТекущего5Раздела.НИ = НИ;
		ТаблицаТекущего5Раздела.НУ = НУ;
		ТаблицаТекущего5Раздела.ДолгНП = Таблица.Область("Долг35НП" + глДополнитьСтроку(индМес, 2)).Значение;
		ТаблицаТекущего5Раздела.ДолгНА = Таблица.Область("Долг35НА" + глДополнитьСтроку(индМес, 2)).Значение;
		ТаблицаТекущего5Раздела.Взыскание = Взыскание;
		ТаблицаТекущего5Раздела.Возвращена = Возвращена;
	КонецЦикла;
	
КонецПроцедуры

//******************************************************************************
// ПриВводеМатВыгод()
//
// Параметры:
//		нет
//
// Вызывается из ячеек табличного документа:
//		Из раздела 5 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляются налоговая база, суммы налога исчисленного, суммы задолженностей 
//		в Разделе 5, итоги в Разделе 6, а также сальдо по налогу на конец года
//  
//
Процедура ПриВводеМатВыгод(Знач ИмяОбл="")
	
	Если ИмяОбл="" Тогда
		ИмяОбл = Таблица.АктивнаяОбласть();
	КонецЕсли;
	
	Если Резидент = 0 Тогда // нерезиденту эти доходы следует показывать в Разделе 3
		
		Предупреждение("Все доходы налоговых нерезидентов РФ "+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
		Таблица.Область(ИмяОбл).Значение = 0;
		Если Таблица.Область(ИмяОбл).Доступность()=1 Тогда
			Таблица.Область(ИмяОбл).ЦветФона(255,255,128);
		КонецЕсли;
		
	Иначе // для резидентов - обновим данные в разделе
		
		РазмерСкидки=?(Год >= 2006, 4000, 2000);
		Если Лев(ИмяОбл,1) = "П" Тогда
			Номер = Число(Сред(ИмяОбл,2));
			НомерСтрокиРедактирования = Цел((Номер-ПерваяЯчейкаРаздела5-1)/12)+1;
			МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела5)%12; 
			МесяцРедактирования=?(МесяцРедактирования=0,12,МесяцРедактирования);
		Иначе
			МесяцРедактирования=Число(Прав(ИмяОбл,2));
			НомерСтрокиРедактирования = 7;
		КонецЕсли;
		
		ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
		КодДохода5раздела = Сред(Таблица.Доход5раздела.Значение,12,4);
		Если (КодДохода5раздела<>"2740") и (НомерСтрокиРедактирования = 6) Тогда
			Предупреждение("Вычет в 5-м разделе Налоговой карточки можно ввести только для дохода с кодом 2740!",6);
			Таблица.Область(ИмяОбл).Значение = 0;
			Возврат
		КонецЕсли;

		// итоговая колонка
		Значение = 0;
		Для Сч = 1 По 12 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + (НомерСтрокиРедактирования-1)*12+Сч,3)).Значение;
		КонецЦикла;
		Таблица.Область("ИСТ35_"+глДополнитьСтроку(НомерСтрокиРедактирования,2)).Текст = Значение;
		
		Если НомерСтрокиРедактирования<7  Тогда 
			
			Если Сред(Таблица.Доход5раздела.Значение, 12, 4) = "2740" Тогда // подсчитаем оставшуюся сумму вычета по ст. 217 НК РФ
				БылоСк=0;
				Если (МесяцРедактирования>1) Тогда
					Для Ссч = 1 По МесяцРедактирования-1  Цикл
						БылоСк=БылоСк+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + 60 + Ссч,3)).Значение
					КонецЦикла;
				КонецЕсли;
				ОсталосьСкидки=Макс(РазмерСкидки-БылоСк,0);
				Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + 60 + МесяцРедактирования,3)).Значение= Мин(Таблица.Область(ИмяОбл).Значение,ОсталосьСкидки)
			КонецЕсли;
			
			// строки "налоговая база" и "налог исчисленный"
			Значение = Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + МесяцРедактирования,3)).Значение;
			Значение = Значение-Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + 60 + МесяцРедактирования,3)).Значение;
			
			Таблица.Область("Дох35НБ"+глДополнитьСтроку(МесяцРедактирования,2)).Текст = Формат(Значение,"Ч015.2."); 
			Таблица.Область("СТ35НИ"+глДополнитьСтроку(МесяцРедактирования,2)).Значение = Окр(Значение*СтавкаПоМВ); 
			
		КонецЕсли;
		
		// строки задолженностей
		НалоговаяБаза=0;
		Исчислено=0;
		Удержано=0;
		Скидка = 0;
		Для Сч = 1 По МесяцРедактирования-1  Цикл
			Если НомерСтрокиРедактирования = 1 Тогда
				Скидка = Скидка+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + 60 + Сч,3)).Значение;
			КонецЕсли;
			Если НомерСтрокиРедактирования<7  Тогда
				НалоговаяБаза=НалоговаяБаза+Число(Таблица.Область("Дох35НБ"+глДополнитьСтроку(Сч,2)).Текст);
			КонецЕсли;
			ТекстИсч=Таблица.Область("СТ35НИ"+глДополнитьСтроку(Сч,2)).Текст;
			Исчислено=Исчислено+Число(ТекстИсч);
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5+72+Сч,3)).Значение;
		КонецЦикла;
		Для Сч = МесяцРедактирования По ПоследнийМесяц Цикл
			Если НомерСтрокиРедактирования = 1 Тогда
				Скидка = Скидка+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + 60 + Сч,3)).Значение;
			КонецЕсли;
			Если НомерСтрокиРедактирования<7  Тогда
				НалоговаяБаза=НалоговаяБаза+Число(Таблица.Область("Дох35НБ"+глДополнитьСтроку(Сч,2)).Текст);
			КонецЕсли;
			ТекстИсч=Таблица.Область("СТ35НИ"+глДополнитьСтроку(Сч,2)).Текст;
			Исчислено=Исчислено+Число(ТекстИсч);
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5+72+Сч,3)).Значение;
			СальдоОсн = Исчислено - Удержано;
			Таблица.Область("Долг35НП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			Таблица.Область("Долг35НА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
		
		// итоговая колонка раздела
		Если НомерСтрокиРедактирования = 1 Тогда
		    Таблица.Область("ИСТ35_06").Текст = Скидка;
		КонецЕсли;
		Если НомерСтрокиРедактирования<7  Тогда
			Таблица.Область("ИДох35НБ").Текст = Формат(НалоговаяБаза,"Ч015.2.");
		КонецЕсли;
		Таблица.Область("ИСТ35НИ").Текст = Формат(Исчислено,"Ч015.2.");
		СальдоОсн = Исчислено - Удержано;
		Таблица.Область("ИДолг35НП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
		Таблица.Область("ИДолг35НА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		
		// для правильного обновления 6-го раздела приходится постоянно запоминать 5 разделы
		КодДохода5Раздела = Сред(Таблица.Доход5раздела.Значение, 12, 4);
		Если СпрВидыДоходов.НайтиПоКоду(КодДохода5раздела) = 0 Тогда
		    КодДохода5раздела = "";
		КонецЕсли;
	
		ТаблицаТекущего5Раздела = СписокВводаРаздела5.Получить(КодДохода5Раздела);
		Если ТипЗначенияСтр(ТаблицаТекущего5Раздела) = "ТаблицаЗначений" тогда
			Записать5РазделВТаблицу(ТаблицаТекущего5Раздела);
		КонецЕсли;
		// Раздел 6
		ОбновитьРаздел6();	
		
	КонецЕсли;
	
КонецПроцедуры // ПриВводеМатВыгод()

//******************************************************************************
// ПриВводеПродаж()
//
// Параметры:
//		нет
//
// Вызывается из ячеек табличного документа:
//		Из раздела 7 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляется итоговая колонка в Разделе 7
//
Процедура ПриВводеПродаж()
	
	Имя = Таблица.АктивнаяОбласть();
	Номер = Число(Сред(Таблица.АктивнаяОбласть(),2));
	МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела7)%13;
	
	ПоследнийМесяц=Макс(ПоследнийМесяц,МесяцРедактирования); // возможно заполнили очередной месяц - будем обновлять таблицу по этот месяц
	
	Если Резидент = 0 Тогда // нерезиденту эти доходы следует показывать в Разделе 3
		
		Предупреждение("Доходы от продажи имущества нерезидентов РФ "+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
		Таблица.Область(Таблица.АктивнаяОбласть()).Значение = 0;
		Если Таблица.Область(Таблица.АктивнаяОбласть()).Доступность()=1 Тогда
			Таблица.Область(Таблица.АктивнаяОбласть()).ЦветФона(255,255,128);
		КонецЕсли;
		Таблица.АктивнаяОбласть("R47C1");
		
	Иначе
		
		Имя=Таблица.АктивнаяОбласть();
		Номер = Число(Сред(Имя,2));
		НомерСтрокиРедактирования = Цел((Номер-ПерваяЯчейкаРаздела7)/13)+1;
		МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела7)%13;
		Значение = 0;
		Для Сч = 1 По 12 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела7 + (НомерСтрокиРедактирования-1)*13+Сч,3)).Значение		
		КонецЦикла;
		Таблица.Область("ИПродаж"+Строка(НомерСтрокиРедактирования)).Текст = Значение;
		
	КонецЕсли;
	
КонецПроцедуры // ПриВводеПродаж()

//******************************************************************************
// ПриВводеЛьготныхДоходов()
//
// Параметры:
//		нет
//
// Вызывается из ячеек табличного документа:
//		Из раздела 8 таблицы 1-НДФЛ
//
// Возвращаемое значение
//		нет
//
// Описание:
//		Обновляется итоговая колонка в Разделе 8
//  
//
Процедура ПриВводеЛьготныхДоходов()
	
    //ОпределитьЦвет();
	
	Если Резидент = 0 Тогда // нерезиденту эти доходы следует показывать в Разделе 3
		
		Предупреждение("Все доходы налоговых нерезидентов РФ (кроме дивидендов)"+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
		Таблица.Область(Таблица.АктивнаяОбласть()).Значение = 0;
		Если Таблица.Область(Таблица.АктивнаяОбласть()).Доступность()=1 Тогда
			Таблица.Область(Таблица.АктивнаяОбласть()).ЦветФона(255,255,128);
		КонецЕсли;
		Таблица.АктивнаяОбласть("R47C1");
	
	Иначе 
		
		Имя=Таблица.АктивнаяОбласть();
		Номер = Число(Сред(Таблица.АктивнаяОбласть(),2));
		НомерСтрокиРедактирования = Цел((Номер-ПерваяЯчейкаРаздела8)/13)+1;
		МесяцРедактирования=(Номер-ПерваяЯчейкаРаздела8)%13;
		
		// итоговая колонка
		Значение = 0;
		Для Сч = 1 По 12 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела8 + (НомерСтрокиРедактирования-1)*13+Сч,3)).Значение		
		КонецЦикла;
		Таблица.Область("ИДоход"+глДополнитьСтроку(НомерСтрокиРедактирования,2)).Текст = Значение;
		
		// налоговая база за месяц
		Значение = 0;
		ПервыйНомер = ПерваяЯчейкаРаздела8+МесяцРедактирования;
		Для Сч=0 По 4 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер+Сч*13,3)).Значение;
		КонецЦикла;
		Значение = Значение-Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер+65,3)).Значение;
		Таблица.Область("ДохЛьгота"+глДополнитьСтроку(МесяцРедактирования,2)).Текст = Формат(Значение,"Ч015.2."); 
		
		// итог по налоговой базе
		Значение = 0;
		Для Сч=1 По 5 Цикл
			Значение = Значение+Число(Таблица.Область("ИДоход"+глДополнитьСтроку(НомерСтрокиРедактирования,2)).Текст);
		КонецЦикла;
		Значение = Значение-Число(Таблица.Область("ИДоход06").Текст);
		Таблица.Область("ИДохЛьгота").Текст = Формат(Значение,"Ч015.2."); 
	
	КонецЕсли;
	
КонецПроцедуры // ПриВводеЛьготныхДоходов()

//******************************************************************************
// ПолучитСтавкиНДФЛ()
//
Процедура ПолучитСтавкиНДФЛ()
	
	Если Резидент = 1 Тогда // налоговые резиденты РФ
		СтавкаНДФЛ = .13;
		СтавкаПоДивидендам = ?(Год < 2005, .06, .09);
		СтавкаПоМВ = .35;
	Иначе  // физлицо не является налоговым резидентом РФ
		СтавкаНДФЛ = .3;
		Если Дата("01.01."+Год) > '31.12.2007' Тогда
			СтавкаПоДивидендам = .15;
		Иначе
			СтавкаПоДивидендам = СтавкаНДФЛ;
		КонецЕсли;
		СтавкаПоМВ = СтавкаНДФЛ;
	КонецЕсли;
	
КонецПроцедуры // ПолучитСтавкиНДФЛ()

//******************************************************************************
// ЗаполнитьСписокКадровымиДанными(Буфер)
//
Процедура ЗаполнитьСписокКадровымиДанными(Буфер)
	
	// "адресная часть" - разделы 1 и 2
	Буфер.Установить("Название","Налоговая карточка по учету доходов и налога на доходы физических лиц за "+Год+" год № "+глПреобразоватьНомерДок(ФизЛицо.Код, 0, 0));
	Буфер.Установить("ИНН_ЮЛ",				Константа.ИННОрганизации);
	Буфер.Установить("КодОКАТО",			глПолучитьНалог("НДФЛ").КодОКАТО);
	Буфер.Установить("кодИМНС_ЮЛ",			Константа.КодИМНС);
	Буфер.Установить("НазваниеОрганизации", 	Константа.НазваниеОрганизации);
	Буфер.Установить("ИНН_ФЛ", 				ФизЛицо.ИНН);
	
	Буфер.Установить("ФИО", 					СокрЛП(ФизЛицо.Наименование));
	Вид = ФизЛицо.ВидДокумента;
	
	Буфер.Установить("СерияНомерДокумента", 	ФизЛицо.ДокументСерия + " " + ФизЛицо.ДокументНомер);
	Буфер.Установить("ДатаРождения", 		Формат(ФизЛицо.ДатаРождения,"ДДДММГГГГ"));
	
	КодСтраны = ФизЛицо.Страна.Код;
	Резидент = ФизЛицо.Статус.Получить(Дата("31.12." + Год));
	Буфер.Установить("КодСтраны", КодСтраны);
	Буфер.Установить("СтранаСотрудника", ?(Резидент <> 1, КодСтраны, ""));

	ТекстАдреса = ФизЛицо.АдресПрописка;
	Адрес = глРазложить(ТекстАдреса);
	Если Адрес.РазмерСписка() = 10 Тогда
		КодРегиона = "";
		Если (ПустоеЗначение(Адрес.ПолучитьЗначение(3)) = 0) и (Резидент = 1) Тогда
			Параметр = СоздатьОбъект("СписокЗначений");
			Параметр.Установить("Режим открытия", 1);
			Параметр.Установить("Вид объекта", "Регион");
			Параметр.Установить("Полный адрес", СокрЛП(ТекстАдреса));
			ФорматКлассификатора = ВосстановитьЗначение("ФорматКлассификатора");
			Если ПустоеЗначение(ФорматКлассификатора) = 1 Тогда
				ФорматКлассификатора = 1;
			КонецЕсли;
			Параметр.Установить("ФорматКлассификатора", ФорматКлассификатора);

			ОткрытьФормуМодально("Обработка.ВыборИзКлассификатораАдресов", Параметр);
			Если ТипЗначенияСтр(Параметр) = "СписокЗначений" Тогда
				КодРегиона = Лев(Параметр.Получить("Код региона"), 4);
			    КодРегиона = ?((КодРегиона = "9900") или (КодРегиона = "9901"), "9901", Лев(КодРегиона, 2));
			КонецЕсли;
			Если ПустоеЗначение(СокрЛП(КодРегиона)) = 1 Тогда
			    КодРегиона = Лев(ФизЛицо.ИНН, 2);
			КонецЕсли;
		КонецЕсли;
		
		Буфер.Установить("Индекс", ?(Резидент = 1, Адрес.ПолучитьЗначение(2), ""));
		Буфер.Установить("Регион", КодРегиона);
		Буфер.Установить("Район", Адрес.ПолучитьЗначение(4));
		Буфер.Установить("Город", Адрес.ПолучитьЗначение(5));
		Буфер.Установить("НаселенныйПункт", Адрес.ПолучитьЗначение(6));
		Буфер.Установить("Улица", Адрес.ПолучитьЗначение(7));
		Буфер.Установить("Дом", Адрес.ПолучитьЗначение(8));
		Буфер.Установить("Корпус", Адрес.ПолучитьЗначение(9));
		Буфер.Установить("Квартира", Адрес.ПолучитьЗначение(10));
	Иначе
	    Буфер.Установить("Индекс", "");
		Буфер.Установить("Регион", "");
		Буфер.Установить("Район", "");
		Буфер.Установить("Город", "");
		Буфер.Установить("НаселенныйПункт", "");
		Буфер.Установить("Улица", "");
		Буфер.Установить("Дом", "");
		Буфер.Установить("Корпус", "");
		Буфер.Установить("Квартира", "");
	КонецЕсли;
	
	Буфер.Установить("Резидентство",Строка(?(Резидент=1,1,2)));
	Буфер.Установить("СтраховойНомерПФР", ФизЛицо.СтраховойНомерПФР);
	Буфер.Установить("КодДокумента",		ФизЛицо.ВидДокумента.КодНДФЛ);
	
КонецПроцедуры // ЗаполнитьСписокКадровымиДанными()

//******************************************************************************
// ЗаполнитьТаблицу(ОбобщеннаяТаблица,УчитыватьСправочники)
//
// Параметры:
//		ОбобщеннаяТаблица - контекст формы, передан для заполнения данными.
//		УчитыватьСправочники - число 1 (по умолчанию) или 0, не обязателен; если равен 0 - данные из справочников не собираются.
//							
// Возвращаемое значение:
//		0 или 1 - прервана (0) или нет (1) работа процедуры сбора доходов
//
// Описание:
//		заполняет переданную таблицу обработанными данными о доходах
//		
Функция ЗаполнитьТаблицу(ОбобщеннаяТаблица)
	
	ИтогиПоГодуСотра = СоздатьОбъект("Справочник.КарточкиУчетаДоходов");
	ИтогиПоГодуСотра.ИспользоватьВладельца(ФизЛицо);
	ИтогиПоГодуСотра.НайтиПоКоду(Строка(Год));
	БуферРазделов3 = ЗначениеИзСтроки(ИтогиПоГодуСотра.СписокПолейНалоговойКарточки);
	Если ПустоеЗначение(СокрЛП(БуферРазделов3)) = 1 Тогда
		БуферРазделов3 = СоздатьОбъект("СписокЗначений"); // список в котором будет столько строк, сколько будет 5-ых разделов
	КонецЕсли;
	
	СписокВводаРаздела5 = ЗначениеИзСтроки(ИтогиПоГодуСотра.СписокПолейНалоговойКарточкиПоМатВыгоде);
	Если ПустоеЗначение(СокрЛП(СписокВводаРаздела5)) = 1 Тогда
		СписокВводаРаздела5 = СоздатьОбъект("СписокЗначений"); // список в котором будет столько строк, сколько будет 5-ых разделов
	КонецЕсли;

	// "адресная часть" - разделы 1 и 2
	БуферРазделов12 = СоздатьОбъект("СписокЗначений");
	ЗаполнитьСписокКадровымиДанными(БуферРазделов12);
	ПолучитСтавкиНДФЛ();
	
	СальдоНаНачалоГода = ?(ДатаГод(ФизЛицо.ДатаПриема) < Год, 0,ФизЛицо.СальдоНалогаНаДоходы.Получить(Дата(Год,12,31)));
	
	// загружаем значения всех ячеек
	Для НомерВычетаВРазделе = 1 По 5 Цикл
		Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3+(4+НомерВычетаВРазделе)*13,3)).Значение="Код";
	КонецЦикла;
	
	РазделыНК = ОбобщеннаяТаблица.Таблица;
	РазделыНК.Загрузить(БуферРазделов3);
	
	Для НомерЗначения = 1 по БуферРазделов12.РазмерСписка() Цикл
		ИмяПараметра = "";
		ЗначениеПараметра = БуферРазделов12.ПолучитьЗначение(НомерЗначения, ИмяПараметра);
		Если ПустоеЗначение(РазделыНК.Область(ИмяПараметра)) = 0 Тогда
		    РазделыНК.Область(ИмяПараметра).Значение = ЗначениеПараметра;
		КонецЕсли;
	КонецЦикла; 
	
	// запоминаем "образ" таблицы для последующих проверок
	ИсходнаяТаблица = СоздатьОбъект("СписокЗначений");
	РазделыНК.Выгрузить(ИсходнаяТаблица);
	
	РазделыНК.Область("Исчислено3Раздел01").Доступность(1);
	РазделыНК.Область("Исчислено5Раздел01").Доступность(1);
	РазделыНК.Область("Исчислено3Раздел01").ЦветФона(РазделыНК.П001.ЦветФона());
	РазделыНК.Область("Исчислено5Раздел01").ЦветФона(РазделыНК.П001.ЦветФона());
	
	ПервыйМесяцРасчетов = 13;
	
	Если СписокВводаРаздела5.РазмерСписка() > 0 Тогда
		ТекКодРаздела5 = "";
		Для Сч = 1 По СписокВводаРаздела5.РазмерСписка() Цикл
			Если СписокВводаРаздела5.ПолучитьЗначение(Сч).Итог("СуммаДохода")<>0 Тогда
				ТекТаблицаРаздела = СписокВводаРаздела5.ПолучитьЗначение(Сч, ТекКодРаздела5);
				Прервать;
			КонецЕсли;
			СписокВводаРаздела5.ПолучитьЗначение(1, ТекКодРаздела5);
		КонецЦикла;
		РазделыНК.Область("Доход5раздела").Значение = "Код дохода " + ТекКодРаздела5 + " сумма дохода";
		ПриСменеДохода5Раздела();
	Иначе
		РазделыНК.Область("Доход5раздела").Значение = "Код дохода ___ сумма дохода";
	КонецЕсли;
	
	ПоследнийМесяц = Число(БуферРазделов3.Получить("ПоследнийМесяц"));
	Таблица.ЕстьВычеты.Текст = ?(Таблица.Область("ИОбщСВ").Значение = 0, "2", "1"); 
	
	Если (ДатаГод(ФизЛицо.ДатаПриема) < Год) Тогда
		Если СальдоНаНачалоГода > 0 Тогда
			Таблица.Область("П002").Значение=СальдоНаНачалоГода;
			Таблица.Область("П001").Значение=0;
		ИначеЕсли СальдоНаНачалоГода < 0 Тогда              
			Таблица.Область("П001").Значение=СальдоНаНачалоГода;
			Таблица.Область("П002").Значение=0;
		КонецЕсли;
	ИначеЕсли (ДатаГод(ФизЛицо.ДатаПриема) = Год) Тогда
		СуммаСПредМестаРаботы = ФизЛицо.ВаловойДоход_СНачалаГода;
		Таблица.Область("СуммаСПредМестаРаботы").Текст = СуммаСПредМестаРаботы;
	КонецЕсли;
	
	Возврат 1
	
КонецФункции // ЗаполнитьТаблицу

//*****************************************************************************
// Очистить(Спрашивать = 1)
//
// Параметры
//		Спрашивать - число 1 или 0 - проверять ли заполненность карточки
//		ТекстВопроса - передается непустая строка, если надо задать свой текст вопроса
//
// Вызывается из формул элементов диалога
//		Очистить
//
// Возвращаемое значение
//		0 - если от очистки отказались
//
// Описание
//		очищает все поля ввода и зависимые от них расчетные поля для 
//		последующего заполнения
//
Функция Очистить(Спрашивать = 1, ТекстВопроса="", ПарамВыбранныйМесяц = 0)
	
	ВыбранныйМесяц = 1;
	
	// если в карточке есть какие-либо цифры - спросим, точно ли нужно все перезаполнить
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	
	// просто просуммируем квадраты всех введенных чисел; если есть хоть одно число - сумма получится ненулевой
	СуммаВсехЧисел = 0;
	Для Сч = 1 По СЗТекущееСостояние.РазмерСписка()  Цикл
		Зн = СЗТекущееСостояние.ПолучитьЗначение(Сч);
		Если ТипЗначения(Зн) = 1 Тогда
			СуммаВсехЧисел = СуммаВсехЧисел + Зн * Зн
		ИначеЕсли ПустоеЗначение(Зн) = 0 Тогда
			СуммаВсехЧисел = 1	
		КонецЕсли;
		Если СуммаВсехЧисел <> 0 Тогда
			Прервать
		КонецЕсли;
	КонецЦикла;
	
	Если СуммаВсехЧисел = 0 Тогда 
		Возврат 1;
	КонецЕсли;
	
	Если Спрашивать = 1 Тогда
		
		СпМеню = СоздатьОбъект("СписокЗначений");
		ДатаМеню = Дата(Год, 1, 15);
		СпМеню.ДобавитьЗначение(ДатаМеню, "с Января");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 1), "с Февраля");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 2), "с Марта");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 3), "с Апреля");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 4), "с Мая");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 5), "с Июня");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 6), "с Июля");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 7), "с Августа");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 8), "с Сентября");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 9), "с Октября");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 10), "с Ноября");
		СпМеню.ДобавитьЗначение(ДобавитьМесяц(ДатаМеню, 11), "с Декабря");
		
		ВыбранноеЗначение = "";
		Если СпМеню.ВыбратьЗначение(ВыбранноеЗначение,,,,1) = 1 тогда
			ИмяМесяца = ИмяМесяца;
			СпМеню.ПолучитьЗначение(ДатаМесяц(ВыбранноеЗначение), ИмяМесяца);
			Если ТекстВопроса="" Тогда
				ТекстВопроса="Карточка будет очищена " + Прав(ИмяМесяца, СтрДлина(ИмяМесяца) - 2) + " месяца
				|Продолжить?";  
			КонецЕсли;
			Если Вопрос(ТекстВопроса, "Да+Нет")="Нет" Тогда
				Возврат 0;
			КонецЕсли;
			ВыбранныйМесяц = ДатаМесяц(ВыбранноеЗначение);
		КонецЕсли;
	КонецЕсли;
	
	Если ПарамВыбранныйМесяц <> 0 Тогда
	    ВыбранныйМесяц = ПарамВыбранныйМесяц;
	КонецЕсли;
		
	Если ВыбранныйМесяц = 1 тогда
		//Таблица.Область("ДолгНП").Значение=0; 
		//Таблица.Область("ДолгНА").Значение=0; 
		Таблица.Область("П001").Значение=0; 
		Таблица.Область("П002").Значение=0; 
		Таблица.Область("Раздел3").Значение=0; 
		Таблица.Область("Раздел4").Значение=0; 
		Таблица.Область("Раздел5").Значение=0; 
		Таблица.Область("Раздел6").Значение=0; 
		Таблица.Область("Раздел7").Значение=0; 
		//Таблица.Область("Раздел8").Значение=0; 
		Таблица.Область("Раздел9").Значение=0; 
		Таблица.Область("ТипыДоходов").Значение=""; 
		Таблица.Область("ТипыВычетов").Значение=""; 
		Таблица.Область("КодыПродаж").Значение=""; 
		//Таблица.Область("КодыЛьготСубъектовРФ").Значение=""; 
		
		Для Сч = 1 По СписокПрочихПолейКарточки.РазмерСписка() Цикл
			Таблица.Область(СписокПрочихПолейКарточки.ПолучитьЗначение(Сч)).Значение=""; 	
		КонецЦикла;
		
		//цвет фона - вернем в бледно-желтое состояние числовые поля:
		Таблица.Область("Раздел3_1").ЦветФона(255,255,128); 
		Таблица.Область("Раздел3_2").ЦветФона(255,255,128); 
		Таблица.Область("Раздел3_3").ЦветФона(255,255,128); 
		Таблица.Область("Раздел4_1").ЦветФона(255,255,128); 
		Таблица.Область("Раздел4_2").ЦветФона(255,255,128); 
		Таблица.Область("Раздел4_3").ЦветФона(255,255,128); 
		Таблица.Область("Раздел5_1").ЦветФона(255,255,128); 
		Таблица.Область("Раздел5_2").ЦветФона(255,255,128); 
		Таблица.Область("Раздел5_3").ЦветФона(255,255,128); 
		Таблица.Область("Продажи1").ЦветФона(255,255,128); 
		//Таблица.Область("ЛьготыСубъектаРФ1").ЦветФона(255,255,128); 
		Таблица.Область("Раздел9").ЦветФона(255,255,128); 
	Иначе
		//Таблица.Область("ДолгНП").Значение=0; 
		//Таблица.Область("ДолгНА").Значение=0; 
		Таблица.Область("П001").Значение=0; 
		Таблица.Область("П002").Значение=0; 
		Таблица.Область("Раздел3_О" + ВыбранныйМесяц).Значение=0; 
		Таблица.Область("Раздел4_О" + ВыбранныйМесяц).Значение=0; 
		Таблица.Область("Раздел5_О" + ВыбранныйМесяц).Значение=0; 
		Таблица.Область("Раздел6").Значение=0; 
		Таблица.Область("Раздел7_О" + ВыбранныйМесяц).Значение=0; 
		//Таблица.Область("Раздел8_" + ВыбранныйМесяц).Значение=0; 
		Таблица.Область("Раздел9").Значение=0; 
	КонецЕсли;
	// необходимо очистить таблицу 5 раздела.  
	Для Сч =1 По СписокВводаРаздела5.РазмерСписка() Цикл
		ТаблицаТекущего5Раздела = СписокВводаРаздела5.ПолучитьЗначение(Сч);
		Для Ссч = -ТаблицаТекущего5Раздела.КоличествоСтрок() По  -1 Цикл
			ТаблицаТекущего5Раздела.ПолучитьСтрокуПоНомеру(-Ссч); 
			Если ТаблицаТекущего5Раздела.НомерСтроки >= ВыбранныйМесяц  Тогда
				ТаблицаТекущего5Раздела.УдалитьСтроку(-Ссч)
			КонецЕсли;
		КонецЦикла;	
	КонецЦикла;
	
	ВидыВычетов = СоздатьОбъект("Справочник.ВидыВычетов");
	Для НомерВычетаВРазделе = 1 По 5 Цикл
		ИмяОбл = "П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3+(4+НомерВычетаВРазделе)*13,3);
		Если ВидыВычетов.НайтиПоКоду(Прав(Таблица.Область(ИмяОбл).Значение, 3)) = 0 Тогда
			Таблица.Область(ИмяОбл).Значение="Код";
		КонецЕсли;
	КонецЦикла;
	
	ПоследнийМесяц = ВыбранныйМесяц - 1;
	ПоследнийМесяц = ?(ПоследнийМесяц = 0, 1, ПоследнийМесяц);
	// рассчитаем все итоги
	// колонка "Итого" Раздела 3
	ИтогоБезВычетов = 0;
	Для индСтрокиДоходов = 1 по 10 Цикл
		Значение = 0;
		Для Сч = 1 По 12 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (индСтрокиДоходов-1)*13+Сч,3)).Значение;
			ИтогоБезВычетов = ИтогоБезВычетов + ?(индСтрокиДоходов > 5, -1, 1) * Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (индСтрокиДоходов-1)*13+Сч,3)).Значение;
		КонецЦикла;
		Таблица.Область("ИД"+глДополнитьСтроку(индСтрокиДоходов,2)).Текст = Значение;
	КонецЦикла;
    	
	Если Резидент = 1 тогда
		Таблица.Область("ИГДБезВ").Значение = ИтогоБезВычетов;
		// Колонка "Итого" вычеты
		СуммаВсехВычетов = 0;
		Для индСтрокиВычетов = 1 по 3 Цикл
			Значение = 0;
			Для Сч = 1 По 12 Цикл
				Значение = Значение + Таблица.Область("СВМес" + индСтрокиВычетов + глДополнитьСтроку(Сч, 2)).Значение;
				СуммаВсехВычетов = СуммаВсехВычетов + Таблица.Область("СВМес" + индСтрокиВычетов + глДополнитьСтроку(Сч, 2)).Значение;
			КонецЦикла;
			Таблица.Область("ИСВМес"+индСтрокиВычетов).Текст = Значение;
		КонецЦикла;
		Таблица.Область("ИОбщСВ").Текст = СуммаВсехВычетов;
		Таблица.Область("ИНБаза").Текст = Таблица.Область("НБаза" + глДополнитьСтроку(ПоследнийМесяц, 2)).Значение;
		Для Сч = 1 По ПоследнийМесяц Цикл
			//Накоплено=Накоплено+Число(Таблица.Область("МДБезВ"+глДополнитьСтроку(Сч,2)).Текст);
			//Таблица.Область("ГДБезВ"+глДополнитьСтроку(Сч,2)).Текст = Формат(Накоплено,"Ч015.2."); 
			//Таблица.Область("ИНБаза").Текст = Формат(Накоплено,"Ч015.2."); 
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ПозСк=Найти(ТекстИсч,"(");
			Если ПозСк>0  Тогда
				ТекстИсч=Лев(ТекстИсч,ПозСк-1)
			КонецЕсли;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
			СальдоОсн = ИсчисленоОсн - УдержаноОсн;
			//Таблица.Область("МДолгНП"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
			//Таблица.Область("МДолгНА"+глДополнитьСтроку(Сч,2)).Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		КонецЦикла;
		Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
		Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
		Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
		Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		// Итого раздел 4
		Значение = 0;
		Для Сч = 12 По 23 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4 + Сч,3)).Значение		
		КонецЦикла;
		Таблица.Область("ИДив").Текст = Формат(Значение,"Ч015.2.");
		Значение = 0;
		Для Сч = 1 По 12 Цикл
			Значение = Значение+Таблица.Область("ОбДив"+глДополнитьСтроку(Сч,2)).Значение		
		КонецЦикла;
		Таблица.Область("ИОбДив").Текст = Формат(Значение,"Ч015.2.");
		// налог исчисленный раздел 4
		Значение = 0;
		Исчислено=0;
		Для Сч = 1 По 12 Цикл
			ТекстИсч=Таблица.Область("НД6И"+глДополнитьСтроку(Сч,2)).Текст;
			ПозСк=Найти(ТекстИсч,"(");
			Если ПозСк>0  Тогда
				ТекстИсч=Лев(ТекстИсч,ПозСк-1)
			КонецЕсли;
			//Значение = Значение+Число(Таблица.Область("НДЗач"+глДополнитьСтроку(Сч,2)).Текст);		
			Исчислено = Исчислено+Число(ТекстИсч);
		КонецЦикла;
		//Таблица.Область("ИНДЗач").Текст = Формат(Значение,"Ч015.2.");
		Таблица.Область("ИНД6И").Текст = Формат(Исчислено,"Ч015.2.");
		// налог удержанный раздел 4
		Удержано=0;
		Для Сч = 24 По 35 Цикл
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4+Сч,3)).Значение;
		КонецЦикла;
		Таблица.Область("ИДивНУ").Текст = Формат(Удержано,"Ч015.2.");
		// долги раздел 4
		Исчислено=0;
		Удержано=0;
		Зачтено=0;
		
		Для Сч = 1 По ПоследнийМесяц-1  Цикл
			
			ТекстИсч=Таблица.Область("НД6И"+глДополнитьСтроку(Сч,2)).Текст;
			ПозСк=Найти(ТекстИсч,"(");
			Если ПозСк>0  Тогда
				ТекстИсч=Лев(ТекстИсч,ПозСк-1)
			КонецЕсли;
			Исчислено=Исчислено+Число(ТекстИсч);
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела4+23+Сч,3)).Значение;
			
		КонецЦикла;
		
		Сальдо = Исчислено - Удержано;
		
		Таблица.Область("ИДДолгНП").Текст = Формат(Макс(Сальдо,0),"Ч015.2.");
		Таблица.Область("ИДДолгНА").Текст = Формат(Макс(-Сальдо,0),"Ч015.2.");
		// колонка "Итого" раздел 5 
		
		Исчислено=0;
		Удержано=0;
		Зачтено=0;

		НомерСтрокиРазд5 = 1;
		Значение = 0;
		Для Сч = 1 По 12 Цикл
			Значение = Значение+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5 + (НомерСтрокиРазд5-1)*12+Сч,3)).Значение;
		КонецЦикла;
		Таблица.Область("ИСТ35_"+глДополнитьСтроку(НомерСтрокиРазд5,2)).Текст = Значение;
		
		Если Значение = 0 Тогда
		    Доход5раздела = "";
		КонецЕсли;

		Для Сч = 1 По ПоследнийМесяц  Цикл
			Если НомерСтрокиРазд5 < 7  Тогда
				НалоговаяБаза=НалоговаяБаза+Число(Таблица.Область("Дох35НБ"+глДополнитьСтроку(Сч,2)).Текст);
			КонецЕсли;
			ТекстИсч=Таблица.Область("СТ35НИ"+глДополнитьСтроку(Сч,2)).Текст;
			Исчислено=Исчислено+Число(ТекстИсч);
			Удержано=Удержано+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5+72+Сч,3)).Значение;
		КонецЦикла;
		// долги раздел 5
		СальдоОсн = Исчислено - Удержано;
		
 					Таблица.Область("ИДох35НБ").Текст = Формат(НалоговаяБаза,"Ч015.2.");
		Таблица.Область("ИСТ35НИ").Текст = Формат(Исчислено,"Ч015.2.");
		
		Таблица.Область("ИДолг35НП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
		Таблица.Область("ИДолг35НА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
	Иначе
		
		Таблица.Область("ИНБаза").Текст = Таблица.Область("НБаза" + глДополнитьСтроку(ПоследнийМесяц, 2)).Значение;
		ИсчисленоОсн=0;
		УдержаноОсн=0;
		Для Сч = 1 По ПоследнийМесяц  Цикл
			ТекстИсч=Таблица.Область("НИ"+глДополнитьСтроку(Сч,2)).Текст;
			ПозСк=Найти(ТекстИсч,"(");
			Если ПозСк>0  Тогда
				ТекстИсч=Лев(ТекстИсч,ПозСк-1)
			КонецЕсли;
			ИсчисленоОсн=ИсчисленоОсн+Число(ТекстИсч);
			УдержаноОсн=УдержаноОсн+Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаУдержанныхНалоговРаздела3-1+Сч,3)).Значение;
		КонецЦикла;
		СальдоОсн = ИсчисленоОсн - УдержаноОсн;
		Таблица.Область("ИНИ").Текст = Формат(ИсчисленоОсн,"Ч015.2.");
		Таблица.Область("ИНУ").Текст = Формат(УдержаноОсн,"Ч015.2.");
		Таблица.Область("ИМДолгНП").Текст = Формат(Макс(СальдоОсн,0),"Ч015.2.");
		Таблица.Область("ИМДолгНА").Текст = Формат(Макс(-СальдоОсн,0),"Ч015.2.");
		
	КонецЕсли;
	ПриВводеСуммИзменяющихСальдо("НалВзыск");
	ПриВводеСуммИзменяющихСальдо("НалВозвр");
	ПриВводеСуммИзменяющихСальдо("ДНалВзыск");
	ПриВводеСуммИзменяющихСальдо("ДНалВозвр");
	ПриВводеСуммИзменяющихСальдо("Нал35Взыск");
	ПриВводеСуммИзменяющихСальдо("Нал35Возвр");
	ОбновитьРаздел6();
	
	Возврат 1;

КонецФункции //Очистить

//*****************************************************************************
// Восстановить()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		Восстановить
//
// Возвращаемое значение
//		нет
//
// Описание
//		повторно заполняет таблицу по данным, имеющимся в информационной базе
//
Процедура Восстановить()
	Если Вопрос("Текущие данные будут потеряны!"+РазделительСтрок+"Восстановить сохраненные ранее данные?","Да+Нет")="Нет" Тогда
		Возврат;
	КонецЕсли;
	Очистить(0); 
	ЗаполнитьТаблицу(Контекст);
КонецПроцедуры //Восстановить

//******************************************************************************
// ПриВыбореСотрудника()
//
Процедура ПриВыбореСотрудника()

	Очистить(0);
	ЗаполнитьТаблицу(Контекст);
	Форма.Заголовок(": "+ФизЛицо.Наименование,1);

КонецПроцедуры // ПриВыбореСотрудника()

//******************************************************************************
Функция УказатьСотрудника()
	
	Если ПустоеЗначение(ФизЛицо) = 1 Тогда
		Сотр = СоздатьОбъект("Справочник.Сотрудники");
		Если Сотр.Выбрать("Укажите сотрудника", "ДляВыбора") = 0 Тогда
			Возврат 0;
		КонецЕсли;
		ФизЛицо = Сотр.ТекущийЭлемент();
		ПриВыбореСотрудника();
	КонецЕсли;
	
	Возврат 1;
	
КонецФункции // УказатьСотрудника()

//*****************************************************************************
// Сохранить()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		Сохранить
//
// Возвращаемое значение
//		число 1 или 0 - удалось (не удалось) сохранить данные
//
// Описание
//		сохраняет во вспомогательных справочниках разницу между
//      расчетными данными и имеющимися в карточке
//
Функция Сохранить() 
	
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	Если СпискиИдентичны(СЗТекущееСостояние,ИсходнаяТаблица) = 0 Тогда
		
		Если УказатьСотрудника() = 0 Тогда
		    Возврат 0;
		КонецЕсли;
		
		СписокДляСохранения = СоздатьОбъект("СписокЗначений");
		СписокДляСохраненияРаздела5 = СоздатьОбъект("СписокЗначений");
		СпрИтоговПоГоду = СоздатьОбъект("Справочник.КарточкиУчетаДоходов");
		СпрИтоговПоГоду.ИспользоватьВладельца(ФизЛицо);
		
		НачатьТранзакцию();
		
		// Поиск карточки в справочнике
		ИтогиПоГодуИзменены = 0;
		Если СпрИтоговПоГоду.НайтиПоКоду(Строка(Год)) = 0 Тогда
			ИтогиПоГодуИзменены = 1;
		    СпрИтоговПоГоду.Новый();
			СпрИтоговПоГоду.Код = Строка(Год);
		Иначе
			СпрИтоговПоГоду.ВыбратьЭлементы();
			СписокЭлементов = СоздатьОбъект("СписокЗначений");
			Пока СпрИтоговПоГоду.ПолучитьЭлемент() = 1 Цикл
				Если СпрИтоговПоГоду.Код = Строка(Год) Тогда
					СписокЭлементов.ДобавитьЗначение(СпрИтоговПоГоду.ТекущийЭлемент());
				КонецЕсли;
			КонецЦикла;
			// в справочнике должен быть только один элемент
			// с данными за каждый год 
			Элемент = СписокЭлементов.ПолучитьЗначение(1);
			СписокЭлементов.УдалитьЗначение(1);
			// лишние элементы (возможно, появившиеся в распределенных ИБ) - удалим
			Если СписокЭлементов.РазмерСписка() > 0 Тогда
				Для индСписка = 1 по СписокЭлементов.РазмерСписка() Цикл
					СпрИтоговПоГоду.НайтиЭлемент(СписокЭлементов.ПолучитьЗначение(индСписка));
					СпрИтоговПоГоду.Удалить(1);
				КонецЦикла;
				СписокЭлементов.УдалитьВсе();
			КонецЕсли;
			СпрИтоговПоГоду.НайтиЭлемент(Элемент);		
		КонецЕсли;
		
		// Сортировка льгот из раздела 3
		ВывестиСообщение = 0;
		Для НомерСтрокиРедактирования = 0 По 4 Цикл
			СуммаДохода = Таблица.Область("ИД"+глДополнитьСтроку(НомерСтрокиРедактирования+1,2)).Значение;
			Если СуммаДохода <> 0 Тогда
				КодДохода = Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + НомерСтрокиРедактирования*13,3)).Значение;
				КодВычета = "";
				
				Для НомерСтрокиВычета = 5 По 9 Цикл
					КодВычета = Прав(Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3+НомерСтрокиВычета*13,3)).Значение, 3);
					Если (Найти(",404,405,",","+КодВычета+",") > 0) и (Лев(КодДохода,2) = "22") Тогда // расходы по авторским вознаграждениям
						КодВычета = "";
						Прервать;
					
					ИначеЕсли (КодДохода = "2000") Тогда
						Если КодВычета = "403" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (КодДохода = "2720") Тогда
						Если КодВычета = "501" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (КодДохода = "2730") Тогда
						Если КодВычета = "502" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (КодДохода = "2740") Тогда
						Если КодВычета = "505" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (КодДохода = "2760") Тогда
						Если КодВычета = "503" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (КодДохода = "2770") Тогда
						Если КодВычета = "504" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (КодДохода = "2790") Тогда
						Если КодВычета = "507" Тогда
						    Прервать
						Иначе
							КодВычета = "";
						КонецЕсли;
						
					ИначеЕсли (Найти(",15303,15403,", "," + КодДохода + ",") > 0) тогда
						КодВычета = Прав(Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (НомерСтрокиРедактирования + 5) * 13, 3)).Значение, 3);
						Если Лев(КодВычета, 1) <> "3" тогда
							КодВычета = "";
						КонецЕсли;
					КонецЕсли;
					
					Если НомерСтрокиВычета = 9 Тогда
					    Прервать;
					КонецЕсли;
				КонецЦикла;
				
				Если ПустоеЗначение(КодВычета) = 0 Тогда // значит нашли вычет и надо поменять строки
					Если (НомерСтрокиРедактирования + 5) <> НомерСтрокиВычета Тогда
					    КодВычета1 = Прав(Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3+НомерСтрокиВычета*13,3)).Значение, 3);
						КодВычета2 = Прав(Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3+(НомерСтрокиРедактирования + 5)*13,3)).Значение, 3);
						
						Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3+НомерСтрокиВычета*13,3)).Значение = "Код " + КодВычета2;
						Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаРаздела3+(НомерСтрокиРедактирования + 5)*13,3)).Значение = "Код " + КодВычета1;
						
						Итог1 = Таблица.Область("ИД" + глДополнитьСтроку(НомерСтрокиВычета + 1, 2)).Значение;
						Итог2 = Таблица.Область("ИД" + глДополнитьСтроку(НомерСтрокиРедактирования + 6, 2)).Значение;
						
						Таблица.Область("ИД" + глДополнитьСтроку(НомерСтрокиВычета + 1, 2)).Значение = Итог2;
						Таблица.Область("ИД" + глДополнитьСтроку(НомерСтрокиРедактирования + 6, 2)).Значение = Итог1;
						
						Для НомерМесяца = 1 по 12 Цикл
							ПервыйНомер = ПерваяЯчейкаРаздела3 + НомерМесяца;
							
							СуммаВычета1 = Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер + НомерСтрокиВычета * 13, 3)).Значение;
							СуммаВычета2 = Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер + (НомерСтрокиРедактирования + 5) * 13, 3)).Значение;
							
							Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер + НомерСтрокиВычета * 13, 3)).Значение = СуммаВычета2;
							Таблица.Область("П"+глДополнитьСтроку(ПервыйНомер + (НомерСтрокиРедактирования + 5) * 13, 3)).Значение = СуммаВычета1;
						КонецЦикла;
						
						ВывестиСообщение = 1;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		Если ВывестиСообщение = 1 Тогда
		    Сообщить("Строки раздела 3, отражающие налоговые вычеты, были отсортированы в соответствии с указанными кодами доходов");
		КонецЕсли;
		
		// Преобразуем таблицу (mxl) в строку
		Таблица.Выгрузить(СписокДляСохранения);
		
		// Добавим в список итоговые значения.
		Для а = 1 по ИменаИтоговКарточки.РазмерСписка() Цикл
			ТекИтог = ИменаИтоговКарточки.ПолучитьЗначение(а);
			СписокДляСохранения.Установить(ТекИтог, Таблица.Область(ТекИтог).Значение);
		КонецЦикла;
		
		СписокДляСохранения.Установить("ПоследнийМесяц", ПоследнийМесяц);
		
		// Выгрузка данных в строку
		СтрокаДанных = ЗначениеВСтроку(СписокДляСохранения);
		
		// Сохранение таблицы 5-ого раздела
		СтрокаДанныхРаздела5 = ЗначениеВСтроку(СписокВводаРаздела5);
		
		// Запись в справочник
		Если (СпрИтоговПоГоду.СписокПолейНалоговойКарточки <> СтрокаДанных) или
			 (СпрИтоговПоГоду.СписокПолейНалоговойКарточкиПоМатВыгоде <> СтрокаДанныхРаздела5) Тогда
		    СпрИтоговПоГоду.СписокПолейНалоговойКарточки = СтрокаДанных;
			СпрИтоговПоГоду.СписокПолейНалоговойКарточкиПоМатВыгоде = СтрокаДанныхРаздела5;
			СпрИтоговПоГоду.Записать();
		КонецЕсли;
		
		// Запись реквизитов справочника "Сотрудники".
		Если (ДатаГод(ФизЛицо.ДатаПриема) = Год) и
			 (ДатаМесяц(ФизЛицо.ДатаПриема) > 1) Тогда
			Сотр = СоздатьОбъект("Справочник.Сотрудники");
			Сотр.НайтиЭлемент(ФизЛицо);
			НалоговаяБаза = 0;
			НалогИсчисленный = 0;
			СальдоНаНачалоГодаНовое = Таблица.Область("П002").Значение-Таблица.Область("П001").Значение;
			
			Для а = 1 по (ДатаМесяц(ФизЛицо.ДатаПриема) - 1) Цикл
				Если Резидент = 1 Тогда
				    НалоговаяБазаТекущегоМесяца = Таблица.Область("НБаза"+Формат(а, "Ч(0)2")).Значение;
					Если НалоговаяБазаТекущегоМесяца <> НалоговаяБаза Тогда
						НалоговаяБаза = НалоговаяБазаТекущегоМесяца;
						НалогИсчисленный = Таблица.Область("НИ"+Формат(а, "Ч(0)2")).Значение;
					КонецЕсли;
					
				Иначе
					НалоговаяБаза = НалоговаяБаза + Таблица.Область("НБаза"+Формат(а, "Ч(0)2")).Значение;
					НалогИсчисленный = НалогИсчисленный + Таблица.Область("НИ"+Формат(а, "Ч(0)2")).Значение;
				КонецЕсли;
			КонецЦикла;
			
			Если (Сотр.ДоходОблагаемыйНДФЛ_СНачалаГода <> НалоговаяБаза)
			или (СальдоНаНачалоГода <> СальдоНаНачалоГодаНовое) 
			или (СуммаСПредМестаРаботы<>Таблица.Область("СуммаСПредМестаРаботы").Значение) Тогда
			    Сотр.ДоходОблагаемыйНДФЛ_СНачалаГода = НалоговаяБаза;
				Сотр.НачисленныйНДФЛ_СНачалаГода = НалогИсчисленный;
				Сотр.СальдоНалогаНаДоходы.Установить(Дата("31.12." + Год),СальдоНаНачалоГодаНовое);
				Сотр.ВаловойДоход_СНачалаГода = Таблица.Область("СуммаСПредМестаРаботы").Значение;
				
				Попытка
					Сотр.Записать();
					Сообщить("В справочник ""Сотрудники"" записаны начальные данные расчета НДФЛ сотрудника "+ФизЛицо);
				Исключение
					Предупреждение("Неудачная попытка записать начальные данные 
									|расчета НДФЛ в справочник ""Сотрудники"".
									|Запись """+ФизЛицо+""" заблокирована.");
					Возврат 0;
				КонецПопытки;
			КонецЕсли;
		КонецЕсли;
		
		Таблица.Выгрузить(ИсходнаяТаблица);

		ЗафиксироватьТранзакцию();

	КонецЕсли;

	Возврат 1
	
КонецФункции //Сохранить

//*****************************************************************************
// ПриВыбореГода()
//
// Параметры
//		нет
//
// Вызывается из формул элементов диалога
//		СпЛет
//
// Возвращаемое значение
//		нет
//
// Описание
//		карточка перезаполняется данными выбранного года, если был выбран
//		другой год
//
Процедура ПриВыбореГода()
	НовыйГод = СпЛет.ПолучитьЗначение(СпЛет.ТекущаяСтрока());
	Если Год <> НовыйГод Тогда // выбран другой год - перезаполняем таблицу
		Если Сохранить() = 0 Тогда
			Год = НовыйГод;
		    Возврат
		КонецЕсли;
		Очистить(0);
		Год = НовыйГод;
		ЗаполнитьТаблицу(Контекст)
	КонецЕсли;
КонецПроцедуры //ПриВыбореГода

//******************************************************************************
// ЗаполнитьСписокПрочихПолейКарточки()
//
// Параметры:
//		нет
//
// Возвращаемое значение:
//		список значений  
//
// Описание:
//  
//
Функция ЗаполнитьСписокПрочихПолейКарточки()
	Список = СоздатьОбъект("СписокЗначений");
	Список.ДобавитьЗначение("ДокРезидентства");	// 1
	Список.ДобавитьЗначение("П145");			// 2
	Список.ДобавитьЗначение("П146");			// 3
	Список.ДобавитьЗначение("П147");			// 4
	Список.ДобавитьЗначение("П148");			// 5
	Список.ДобавитьЗначение("П149");			// 6
	Список.ДобавитьЗначение("П150");			// 7
	Список.ДобавитьЗначение("П151");			// 8
	Список.ДобавитьЗначение("ОтрДоход");		// 9
	Список.ДобавитьЗначение("ПерДоход");		// 10
	Список.ДобавитьЗначение("ОтрВычеты");		// 11
	Список.ДобавитьЗначение("ПерВычеты");		// 12
	Список.ДобавитьЗначение("ОтрДоходБезВычет");// 13
	Список.ДобавитьЗначение("ПерДоходБезВычет");// 14
	Список.ДобавитьЗначение("ОтрНИ");			// 15
	Список.ДобавитьЗначение("ПерНИ");			// 16
	Список.ДобавитьЗначение("П418");			// 17
	Список.ДобавитьЗначение("П419");			// 18
	Список.ДобавитьЗначение("П420");			// 19
	Список.ДобавитьЗначение("П421");			// 20
	Список.ДобавитьЗначение("П422");			// 21
	Список.ДобавитьЗначение("П423");			// 22
	Список.ДобавитьЗначение("П424");			// 23
	Список.ДобавитьЗначение("П425");			// 24
	Список.ДобавитьЗначение("П426");			// 25
	Список.ДобавитьЗначение("П427");			// 26
	Список.ДобавитьЗначение("П428");			// 27
	Список.ДобавитьЗначение("П429");			// 28
	Список.ДобавитьЗначение("П430");			// 29
	Список.ДобавитьЗначение("П431");			// 30
	Список.ДобавитьЗначение("П432");			// 31
	Список.ДобавитьЗначение("П433");			// 32
	Список.ДобавитьЗначение("ДолжностьПроверяющего");//33
	Список.ДобавитьЗначение("ОбщВозвр6");		// 34
	Список.ДобавитьЗначение("ОбщВозвр13");		// 35
	Список.ДобавитьЗначение("ОбщВозвр30");		// 36
	Список.ДобавитьЗначение("ОбщВозвр35");		// 37
	Список.ДобавитьЗначение("ОбщЗач6");			// 38
	Список.ДобавитьЗначение("ОбщЗач13");		// 39
	Список.ДобавитьЗначение("ОбщЗач30");		// 40
	Список.ДобавитьЗначение("ОбщЗач35");		// 41
	Список.ДобавитьЗначение("СуммаСПредМестаРаботы");// 42

//	Список.ДобавитьЗначение("ОтрДоход2");		// 43
//	Список.ДобавитьЗначение("ПерДоход2");		// 44
//	Список.ДобавитьЗначение("ОтрВычеты2");		// 45
//	Список.ДобавитьЗначение("ПерВычеты2");		// 46
//	Список.ДобавитьЗначение("ОтрДоходБезВычет2");// 47
//	Список.ДобавитьЗначение("ПерДоходБезВычет2");// 48
//	Список.ДобавитьЗначение("ОтрНИ2");			// 49
//	Список.ДобавитьЗначение("ПерНИ2");			// 50
//	Список.ДобавитьЗначение("П4182");			// 51
//	Список.ДобавитьЗначение("П4192");			// 52
//	Список.ДобавитьЗначение("П4202");			// 53
//	Список.ДобавитьЗначение("П4212");			// 54
//	Список.ДобавитьЗначение("П4222");			// 55
//	Список.ДобавитьЗначение("П4232");			// 56
//	Список.ДобавитьЗначение("П4242");			// 57
//	Список.ДобавитьЗначение("П4252");			// 58
//
//	Список.ДобавитьЗначение("ОтрДоход3");		// 59
//	Список.ДобавитьЗначение("ПерДоход3");		// 60
//	Список.ДобавитьЗначение("ОтрВычеты3");		// 61
//	Список.ДобавитьЗначение("ПерВычеты3");		// 62
//	Список.ДобавитьЗначение("ОтрДоходБезВычет3");// 63
//	Список.ДобавитьЗначение("ПерДоходБезВычет3");// 64
//	Список.ДобавитьЗначение("ОтрНИ3");			// 65
//	Список.ДобавитьЗначение("ПерНИ3");			// 66
//	Список.ДобавитьЗначение("П4183");			// 67
//	Список.ДобавитьЗначение("П4193");			// 68
//	Список.ДобавитьЗначение("П4203");			// 69
//	Список.ДобавитьЗначение("П4213");			// 70
//	Список.ДобавитьЗначение("П4223");			// 71
//	Список.ДобавитьЗначение("П4233");			// 72
//	Список.ДобавитьЗначение("П4243");			// 73
//	Список.ДобавитьЗначение("П4253");			// 74
	
	Возврат Список	
КонецФункции // ЗаполнитьСписокПрочихПолейКарточки()

//******************************************************************************
// ПриВводеСуммИзменяющихСальдо()
//
// Параметры:
//		нет
//
// Возвращаемое значение
//		нет
//
// Описание:
//		
//		
//
Процедура ПриВводеСуммИзменяющихСальдо(ЧастьИмени = "")
	
	Если ЧастьИмени = "" тогда
		Имя=Таблица.АктивнаяОбласть();	
		ЧастьИмени = Лев(Имя, СтрДлина(Имя) - 2);
	КонецЕсли;
	СуммаПоСтроке = 0;
	Для индЯч = 1 по 12 Цикл
		СуммаПоСтроке = СуммаПоСтроке + Таблица.Область(ЧастьИмени + глДополнитьСтроку(индЯч, 2)).Значение;
	КонецЦикла;
	Таблица.Область("И" + ЧастьИмени).Значение = СуммаПоСтроке;
		КодДохода5Раздела = Сред(Таблица.Доход5раздела.Значение, 12, 4);
		ТаблицаТекущего5Раздела = СписокВводаРаздела5.Получить(КодДохода5Раздела);
		Если ТипЗначенияСтр(ТаблицаТекущего5Раздела) = "ТаблицаЗначений" тогда
			//ТаблицаТекущего5Раздела = СписокВводаРаздела5.ПолучитьЗначение();
		Иначе
			ТаблицаТекущего5Раздела = СоздатьТаблицу5Раздела();
			СписокВводаРаздела5.ДобавитьЗначение(ТаблицаТекущего5Раздела, КодДохода5Раздела);
		КонецЕсли;
		Записать5РазделВТаблицу(ТаблицаТекущего5Раздела);
	ОбновитьРаздел6();
	
КонецПроцедуры

//******************************************************************************
Процедура Заполнить()
	 	
	Если ФизЛицо.Выбран() = 0 Тогда
		Если УказатьСотрудника() = 0 Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	НачДата = Дата("01.01."+Год);
	КонДата = Макс(НачДата, Мин(Дата("31.12."+Год), КонецРассчитанногоПериодаБИ()));
	Если КонДата > КонецРассчитанногоПериодаБИ() Тогда
		Предупреждение("За выбранный период итоги не рассчитаны!"+РазделительСтрок+
		               "Расчет итогов выполняется в режиме"+РазделительСтрок+
					   """Операции - Управление бухгалтерскими итогами"".");
		Возврат;
	КонецЕсли;
	
	Сч00 = СчетПоКоду("00");
	Сч68_1 = СчетПоКоду("68.1");
	Сч69_1 = СчетПоКоду("69.1");
	Сч69_11 = СчетПоКоду("69.11");
	Сч70 = СчетПоКоду("70");
	СчДФЛ = СчетПоКоду("ДФЛ");
	
	КонецМесяцаДокумента = КонДата;
	Сотрудник = ФизЛицо;
	
	НДФЛ_13 = глПолучитьНалог("НДФЛ");
	Ставка13 = НДФЛ_13.Ставка.Получить(КонецМесяцаДокумента);
	ВычетыПеретекают = ?(Константа.ОсобенностиИсчисленияНДФЛ.Получить("31.12."+Год) = 
						Перечисление.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом, 1, 0);
	
	// Определим налоговую базу как сумму кредитовых оборотов
	// счета 70 и счета корректировки налоговой базы.
	БухИт = СоздатьОбъект("БухгалтерскиеИтоги");
	БухИт.Опции(1,1);
	БухИт.ВключатьСубсчета(, -1);
	БухИт.ИспользоватьСубконто(ВидыСубконто.Сотрудники, Сотрудник);
	БухИт.ИспользоватьСубконто(ВидыСубконто.ВидыНачисленийВыплат);
	БухИт.ИспользоватьКорСубконто();
	БухИт.ВыполнитьЗапрос(НачДата, КонецМесяцаДокумента, "70,ДФЛ",,, 2, "Месяц");
	
	МесяцПоследнегоНачисления = 0;
    БухИт.ВыбратьПериоды();
	Пока БухИт.ПолучитьПериод() = 1 Цикл
		Если БухИт.КО() <> 0 Тогда
		    МесяцПоследнегоНачисления = ДатаМесяц(БухИт.КонДата);
		КонецЕсли;
	КонецЦикла;
	
	КоличествоВидовДоходов13 = 1;
	КоличествоВидовДоходов35 = 1;
	
	ТаблицаВидовДоходов = СоздатьОбъект("ТаблицаЗначений");
	ТаблицаВидовДоходов.НоваяКолонка("КодДохода", "Строка", 4);
	ТаблицаВидовДоходов.НоваяКолонка("Ставка", "Число");
	ТаблицаВидовДоходов.НоваяКолонка("НПП", "Число");
	ТаблицаВидовДоходов.НоваяКолонка("НачисленоЗаМесяц", "Число");
	
	Резидент = Сотрудник.Статус.Получить(КонецМесяцаДокумента);
	ПолучитСтавкиНДФЛ();
	
	ВаловыйДоход = 0;
	НеОблагается = 0;
	НалогНаДоходы = 0;
	УдержанныйНалог13 = 0;
	НачисленныйНалог = ?(ДатаГод(ФизЛицо.ДатаПриема) < Год, 0, Сотрудник.СальдоНалогаНаДоходы.Получить(КонДата));
	
	// Учтем начальные данные расчета и начисление, сделанное данным документом.
	ВаловойДоход_СНачалаГода = ?((ДатаГод(глДатаПриема(Сотрудник))=ДатаГод(НачДата)) или (ДатаГод(Сотрудник.ДатаПриема) = ДатаГод(НачДата)),
									Сотрудник.ВаловойДоход_СНачалаГода,0);
	Таблица.Область("СуммаСПредМестаРаботы").Текст = ВаловойДоход_СНачалаГода;
	
	ГодНачалаУчета = ДатаГод(Сотрудник.ДатаПриема);
	МесяцНачалаУчета = ДатаМесяц(Сотрудник.ДатаПриема);
	ГодОтчета = ДатаГод(НачДата);
	
	Если ГодНачалаУчета = ГодОтчета Тогда
		ДоходОблагаемыйНДФЛ_СНачалаГода = Сотрудник.ДоходОблагаемыйНДФЛ_СНачалаГода;
		НачисленныйНДФЛ_СНачалаГода = Сотрудник.НачисленныйНДФЛ_СНачалаГода;
	Иначе
		ДоходОблагаемыйНДФЛ_СНачалаГода = 0;
		НачисленныйНДФЛ_СНачалаГода = 0;
	КонецЕсли;
	
	// Право на имущественные вычеты
	ВсегоПримененныйВычет311 = 0;
	ВсегоПримененныйВычет312 = 0;
	
	Сумма311 = 0;
	Сумма312 = 0;
		
	ВычетыСотрудниковПоНДФЛ.ИспользоватьВладельца(Сотрудник);
	ВычетыСотрудниковПоНДФЛ.ВыбратьЭлементы(); 
	
	Пока ВычетыСотрудниковПоНДФЛ.ПолучитьЭлемент() = 1 Цикл
		
		Если ВычетыСотрудниковПоНДФЛ.ПометкаУдаления() = 1 Тогда
			Продолжить;
		КонецЕсли;
		
		Если (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) <> "311")
		И (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) <> "312" ) Тогда
			Продолжить;						
		КонецЕсли;
		
		ВычетПредоставлялся = 0;
		Если ПустоеЗначение(ВычетыСотрудниковПоНДФЛ.ДатаНачала) = 1 Тогда
			ВычетПредоставлялся = 0;							
		Иначе
			Если ВычетыСотрудниковПоНДФЛ.ДатаНачала > БухИт.КонДата Тогда
				ВычетПредоставлялся = 0;
			Иначе
				Если ПустоеЗначение(ВычетыСотрудниковПоНДФЛ.ДатаОкончания) = 1 Тогда
					ВычетПредоставлялся = 1;
				Иначе
					Если ВычетыСотрудниковПоНДФЛ.ДатаОкончания < НачМесяца(БухИт.КонДата) Тогда
						ВычетПредоставлялся = 0;
					Иначе
						ВычетПредоставлялся = 1;
					КонецЕсли;
					
				КонецЕсли;
			КонецЕсли;
			
		КонецЕсли;
		
		Если ВычетПредоставлялся = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		Если (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "311") Тогда
			Сумма311 = Сумма311 + ВычетыСотрудниковПоНДФЛ.Сумма;
			
		Иначе 
			Сумма312 = Сумма312 + ВычетыСотрудниковПоНДФЛ.Сумма;
			
		КонецЕсли;
		
	КонецЦикла;
	
    	
	НакопленныйВычетНаРебенка = 0;
	НакопленныйВычет103 = 0;
	НакопленныйВычет104 = 0;
	НакопленныйВычет105 = 0;
	НакопленныйВычетНаРебенкаИнвалида = 0;
	НакопленныйВычетНаРебенкаОдинокому = 0; 
	НакопленныйВычетНаРебенкаИнвалидаОдинокому = 0;	
	
	БухИт.ВыбратьПериоды(1);
	Пока БухИт.ПолучитьПериод() = 1 Цикл // по месяцам
		Месяц = ДатаМесяц(БухИт.КонДата);
		
		// Исключим периоды более ранние, чем дата приема на работу.
		ТекМесяц = КонМесяца(Дата(Год, Месяц, 1));
		Если глДатаПриема(Сотрудник) > ТекМесяц Тогда
			Продолжить;
			
		ИначеЕсли Месяц > МесяцПоследнегоНачисления Тогда
			Прервать;
			
		ИначеЕсли (ГодНачалаУчета = ГодОтчета) и (Месяц < МесяцНачалаУчета) Тогда
			Продолжить;
		КонецЕсли;
		
		// Очистим текущую колонку
		Очистить(0, "", Месяц);
		
		Если Резидент = 0 Тогда
		    ВаловыйДоход = 0;
			НалогНаДоходы = 0;
		КонецЕсли;
		
		УдержанныйНалог06 = 0;
		УдержанныйНалог30 = 0;
		НачисленоЗаМесяцПоВсемВидамДоходов = 0;
		ПрименилиВычет = 0;
		
		ТаблицаВидовДоходов.ВыбратьСтроки();
		Пока ТаблицаВидовДоходов.ПолучитьСтроку() = 1 Цикл
		    ТаблицаВидовДоходов.НачисленоЗаМесяц = 0;
		КонецЦикла;
		
		БухИт.ВыбратьСубконто(ВидыСубконто.ВидыНачисленийВыплат);
		Пока БухИт.ПолучитьСубконто(ВидыСубконто.ВидыНачисленийВыплат) = 1 Цикл
			ВидНачисления = БухИт.Субконто(ВидыСубконто.ВидыНачисленийВыплат);
			Ставка = глСтавкаНДФЛ(ВидНачисления, Сотрудник, КонецМесяцаДокумента);
			КодДохода =  ?(ПустоеЗначение(ВидНачисления) = 1, "2000", ВидНачисления.Код);
				
			Если БухИт.ПолучитьСчет(, СчДФЛ) = 1 Тогда
				НомСтроки = 0;
				Если ТаблицаВидовДоходов.НайтиЗначение(КодДохода, НомСтроки, "КодДохода") = 0 Тогда
					ТаблицаВидовДоходов.НоваяСтрока();
					ТаблицаВидовДоходов.КодДохода = КодДохода;
					ТаблицаВидовДоходов.Ставка = Ставка;
					Если (Ставка = Ставка13) или (Ставка = 30) Тогда
					    ТаблицаВидовДоходов.НПП = КоличествоВидовДоходов13;
						КоличествоВидовДоходов13 = КоличествоВидовДоходов13 + 1;
						
					ИначеЕсли Ставка = 35 Тогда
						ТаблицаВидовДоходов.НПП = КоличествоВидовДоходов35;
						КоличествоВидовДоходов35 = КоличествоВидовДоходов35 + 1;
					КонецЕсли;
				КонецЕсли;

				Если (Ставка = Ставка13) или (Ставка = 30) Тогда // 3-й раздел
					НомСтроки = 0;
					Если ТаблицаВидовДоходов.НайтиЗначение(КодДохода, НомСтроки, "КодДохода") = 1 Тогда
						ТаблицаВидовДоходов.ПолучитьСтрокуПоНомеру(НомСтроки);
					    НПП = ТаблицаВидовДоходов.НПП;
						ИмяОбл = "П0" + Формат(((НПП - 1) * 13 + 3), "Ч(0)2");
						Таблица.Область(ИмяОбл).Значение = КодДохода;
						ПриВыбореТипаДохода(ИмяОбл);
						
					    ИмяОбл = "П" + Формат(((НПП - 1) * 13 + 3 + Месяц), "Ч(0)3");
						НачисленоЗаМесяц = БухИт.КО();
				        ТаблицаВидовДоходов.НачисленоЗаМесяц = ТаблицаВидовДоходов.НачисленоЗаМесяц + НачисленоЗаМесяц;
						Таблица.Область(ИмяОбл).Значение = ТаблицаВидовДоходов.НачисленоЗаМесяц;
						
						ПрименилиВычет = ПриВводеДоходовРаздела3(ИмяОбл);
						НачисленоЗаМесяцПоВсемВидамДоходов = НачисленоЗаМесяцПоВсемВидамДоходов + НачисленоЗаМесяц - ПрименилиВычет;
					КонецЕсли;
						
				ИначеЕсли ((Ставка = 6) и (Год < 2005)) или (Ставка = 9) или (Ставка = 15) Тогда
					Таблица.Область("П" + Формат(163 + Месяц, "Ч(0)3")).Значение = БухИт.КО();
				КонецЕсли;
			КонецЕсли;
			
		    Если БухИт.ПолучитьСчет(, Сч70) = 1 Тогда
				Если БухИт.ПолучитьКорСчет(, Сч68_1) = 1 Тогда
				    Если БухИт.ПолучитьКорСубконто(1,, Перечисление.ВидыПлатежейВБюджет.Налог) = 1 Тогда
						НачисленныйНалог = НачисленныйНалог + БухИт.КорДО();
						Если (Ставка = Ставка13) или (Ставка = 30) Тогда // 3-й раздел
							Если Ставка = Ставка13 Тогда
								УдержанныйНалог13 = УдержанныйНалог13 + БухИт.КорДО();
								
							Иначе
								УдержанныйНалог30 = УдержанныйНалог30 + БухИт.КорДО();
							КонецЕсли;
							
						ИначеЕсли ((Ставка = 6) и (Год < 2005)) или (Ставка = 9) или (Ставка = 15) Тогда
							УдержанныйНалог06 = УдержанныйНалог06 + БухИт.КорДО();
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		
		Если Резидент = 1 Тогда
			Таблица.Область("П" + Формат(132 + Месяц, "Ч(0)3")).Значение = УдержанныйНалог13;
			
		Иначе
			Таблица.Область("П" + Формат(132 + Месяц, "Ч(0)3")).Значение = УдержанныйНалог30;
		КонецЕсли;
		Таблица.Область("П" + Формат(175 + Месяц, "Ч(0)3")).Значение = УдержанныйНалог06;
		
		// Исчисление налога по ставке 13%
		ВаловыйДоход = ВаловыйДоход + Таблица.Область("МДБезВ"+Формат(Месяц, "Ч(0)2")).Значение;
		
		// Стандартные вычеты за тек. месяц для ставки 13%
		Вычеты = 0;
		ВычетНаРебенка = 0;
		ВычетНаРебенкаИнвалида = 0;
		ВычетНаРебенкаОдинокому = 0;
		ВычетНаРебенкаИнвалидаОдинокому = 0;
		
		Если (глСотрудникЧислитсяРаботающим(Сотрудник, БухИт.НачДата) = 1) и (Резидент = 1) Тогда
			
			ВычетыСотрудниковПоНДФЛ.ИспользоватьВладельца(Сотрудник);
			ВычетыСотрудниковПоНДФЛ.ВыбратьЭлементы(); 
			
			Пока ВычетыСотрудниковПоНДФЛ.ПолучитьЭлемент() = 1 Цикл
				
				Если ВычетыСотрудниковПоНДФЛ.ПометкаУдаления() = 1 Тогда
					Продолжить;
				КонецЕсли;
				
				ВычетПредоставлялся = 0;
				Если ПустоеЗначение(ВычетыСотрудниковПоНДФЛ.ДатаНачала) = 1 Тогда
					ВычетПредоставлялся = 0;							
				Иначе
					Если ВычетыСотрудниковПоНДФЛ.ДатаНачала > БухИт.КонДата Тогда
						ВычетПредоставлялся = 0;
					Иначе
						Если ПустоеЗначение(ВычетыСотрудниковПоНДФЛ.ДатаОкончания) = 1 Тогда
							ВычетПредоставлялся = 1;
						Иначе
							Если ВычетыСотрудниковПоНДФЛ.ДатаОкончания < НачМесяца(БухИт.КонДата) Тогда
								ВычетПредоставлялся = 0;
							Иначе
								ВычетПредоставлялся = 1;
							КонецЕсли;
							
						КонецЕсли;
					КонецЕсли;
					
				КонецЕсли;
				
				Если ВычетПредоставлялся = 0 Тогда
					Продолжить;
				КонецЕсли;
				
				Если (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "311")
				ИЛИ (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "312" ) Тогда
					//СуммаИмущВычета = СуммаИмущВычета +  ВычетыСотрудниковПоНДФЛ.Сумма;							
					Продолжить;						
				КонецЕсли;
				
				РазмерВычета = ВычетыСотрудниковПоНДФЛ.ВидВычета.Сумма.Получить(БухИт.КонДата);
				ПределДоходов = ВычетыСотрудниковПоНДФЛ.ВидВычета.ПределДоходов.Получить(БухИт.КонДата);
				
				Если ПределДоходов > 0 Тогда							
					Вычеты = РазмерВычета*?((ВаловыйДоход+ВаловойДоход_СНачалаГода)<=ПределДоходов,1,0);
				Иначе
					Вычеты = РазмерВычета;
				КонецЕсли;
				
				Если (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "103") Тогда
					Вычеты = Вычеты + НакопленныйВычет103;
					НакопленныйВычет103 = ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, Вычеты, 0));
					Вычеты = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, Вычеты),  ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,Вычеты));
					Таблица.Область("СВМес3"+Формат(Месяц, "Ч(0)2")).Значение = Вычеты;
				
				ИначеЕсли (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "104") Тогда
					Вычеты = Вычеты + НакопленныйВычет104;
					НакопленныйВычет104 = ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, Вычеты, 0));
					Вычеты = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, Вычеты),  ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,Вычеты));
					Таблица.Область("СВМес4"+Формат(Месяц, "Ч(0)2")).Значение = РазмерВычета;
				
				ИначеЕсли (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "105") Тогда
					Вычеты = Вычеты + НакопленныйВычет105;
					НакопленныйВычет105 = ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, Вычеты, 0));
					Вычеты = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, Вычеты),  ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,Вычеты));
					Таблица.Область("СВМес5"+Формат(Месяц, "Ч(0)2")).Значение = РазмерВычета;
				
				ИначеЕсли (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "101") Тогда
					ВычетНаРебенка = ВычетНаРебенка + Вычеты;
					
				ИначеЕсли (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "109") Тогда
					ВычетНаРебенкаИнвалида = ВычетНаРебенка + Вычеты;
					
				ИначеЕсли (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "102") Тогда
					ВычетНаРебенкаОдинокому = ВычетНаРебенкаОдинокому + Вычеты;
				
				ИначеЕсли (СокрЛП(ВычетыСотрудниковПоНДФЛ.ВидВычета.КодДляОтчетности2007) = "107") Тогда
					ВычетНаРебенкаИнвалидаОдинокому = ВычетНаРебенкаИнвалидаОдинокому + Вычеты;

				КонецЕсли;  
				
			КонецЦикла;
			
			НачисленоЗаМесяцПоВсемВидамДоходов = ?(ВычетыПеретекают = 1, (НачисленоЗаМесяцПоВсемВидамДоходов - Вычеты), Макс(НачисленоЗаМесяцПоВсемВидамДоходов - Вычеты, 0));			
			ВычетНаРебенка = ВычетНаРебенка + НакопленныйВычетНаРебенка;                              			
			НакопленныйВычетНаРебенка = ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, ВычетНаРебенка, 0));							
			ВычетНаРебенка = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, ВычетНаРебенка),  ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,ВычетНаРебенка));
			Таблица.Область("СВМес1"+Формат(Месяц, "Ч(0)2")).Значение = ВычетНаРебенка;
			
		    НачисленоЗаМесяцПоВсемВидамДоходов = ?(ВычетыПеретекают = 1, НачисленоЗаМесяцПоВсемВидамДоходов - ВычетНаРебенка, Макс(НачисленоЗаМесяцПоВсемВидамДоходов - ВычетНаРебенка, 0));                    			
			ВычетНаРебенкаОдинокому = ВычетНаРебенкаОдинокому + НакопленныйВычетНаРебенкаОдинокому;                                  		
			НакопленныйВычетНаРебенкаОдинокому= ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, ВычетНаРебенкаОдинокому, 0));			
			ВычетНаРебенкаОдинокому = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, ВычетНаРебенкаОдинокому),   ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,ВычетНаРебенкаОдинокому));
			Таблица.Область("СВМес2"+Формат(Месяц, "Ч(0)2")).Значение = ВычетНаРебенкаОдинокому;
			
			НачисленоЗаМесяцПоВсемВидамДоходов = ?(ВычетыПеретекают = 1, НачисленоЗаМесяцПоВсемВидамДоходов - ВычетНаРебенкаОдинокому, Макс(НачисленоЗаМесяцПоВсемВидамДоходов - ВычетНаРебенкаОдинокому, 0));                    			
			ВычетНаРебенкаИнвалида = ВычетНаРебенкаИнвалида + НакопленныйВычетНаРебенкаИнвалида;                                  		
			НакопленныйВычетНаРебенкаИнвалида= ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, ВычетНаРебенкаИнвалида, 0));			
			ВычетНаРебенкаИнвалида = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, ВычетНаРебенкаИнвалида),   ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,ВычетНаРебенкаИнвалида));
			Таблица.Область("СВМес6"+Формат(Месяц, "Ч(0)2")).Значение = ВычетНаРебенкаИнвалида;
			
		    НачисленоЗаМесяцПоВсемВидамДоходов = ?(ВычетыПеретекают = 1, НачисленоЗаМесяцПоВсемВидамДоходов - ВычетНаРебенкаИнвалида, Макс(НачисленоЗаМесяцПоВсемВидамДоходов - ВычетНаРебенкаИнвалида, 0));                    			
			ВычетНаРебенкаИнвалидаОдинокому = ВычетНаРебенкаИнвалидаОдинокому + НакопленныйВычетНаРебенкаИнвалидаОдинокому;                                  		
			НакопленныйВычетНаРебенкаИнвалидаОдинокому= ?(ВычетыПеретекают = 0,  0, ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0, ВычетНаРебенкаИнвалидаОдинокому, 0));			
			ВычетНаРебенкаИнвалидаОдинокому = ?(ВычетыПеретекают = 0, Мин(НачисленоЗаМесяцПоВсемВидамДоходов, ВычетНаРебенкаИнвалидаОдинокому),   ?(НачисленоЗаМесяцПоВсемВидамДоходов <= 0,0,ВычетНаРебенкаИнвалидаОдинокому));
			Таблица.Область("СВМес7"+Формат(Месяц, "Ч(0)2")).Значение = ВычетНаРебенкаИнвалидаОдинокому;

			Вычеты = Вычеты + ВычетНаРебенка + ВычетНаРебенкаИнвалида + ВычетНаРебенкаОдинокому + ВычетНаРебенкаИнвалидаОдинокому;
			НеОблагается = НеОблагается + Вычеты;
		КонецЕсли;
		
		// Исчисленный НДФЛ
		ОблагаемыйДоход = Макс(ВаловыйДоход+ДоходОблагаемыйНДФЛ_СНачалаГода-НеОблагается, 0);
		
		// Применение вычета с кодом 311
		ПримененныйВычет311 = Мин(ОблагаемыйДоход, Сумма311);
		ПримененныйВычет311ЗаМесяц = ПримененныйВычет311 - ВсегоПримененныйВычет311;
		Таблица.Область("ИВычет1_"+Формат(Месяц, "Ч(0)2")).Значение = ПримененныйВычет311ЗаМесяц;
		ВсегоПримененныйВычет311 = ВсегоПримененныйВычет311 + ПримененныйВычет311ЗаМесяц;
		ОблагаемыйДоход = ОблагаемыйДоход - ВсегоПримененныйВычет311;
		
		// Применение вычета с кодом 312
		ПримененныйВычет312 = Мин(ОблагаемыйДоход, Сумма312);
		ПримененныйВычет312ЗаМесяц = ПримененныйВычет312 - ВсегоПримененныйВычет312;
		Таблица.Область("ИВычет2_"+Формат(Месяц, "Ч(0)2")).Значение = ПримененныйВычет312ЗаМесяц;
		ВсегоПримененныйВычет312 = ВсегоПримененныйВычет312 + ПримененныйВычет312ЗаМесяц;
		ОблагаемыйДоход = ОблагаемыйДоход - ВсегоПримененныйВычет312;
		
		НалогНаДоходы = НалогНаДоходы + Окр(ОблагаемыйДоход/100*Ставка13,0,1);
		
	КонецЦикла;
	
	Для Месяц = 1 по МесяцПоследнегоНачисления Цикл
		ПриВводеСтандартныхВычетов(Месяц, 1);
		ПриВводеСтандартныхВычетов(Месяц, 2);
		ПриВводеСтандартныхВычетов(Месяц, 3);
		ПриВводеСтандартныхВычетов(Месяц, 4);
		ПриВводеСтандартныхВычетов(Месяц, 5);
		ПриВводеСтандартныхВычетов(Месяц, 6);
		ПриВводеСтандартныхВычетов(Месяц, 7);
		
		ПриВводеИмущественныхВычетов(Месяц, 1);
		ПриВводеИмущественныхВычетов(Месяц, 2);
		
		ПриВводеДивидендов("П" + (ПерваяЯчейкаРаздела4 + Месяц + 11), 0);
		
		Для НомСтр = 0 по 4 Цикл
			ПриВводеДоходовРаздела3("П" + Формат((НомСтр * 13 + 3 + Месяц), "Ч(0)3"));
		КонецЦикла;
	КонецЦикла;
	
	Если Таблица.ОбщНИ.Значение <> (НачисленныйНалог + НачисленныйНДФЛ_СНачалаГода) Тогда
		Сообщить("Сумма исчисленного налога в строке ""Итого"" раздела 6 формы"+
				 " не совпадает с данными бухгалтерского учета");
	КонецЕсли;
	
КонецПроцедуры // Заполнить()

//******************************************************************************
// Печать()
//
Процедура Печать()
    
	Если ФизЛицо.Выбран() = 1 Тогда	
		
		ПунктМеню="";
	
		Меню = СоздатьОбъект("СписокЗначений");
		Меню.ДобавитьЗначение("ПечататьСразу","Печатать сразу");
		Меню.ДобавитьЗначение("ПоказатьБланк","Показать бланк");
		Меню.ДобавитьЗначение("ПоказатьПоследний","Открыть последний бланк");
		
		Если Меню.ВыбратьЗначение(ПунктМеню,,,,1) = 1 Тогда
			
			ВыходнаяТаблица=СоздатьОбъект("Таблица");
			ИмяФайлаПечатнойФормы = КаталогИБ() + "tcard-" + Прав(Год, 2) + ".mxl";
			
			Если ПунктМеню="ПоказатьПоследний" Тогда
				Если ФС.СуществуетФайл(ИмяФайлаПечатнойФормы)=0 Тогда
					Сообщить("Файл печатной формы "+ИмяФайлаПечатнойФормы+" не найден","i");
					Возврат;
				КонецЕсли;
			    ВыходнаяТаблица.Открыть(ИмяФайлаПечатнойФормы);
				
			Иначе
				ВыходнаяТаблица.ИсходнаяТаблица("ПечатнаяФорма");
				//ВыходнаяТаблица.ИсходнаяТаблица("1-НДФЛ");
				
				// Формирование буфера данных
				Буфер = СоздатьОбъект("СписокЗначений");
				Таблица.Выгрузить(Буфер);
				Для а = 1 по ИменаИтоговКарточки.РазмерСписка() Цикл
					ТекИтог = ИменаИтоговКарточки.ПолучитьЗначение(а);
					Буфер.Установить(ТекИтог, Таблица.Область(ТекИтог).Значение);
				КонецЦикла;
				ЗаполнитьСписокКадровымиДанными(Буфер);
				Буфер.Установить("ЕстьВычеты", Таблица.Область("ЕстьВычеты").Текст);
				
				Страница1 = ВыходнаяТаблица.ПолучитьСекцию("Страница1");
				Страница2 = ВыходнаяТаблица.ПолучитьСекцию("Страница2");
				Страница3 = ВыходнаяТаблица.ПолучитьСекцию("Страница3");
				Страница5 = ВыходнаяТаблица.ПолучитьСекцию("Страница5");
				Страница6 = ВыходнаяТаблица.ПолучитьСекцию("Страница6");
				
				Для а = 1 по Буфер.РазмерСписка() Цикл
					ИмяОбласти = "";
					Значение = Буфер.ПолучитьЗначение(а, ИмяОбласти);
					Если ТипЗначения(Значение) = 1 Тогда
					    Значение = Формат(Значение,"Ч015.2.");
					КонецЕсли;
					
					Если ПустоеЗначение(Страница1.Область(ИмяОбласти)) = 0 Тогда
					    Страница1.Область(ИмяОбласти).Текст = Значение;
						
					ИначеЕсли ПустоеЗначение(Страница2.Область(ИмяОбласти)) = 0 Тогда
					    Страница2.Область(ИмяОбласти).Текст = Значение;
						
					ИначеЕсли ПустоеЗначение(Страница3.Область(ИмяОбласти)) = 0 Тогда
					    Страница3.Область(ИмяОбласти).Текст = Значение;
						
					ИначеЕсли ПустоеЗначение(Страница5.Область(ИмяОбласти)) = 0 Тогда
					    Страница5.Область(ИмяОбласти).Текст = Значение;
						
					ИначеЕсли ПустоеЗначение(Страница6.Область(ИмяОбласти)) = 0 Тогда
					    Страница6.Область(ИмяОбласти).Текст = Значение;
					КонецЕсли;
				КонецЦикла;
				
				//Для а = 1 по 12 Цикл
				//	Страница3.Область("ОбДив"+Формат(а, "Ч(0)2")).Текст = Формат(Буфер.Получить("П1"+Формат(63+а, "Ч(0)2")),"Ч015.2.");
				//КонецЦикла;
				//
				//Страница3.Область("ИОбДив").Текст = Формат(Буфер.Получить("ИДив"),"Ч015.2.");
				
				ВыходнаяТаблица.ВывестиСекцию(Страница1);
				ВыходнаяТаблица.НоваяСтраница();
				ВыходнаяТаблица.ВывестиСекцию(Страница2);
				ВыходнаяТаблица.НоваяСтраница();
				ВыходнаяТаблица.ВывестиСекцию(Страница3);
				
				Всего5Разделов = 0;
				Для инд5Раздела = 1 по СписокВводаРаздела5.РазмерСписка() Цикл
					Таблица5Раздела = СписокВводаРаздела5.ПолучитьЗначение(инд5Раздела);
					Для НомерКолонки = 4 по Таблица5Раздела.КоличествоКолонок() Цикл
						Если ПустоеЗначение(Таблица5Раздела.Итог(НомерКолонки)) = 0 Тогда
						    Всего5Разделов = Всего5Разделов + 1;
						КонецЕсли;
					КонецЦикла;
				КонецЦикла;
				
				ВыведеноРазделов = 0;
				Для инд5Раздела = 1 по СписокВводаРаздела5.РазмерСписка() Цикл
					Таблица5Раздела = СписокВводаРаздела5.ПолучитьЗначение(инд5Раздела);
					ЭтоПустаяТаблица = 1;
					Для НомерКолонки = 4 по Таблица5Раздела.КоличествоКолонок() Цикл
						Если ПустоеЗначение(Таблица5Раздела.Итог(НомерКолонки)) = 0 Тогда
						    ЭтоПустаяТаблица = 0;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
					Если ЭтоПустаяТаблица = 1 Тогда
					    Продолжить;
					КонецЕсли;
					
					БуферРаздела5=СоздатьОбъект("СписокЗначений");
					Раздел5НК = ВыходнаяТаблица.ПолучитьСекцию("Страница4");
					
					НДФЛИсчисленный = 0;
					НДФЛУдержанный = 0;
					СуммаДоходаВсего = 0;
					СуммаВычетаВсего = 0;
					
					Таблица5Раздела.ВыбратьСтроки();
					Пока Таблица5Раздела.ПолучитьСтроку() = 1 Цикл
						МесяцСтрокой 	= глДополнитьСтроку(Таблица5Раздела.НомерСтроки, 2);
						Месяц 			= Таблица5Раздела.НомерСтроки;
						// налоговая база
						БуферРаздела5.Установить("Дох35НБ"+МесяцСтрокой, Таблица5Раздела.НБ);
						
						БуферРаздела5.ДобавитьЗначение(Таблица5Раздела.СуммаДохода,"П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5+Месяц,3));
						// исчислено налога
						БуферРаздела5.ДобавитьЗначение(Таблица5Раздела.НИ, "СТ35НИ"+МесяцСтрокой);
						// удержано налога
						БуферРаздела5.ДобавитьЗначение(Таблица5Раздела.НУ, "П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5+72+Месяц,3));
						БуферРаздела5.ДобавитьЗначение(Таблица5Раздела.Взыскание,"Нал35Взыск"+МесяцСтрокой);
						ИНал35Взыск = ИНал35Взыск + Таблица5Раздела.Взыскание;
						БуферРаздела5.ДобавитьЗначение(Таблица5Раздела.Возвращена,"Нал35Возвр"+МесяцСтрокой);
						ИНал35Возвр = ИНал35Возвр + Таблица5Раздела.Возвращена;
						НДФЛИсчисленный = НДФЛИсчисленный + Таблица5Раздела.НИ;
						НДФЛУдержанный = НДФЛУдержанный + Таблица5Раздела.НУ;
						СуммаДоходаВсего = СуммаДоходаВсего + Таблица5Раздела.СуммаДохода;
						СуммаВычетаВсего = СуммаВычетаВсего + Таблица5Раздела.СуммаВычета;
						СальдоМВ = НДФЛИсчисленный - НДФЛУдержанный;
						БуферРаздела5.Установить("Долг35НП"+МесяцСтрокой,Макс(СальдоМВ,0));
						БуферРаздела5.Установить("Долг35НА"+МесяцСтрокой,Макс(-СальдоМВ,0));
						// сумма за текущий месяц - в колонку месяца
						БуферРаздела5.ДобавитьЗначение(Таблица5Раздела.СуммаВычета, "П"+глДополнитьСтроку(ПерваяЯчейкаРаздела5+60+Месяц,3));
						БуферРаздела5.Установить("Доход5раздела", "Код дохода "+Таблица5Раздела.КодДохода+" сумма дохода");
						// сумма нарастающим итогом - в колонку итогов
						// Итоговый столбец по 5 разделу.
						БуферРаздела5.Установить("ИДох35НБ", СуммаДоходаВсего - СуммаВычетаВсего);
						БуферРаздела5.Установить("ИСТ35_01", СуммаДоходаВсего);
						БуферРаздела5.Установить("ИСТ35_06", СуммаВычетаВсего);
						БуферРаздела5.Установить("ИСТ35НИ",НДФЛИсчисленный);
						БуферРаздела5.Установить("ИСТ35_07",НДФЛУдержанный);
						БуферРаздела5.Установить("ИДолг35НП",Макс(СальдоМВ,0));
						БуферРаздела5.Установить("ИДолг35НА",Макс(-СальдоМВ,0));
						БуферРаздела5.Установить("ИНал35Взыск",ИНал35Взыск);
						БуферРаздела5.Установить("ИНал35Возвр",ИНал35Возвр);
					КонецЦикла;
					Для Сч = 1 По БуферРаздела5.РазмерСписка()  Цикл
						Имя="";
						Зн=БуферРаздела5.ПолучитьЗначение(Сч,Имя);
						Если ПустаяСтрока(Имя)=0  Тогда
							Раздел5НК.Область(Имя).Текст = ?(ТипЗначения(Зн)=1,Формат(Зн,"Ч015.2."),Зн)
						КонецЕсли;
					КонецЦикла;
					ВыходнаяТаблица.ВывестиСекцию(Раздел5НК);
					ВыведеноРазделов = ВыведеноРазделов + 1;
					Если ((ВыведеноРазделов = 1) и (Всего5Разделов > 1)) или ((ВыведеноРазделов = 3) и (Всего5Разделов > 3)) Тогда
						ВыходнаяТаблица.НоваяСтраница();
					КонецЕсли;
				КонецЦикла;
				
				Если Всего5Разделов = 0 Тогда
					Раздел5НК = ВыходнаяТаблица.ПолучитьСекцию("Страница4");
					Раздел5НК.Область("Доход5раздела").Текст = "Код дохода ___ сумма дохода";
				    ВыходнаяТаблица.ВывестиСекцию(Раздел5НК);
				КонецЕсли;
				
				ВыходнаяТаблица.НоваяСтраница();
				ВыходнаяТаблица.ВывестиСекцию(Страница5);
				ВыходнаяТаблица.ВывестиСекцию(Страница6);
				
				ВыходнаяТаблица.Область().ЦветТекста(-1);
				ВыходнаяТаблица.Область().ЦветФона(-1);
				ВыходнаяТаблица.Область().ЦветРамки(-1);
				ВыходнаяТаблица.Записать(ИмяФайлаПечатнойФормы);
			КонецЕсли;

			ВыходнаяТаблица.Опции(0,0,0,0, "НалоговыеКарточки", "НалоговыеКарточки");
			ВыходнаяТаблица.ТолькоПросмотр(1);
			
			Если ПунктМеню="ПечататьСразу" Тогда
				ВыходнаяТаблица.Напечатать(0);
				
			Иначе
				ВыходнаяТаблица.Показать("Налоговые карточки 1-НДФЛ: "+?(ФизЛицо = "", "", ФизЛицо.Наименование));
			КонецЕсли;
		КонецЕсли;
		
	Иначе
		Предупреждение("Не указан сотрудник");
	КонецЕсли;
		
КонецПроцедуры // Печать()

//******************************************************************************
// Предопределенная процедура
//
Процедура ПриОткрытии()

	Перем ПараметрыКоманды;  
	
	НачальныйГод = 2002;
	КонечныйГод = 2008;

	Если НачальныйГод>КонечныйГод Тогда
		СпЛет.ДобавитьЗначение(2002,"2002 г.");
		СпЛет.ТекущаяСтрока(1);
		Год = СпЛет.ПолучитьЗначение(СпЛет.ТекущаяСтрока());
	Иначе
		Для ГодВСписок = НачальныйГод По КонечныйГод Цикл
			СпЛет.ДобавитьЗначение(ГодВСписок,Строка(ГодВСписок)+" г.");	
		КонецЦикла;	
		//в 1-м квартале будем устанавливать по умолчанию прошлый год, а дальше текущий год
		НомерМесяца = ДатаМесяц(РабочаяДата());
		Если НомерМесяца<=3 Тогда
			СпЛет.ТекущаяСтрока(СпЛет.РазмерСписка()-1);
		Иначе
			СпЛет.ТекущаяСтрока(СпЛет.РазмерСписка());
		КонецЕсли;
		Год = СпЛет.ПолучитьЗначение(СпЛет.ТекущаяСтрока());
	КонецЕсли;
	
	СписокПрочихПолейКарточки = ЗаполнитьСписокПрочихПолейКарточки();
	
	Если ПустоеЗначение(Форма.Параметр) = 0 Тогда
	    ФизЛицо = Форма.Параметр.Получить("Сотрудник");
		ЗаполнитьТаблицу(Контекст);
		Форма.Заголовок(": "+ФизЛицо.Наименование,1);
	
	Иначе
		Резидент = 1;
		КонецГода = КонГода(Дата(Год,12,15));
		ПолучитСтавкиНДФЛ();
		СписокВводаРаздела5 = СоздатьОбъект("СписокЗначений");
	КонецЕсли; 
	
	СтрокаТекущегоГода = СпЛет.НайтиЗначение(Год);
	СпЛет.ТекущаяСтрока(СтрокаТекущегоГода);

	Таблица.Опции(0,0,,,"НК","НК");
	Таблица.ПараметрыСтраницы(2,,,0,0,0,0,0,0,0,1);
	
	ИсходнаяТаблица = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(ИсходнаяТаблица);
	ОбновитьРаздел6();
		
КонецПроцедуры // ПриОткрытии

//******************************************************************************
// Предопределенная процедура
//
Процедура ПриНачалеВыбораЗначения(ИдентЭлемДиалога, ФлагСтандОбр)
	
	Если Найти("R41C1,R42C1,R43C1,R44C1,R45C1,",ИдентЭлемДиалога)>0  Тогда // раздел 3 - доходы
		ФлагСтандОбр=0;
		СписокКПоказу=СоздатьОбъект("СписокЗначений");
		СписокКПоказу.ДобавитьЗначение(ПолучитьПустоеЗначение("Справочник.ВидыДоходов"),"Очистить значение");
		Спр=СоздатьОбъект("Справочник.ВидыДоходов");
		Спр.НайтиПоКоду(Таблица.Область(ИдентЭлемДиалога).Значение);
		ТекЗнач = Спр.ТекущийЭлемент();
		Спр.ВыбратьЭлементы();
		Пока Спр.ПолучитьЭлемент()=1 Цикл
			Если Резидент = 1  Тогда // раздел 3 налоговой карточки налогового резидента  РФ
				Если (Спр.Код="4000") или (Спр.Код="4600") или (Спр.Код="1010") или (Спр.Код="1210") или (Спр.Код="2740") или (Спр.Код="3020") или (Лев(Спр.Код,2)="15") Тогда
					Продолжить
				КонецЕсли;
				СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
			Иначе // раздел 3 налоговой карточки нерезидента
				Если (Спр.Код="1010") или (Спр.Код="1011") Тогда
					Если Дата("01.01."+Год) > '31.12.2007' Тогда
						Продолжить;
					КонецЕсли;
				КонецЕсли;
				СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование); 
			КонецЕсли;
		КонецЦикла;
		СписокКПоказу.СортироватьПоПредставлению();
		Значение = ТекЗнач;
		Если СписокКПоказу.ВыбратьЗначение(Значение,,,,2) = 1 Тогда
			Таблица.Область(ИдентЭлемДиалога).Значение=Значение.Код
		КонецЕсли;
	
	ИначеЕсли (Найти("П068,П081,П094,П107,П120",ИдентЭлемДиалога)>0)  Тогда // раздел 3 - вычеты
		ФлагСтандОбр=0;
		СписокКПоказу=СоздатьОбъект("СписокЗначений");
		СписокКПоказу.ДобавитьЗначение(ПолучитьПустоеЗначение("Справочник.ВидыВычетов"),"Очистить значение");
		Спр=СоздатьОбъект("Справочник.ВидыВычетов");
		Спр.НайтиПоКоду(Таблица.Область(ИдентЭлемДиалога).Значение);
		ТекЗнач = Спр.ТекущийЭлемент();
		// вычеты соответствуют ст. 217 НК РФ и предоставляются всем
		Спр.НайтиПоКоду("501");
		СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
		Спр.НайтиПоКоду("502");
		СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
		Спр.НайтиПоКоду("503");
		СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
		Спр.НайтиПоКоду("504");
		СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование); 
		Спр.НайтиПоКоду("506");
		СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
		Спр.НайтиПоКоду("507");
		СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование); 
		Если Резидент = 1 Тогда  // для резидентов РФ - расходы согласно ст. 221 НК РФ
			Спр.НайтиПоКоду("403");
			СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
			Спр.НайтиПоКоду("404");
			СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
			Спр.НайтиПоКоду("405");
			СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
		Иначе  // для нерезидентов в 3-м разделе еще вводятся и призы из 5-го раздела
			Спр.НайтиПоКоду("505");
			СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование); 
		КонецЕсли;
		СписокКПоказу.СортироватьПоПредставлению();
		Значение = ТекЗнач;
		Если СписокКПоказу.ВыбратьЗначение(Значение,,,,2) = 1 Тогда
			Таблица.Область(ИдентЭлемДиалога).Значение="Код "+Значение.Код
		КонецЕсли;
		
	ИначеЕсли Найти("R97C2",ИдентЭлемДиалога)>0  Тогда // раздел 5. Доходы по 35%
		ФлагСтандОбр=0;
		Если Резидент = 1 Тогда
			СписокКПоказу=СоздатьОбъект("СписокЗначений");
			СписокКПоказу.ДобавитьЗначение(ПолучитьПустоеЗначение("Справочник.ВидыДоходов"),"Очистить значение");
			Спр=СоздатьОбъект("Справочник.ВидыДоходов");
			Спр.НайтиПоКоду(Таблица.Область(ИдентЭлемДиалога).Значение);
			ТекЗнач = Спр.ТекущийЭлемент();
			Спр.ВыбратьЭлементы();
			Пока Спр.ПолучитьЭлемент()=1 Цикл
				// раздел 5 налоговой
				Если (Спр.Код="2740") или (Спр.Код="1210") или (Спр.Код="3020") или (Спр.Код="2610") или (Спр.Код="2620") тогда
					СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
				КонецЕсли;
			КонецЦикла;
			СписокКПоказу.СортироватьПоПредставлению();
			Значение = ТекЗнач;
			Если СписокКПоказу.ВыбратьЗначение(Значение,,,,2) = 1 Тогда
				Таблица.Область(ИдентЭлемДиалога).Значение=?(ПустоеЗначение(Значение.Код) = 1,"Код дохода ___ сумма дохода","Код дохода "+Значение.Код+" сумма дохода")
			КонецЕсли;
		Иначе
			Предупреждение("Все доходы нерезидентов РФ "+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
			Таблица.АктивнаяОбласть("R41C1");
		КонецЕсли;
	
	ИначеЕсли (Найти("R121C1,R122C1,R123C1",ИдентЭлемДиалога)>0)  Тогда // раздел 7
		ФлагСтандОбр=0;
		Если Резидент = 1 Тогда
			СписокКПоказу=СоздатьОбъект("СписокЗначений");
			СписокКПоказу.ДобавитьЗначение(ПолучитьПустоеЗначение("Справочник.ВидыДоходов"),"Очистить значение");
			Спр=СоздатьОбъект("Справочник.ВидыДоходов");
			Спр.НайтиПоКоду(Таблица.Область(ИдентЭлемДиалога).Значение);
			ТекЗнач = Спр.ТекущийЭлемент();
			Спр.ВыбратьЭлементы();
			Пока Спр.ПолучитьЭлемент()=1 Цикл
				Если (Лев(Спр.Код,2)="15") или (Спр.Код="4000") или (Спр.Код="4600") Тогда
					СписокКПоказу.ДобавитьЗначение(Спр.ТекущийЭлемент(),Спр.Код+"  "+Спр.Наименование);
				КонецЕсли;
			КонецЦикла;
			СписокКПоказу.СортироватьПоПредставлению();
			Значение = ТекЗнач;
			Если СписокКПоказу.ВыбратьЗначение(Значение,,,,2) = 1 Тогда
				Таблица.Область(ИдентЭлемДиалога).Значение=Значение.Код
			КонецЕсли;
		Иначе
			Предупреждение("Все доходы нерезидентов РФ "+РазделительСтрок+"регистрируются в 3-м разделе Налоговой карточки!");
			Таблица.АктивнаяОбласть("R41C1");
		КонецЕсли;
		
	ИначеЕсли "R139C9" = ИдентЭлемДиалога Тогда
		ФлагСтандОбр=0;
		СпрСотрудники = СоздатьОбъект("Справочник.Сотрудники");
		СпрСотрудники.НайтиПоНаименованию(П433);
		Если СпрСотрудники.Выбрать("Выберите проверяющего","ДляВыбора") = 1 Тогда
			П433 = СпрСотрудники.Наименование;   
			ДолжностьПроверяющего=СпрСотрудники.Должность;
		КонецЕсли;
		
	ИначеЕсли (Число(Прав(ИдентЭлемДиалога, 3)) > 68) и (Число(Прав(ИдентЭлемДиалога, 3)) < 133)  Тогда  // вычеты по авторским
		Номер = Число(Прав(ИдентЭлемДиалога, 3)); 
		НомерСтрокиРедактирования = Цел((Номер - ПерваяЯчейкаВычетовРаздела3)/13);
		МесяцРедактирования = Номер - ПерваяЯчейкаВычетовРаздела3 - 13 * НомерСтрокиРедактирования;
		СписокВидовАвторских = СоздатьОбъект("СписокЗначений");
		СписокСуммАвторских = СоздатьОбъект("СписокЗначений");
		ТипВычета = Таблица.Область("П" + глДополнитьСтроку(ПерваяЯчейкаВычетовРаздела3+НомерСтрокиРедактирования*13,3)).Значение;
		Если Найти(",404,405,",","+ТипВычета+",") = 0 Тогда
			Возврат;
		КонецЕсли;
		Для индДох = 1 по 5 Цикл
			ТипДохода = Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (индДох-1)*13,3)).Значение;
			Если (Лев(ТипДохода, 2) = "22") Тогда
				СуммаДохода = Таблица.Область("П"+глДополнитьСтроку(ПерваяЯчейкаРаздела3 + (индДох-1)*13 + МесяцРедактирования,3)).Значение;
				СписокВидовАвторских.ДобавитьЗначение(ТипДохода);
				СписокСуммАвторских.Установить(ТипДохода, СуммаДохода);
			КонецЕсли;
		КонецЦикла;                                     
		РазмерВыч = "";
		ОбщСумма = 0;
		Если СписокВидовАвторских.РазмерСписка() > 1 Тогда
			ВидовАвторских = СписокВидовАвторских.РазмерСписка();
			СписокВычетовИзЯчейки = СпВычетовПоАвторским.Получить(ИдентЭлемДиалога); 
			Если ПустоеЗначение(СписокВычетовИзЯчейки)=1 Тогда
				СписокВычетовИзЯчейки=СоздатьОбъект("СписокЗначений");
			КонецЕсли;
			Для инд = ВидовАвторских+1 по 5 Цикл
				СписокВидовАвторских.ДобавитьЗначение("");
			КонецЦикла;
			СписокВидовАвторских.ДобавитьЗначение(СписокСуммАвторских, "СпСумм");
			СписокВидовАвторских.ДобавитьЗначение(ТипВычета, "ТипВычета");
			СписокВидовАвторских.ДобавитьЗначение(СписокВычетовИзЯчейки, "СпДляОбработки");
			ОткрытьФормуМодально("Обработка.ВводВычетовПоАвторскимВознаграждениям", СписокВидовАвторских);
			Если ТипЗначенияСтр(СписокВидовАвторских) = "СписокЗначений" Тогда
				ВрСпДох = СоздатьОбъект("СписокЗначений");
				КолвоДох = СписокВидовАвторских.РазмерСписка();
				Для инд = 1 по КолвоДох Цикл
					ТипДохода = СписокВидовАвторских.ПолучитьЗначение(инд, РазмерВыч);
					Если (ПустоеЗначение(ТипДохода) = 0) и (Число(РазмерВыч) <> 0) Тогда
						ОбщСумма = ОбщСумма + Число(РазмерВыч);
						ВрСпДох.ДобавитьЗначение(ТипДохода, РазмерВыч);
					КонецЕсли;
				КонецЦикла;
				СпВычетовПоАвторским.Установить(ИдентЭлемДиалога, ВрСпДох); 
			Иначе
				СписокВычетовИзЯчейки = СпВычетовПоАвторским.Получить(ИдентЭлемДиалога); 
				Если ПустоеЗначение(СписокВычетовИзЯчейки) = 0 Тогда 
					КолвоДох = СписокВычетовИзЯчейки.РазмерСписка();
					Для инд = 1 по КолвоДох Цикл
						ТипДохода = СписокВычетовИзЯчейки.ПолучитьЗначение(инд, РазмерВыч);
						Если (ПустоеЗначение(ТипДохода) = 0) и (Число(РазмерВыч) <> 0) Тогда
							ОбщСумма = ОбщСумма + Число(РазмерВыч);
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЕсли;
		Иначе       
			// пусть будет, так как есть
			Возврат;
		КонецЕсли;
		ФлагСтандОбр=0;
		Таблица.Область(ИдентЭлемДиалога).Значение = ОбщСумма;
		ОткрывалиФормуВводаВычетов = 1;
	КонецЕсли;
	
КонецПроцедуры // ПриНачалеВыбораЗначения

//******************************************************************************
// Предопределенная процедура
//
Процедура ОбработкаВыбораЗначения(ВыбЗнач, ИдентификаторЭлементаДиалога, Флаг)
	
	Если ИдентификаторЭлементаДиалога = "ФизЛицо" Тогда
	    Если ВыбЗнач.ЭтоГруппа() = 1 Тогда
	        Флаг = 0;
	    КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры // ОбработкаВыбораЗначения()

//******************************************************************************
// Предопределенная процедура
//
Процедура ПриЗакрытии() //предопределенная
    
	// проверим, редактировали ли значения в таблице
	// если что-то изменилось - спросим, а не сохранить ли
	
	СЗТекущееСостояние = СоздатьОбъект("СписокЗначений");
	Таблица.Выгрузить(СЗТекущееСостояние);
	Если СпискиИдентичны(СЗТекущееСостояние,ИсходнаяТаблица) = 0 Тогда
		Ответ=Вопрос("Сохранить изменения?","Да+Нет+Отмена");
		Если  Ответ="Да"  Тогда
			Если Сохранить() = 0 Тогда
				СтатусВозврата(0)
			КонецЕсли;
		ИначеЕсли Ответ="Отмена"  Тогда
			СтатусВозврата(0)
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры //ПриЗакрытии

//******************************************************************************

ПерваяЯчейкаРаздела3 = 3;
ПерваяЯчейкаВычетовРаздела3 = 55;
ПерваяЯчейкаСтандартныхВычетовРаздела3 = 87;
ПерваяЯчейкаУдержанныхНалоговРаздела3 = 133;
ПерваяЯчейкаРаздела4 = 152;
ПерваяЯчейкаРаздела5 = 187;
ПерваяЯчейкаРаздела7 = 275;
ПерваяЯчейкаРаздела8 = 340;

СальдоНаНачалоГода = 0;

Стр = "";

Стр = Стр + """ИД01"",""ИД02"",""ИД03"",""ИД04"",""ИД05"",""ИД06"",""ИД07"",""ИД08"",""ИД09"",""ИД10"",";
Стр = Стр + """МДБезВ01"",""МДБезВ02"",""МДБезВ03"",""МДБезВ04"",""МДБезВ05"",""МДБезВ06"",""МДБезВ07"",""МДБезВ08"",""МДБезВ09"",""МДБезВ10"",""МДБезВ11"",""МДБезВ12"",";
Стр = Стр + """ГДБезВ01"",""ГДБезВ02"",""ГДБезВ03"",""ГДБезВ04"",""ГДБезВ05"",""ГДБезВ06"",""ГДБезВ07"",""ГДБезВ08"",""ГДБезВ09"",""ГДБезВ10"",""ГДБезВ11"",""ГДБезВ12"",""ИГДБезВ"",";
Стр = Стр + """ИСВМес1"",""ИСВМес2"",""ИСВМес3"",""ИСВМес4"",""ИСВМес5"",";
Стр = Стр + """ОбщСВ01"",""ОбщСВ02"",""ОбщСВ03"",""ОбщСВ04"",""ОбщСВ05"",""ОбщСВ06"",""ОбщСВ07"",""ОбщСВ08"",""ОбщСВ09"",""ОбщСВ10"",""ОбщСВ11"",""ОбщСВ12"",""ИОбщСВ"",";
Стр = Стр + """НБаза01"",""НБаза02"",""НБаза03"",""НБаза04"",""НБаза05"",""НБаза06"",""НБаза07"",""НБаза08"",""НБаза09"",""НБаза10"",""НБаза11"",""НБаза12"",""ИНБаза"",";
Стр = Стр + """ИНИ"",""ИНУ"",";
Стр = Стр + """МДолгНП01"",""МДолгНП02"",""МДолгНП03"",""МДолгНП04"",""МДолгНП05"",""МДолгНП06"",""МДолгНП07"",""МДолгНП08"",""МДолгНП09"",""МДолгНП10"",""МДолгНП11"",""МДолгНП12"",""ИМДолгНП"",";
Стр = Стр + """МДолгНА01"",""МДолгНА02"",""МДолгНА03"",""МДолгНА04"",""МДолгНА05"",""МДолгНА06"",""МДолгНА07"",""МДолгНА08"",""МДолгНА09"",""МДолгНА10"",""МДолгНА11"",""МДолгНА12"",""ИМДолгНА"",";
Стр = Стр + """ИНалВзыск"",""ИНалВозвр"",";

Стр = Стр + """ИДив"",""ИНД6И"",""ИДивНУ"",";
Стр = Стр + """ДДолгНП01"",""ДДолгНП02"",""ДДолгНП03"",""ДДолгНП04"",""ДДолгНП05"",""ДДолгНП06"",""ДДолгНП07"",""ДДолгНП08"",""ДДолгНП09"",""ДДолгНП10"",""ДДолгНП11"",""ДДолгНП12"",""ИДДолгНП"",";
Стр = Стр + """ДДолгНА01"",""ДДолгНА02"",""ДДолгНА03"",""ДДолгНА04"",""ДДолгНА05"",""ДДолгНА06"",""ДДолгНА07"",""ДДолгНА08"",""ДДолгНА09"",""ДДолгНА10"",""ДДолгНА11"",""ДДолгНА12"",""ИДДолгНА"",";
Стр = Стр + """ИДНалВзыск"",""ИДНалВозвр"",";

Стр = Стр + """ИСТ35_01"",""ИСТ35_06"",";
Стр = Стр + """Дох35НБ01"",""Дох35НБ02"",""Дох35НБ03"",""Дох35НБ04"",""Дох35НБ05"",""Дох35НБ06"",""Дох35НБ07"",""Дох35НБ08"",""Дох35НБ09"",""Дох35НБ10"",""Дох35НБ11"",""Дох35НБ12"",""ИДох35НБ"",";
Стр = Стр + """ИСТ35НИ"",""ИСТ35_07"",";
Стр = Стр + """СТ35НИ01"",""СТ35НИ02"",""СТ35НИ03"",""СТ35НИ04"",""СТ35НИ05"",""СТ35НИ06"",""СТ35НИ07"",""СТ35НИ08"",""СТ35НИ09"",""СТ35НИ10"",""СТ35НИ11"",""СТ35НИ12"",""ИСТ35НИ"",";
Стр = Стр + """Долг35НП01"",""Долг35НП02"",""Долг35НП03"",""Долг35НП04"",""Долг35НП05"",""Долг35НП06"",""Долг35НП07"",""Долг35НП08"",""Долг35НП09"",""Долг35НП10"",""Долг35НП11"",""Долг35НП12"",""ИДолг35НП"",";
Стр = Стр + """Долг35НА01"",""Долг35НА02"",""Долг35НА03"",""Долг35НА04"",""Долг35НА05"",""Долг35НА06"",""Долг35НА07"",""Долг35НА08"",""Долг35НА09"",""Долг35НА10"",""Долг35НА11"",""Долг35НА12"",""ИДолг35НА"",";
Стр = Стр + """ИНал35Взыск"",""ИНал35Возвр"",";

Стр = Стр + """ОбщСт6НИ"",""ОбщСт6НУ"",""ОбщСт6ДНП"",""ОбщСт6ДНА"",""ОбщСт6Взыск"",";
Стр = Стр + """ОбщСт13НИ"",""П272"",""ОбщСт13ДНП"",""ОбщСт13ДНА"",""ОбщСт13Взыск"",";
Стр = Стр + """ОбщСт30НИ"",""П273"",""ОбщСт30ДНП"",""ОбщСт30ДНА"",""ОбщСт30Взыск"",";
Стр = Стр + """ОбщСт35НИ"",""П274"",""ОбщСт35ДНП"",""ОбщСт35ДНА"",""ОбщСт35Взыск"",";
Стр = Стр + """ОбщНИ"",""ОбщНУ"",""ИОбщСтДНП"",""ИОбщСтДНА"",""ИОбщСтВзыск"",";
Стр = Стр + """ИОбщВозвр"",""ИОбщЗач"",";

Стр = Стр + """ИПродаж1"",""ИПродаж2"",""ИПродаж3"",";

Стр = Стр + """ИВычет1_Итого"",""ИВычет2_Итого"",""ИОбДив"",";
Стр = Стр + """ИСВМес6"",""ИСВМес7"",";
Стр = Стр + """ГИВ_01"",""ГИВ_02"",""ГИВ_03"",""ГИВ_04"",""ГИВ_05"",""ГИВ_06"",""ГИВ_07"",""ГИВ_08"",""ГИВ_09"",""ГИВ_10"",""ГИВ_11"",""ГИВ_12"",""ГИВ_Итого""";

ИменаИтоговКарточки = СоздатьОбъект("СписокЗначений");
ИменаИтоговКарточки.ИзСтрокиСРазделителями(Стр);

ПоследнийМесяц = 0;

СпрВидыДоходов = СоздатьОбъект("Справочник.ВидыДоходов");
ВычетыСотрудниковПоНДФЛ = СоздатьОбъект("Справочник.ВычетыСотрудниковПоНДФЛ");
ВидыВычетов = СоздатьОбъект("Справочник.ВидыВычетов");

